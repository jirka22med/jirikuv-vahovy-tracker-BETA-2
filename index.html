<!DOCTYPE html>
<html lang="cs">
<head>
Â  <meta charset="UTF-8">
Â  <title>PokroÄilÃ½ vÃ¡hovÃ½ tracker vÃ­ce admirÃ¡la JiÅ™Ã­ka</title>
Â  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
Â  Â Â 
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-messaging.js"></script>Â  Â  Â 
<script src="firebaseFunctions.js"></script>
Â  Â Â 
Â  <style>
body {
  background: #0d1117;
  color: #f0f0f0;
  font-family: Consolas, monospace;
  padding: 20px;
  margin: 0;
  text-align: center;    
}

.container {
  max-width: 1350px; /* Trochu Å¡irÅ¡Ã­ kontejner pro vÃ­ce sloupcÅ¯ */
  margin: 0 auto;
}

h1, h2 {
  color: #00d9ff;
  text-align: center;
}

.dashboard {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
  margin: 20px 0;
}

.card {
  background: #1f2633;
  border: 1px solid #444;
  border-radius: 10px;
  padding: 20px;
  transition: transform 0.3s;
}

.card:hover {
  transform: translateY(-5px);
  border-color: #00d9ff;
}

.card h3 {
  color: #00ff99;
  margin-top: 0;
}

.form-group {
  margin: 15px 0;
}

label {
  display: block;
  margin-bottom: 5px;
  color: #00d9ff;
}

input, select, textarea {
  width: 100%;
  padding: 10px;
  background: #0d1117;
  border: 1px solid #444;
  color: #f0f0f0;
  border-radius: 5px;
  box-sizing: border-box;
}

input:focus, select:focus, textarea:focus {
  border-color: #00d9ff;
  outline: none;
}

button {
  background: #00d9ff;
  color: #000;
  padding: 10px 20px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  margin: 5px;
  transition: background 0.3s;
}

button:hover {
  background: #00b8cc;
}

button.danger {
  background: #ff5555;
  color: #fff;
}

button.success {
  background: #55ff99;
  color: #000;
}

button.fullscreen {
  background: #00d9ff;
  color: #000;
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 1000;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  font-size: 1.2rem;
}

button.fullscreen:hover {
  background: #00b8cc;
  transform: scale(1.1);
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  background: #1f2633;
  font-size: 0.9em; /* MenÅ¡Ã­ pÃ­smo pro vÃ­ce sloupcÅ¯ */
}

th, td {
  border: 1px solid #444;
  padding: 8px; /* MenÅ¡Ã­ padding */
  text-align: center;
}

th {
  background: #0d1117;
  color: #00d9ff;
}

.gain {
  color: #ff5555;
}

.loss {
  color: #55ff99;
}

.bmi-normal { color: #55ff99; }
.bmi-underweight { color: #00d9ff; }
.bmi-overweight { color: #ffff55; }
.bmi-obese { color: #ff5555; }

.alert {
  padding: 15px;
  margin: 15px 0;
  border-radius: 5px;
  background: #ff5555;
  color: #fff;
  display: none;
}

.alert.show {
  display: block;
}

.stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); /* JeÅ¡tÄ› menÅ¡Ã­ minmax pro vÃ­ce poloÅ¾ek */
  gap: 10px; /* MenÅ¡Ã­ mezery */
  margin: 20px 0;
}

.stat-item {
  background: #1f2633;
  padding: 10px; /* MenÅ¡Ã­ padding */
  border-radius: 10px;
  text-align: center;
  border: 1px solid #444;
}

.stat-value {
  font-size: 1.5em; /* MenÅ¡Ã­ pÃ­smo */
  font-weight: bold;
  color: #00d9ff;
}
.stat-label {
    font-size: 0.8em; /* MenÅ¡Ã­ pÃ­smo */
    color: #ccc;
    margin-top: 3px;
}


.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  background: #00d9ff;
  color: #000;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  display: none;
  z-index: 1000;
}

.progress-bar {
  width: 100%;
  height: 20px;
  background: #444;
  border-radius: 10px;
  overflow: hidden;
  margin: 10px 0;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #00d9ff, #00ff99);
  transition: width 0.3s;
}

.tabs {
  display: flex;
  margin: 20px 0;
  border-bottom: 1px solid #444;
}

.tab {
  padding: 10px 20px;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  color: #ccc;
}

.tab.active {
  color: #00d9ff;
  border-bottom-color: #00d9ff;
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}
  /* ObecnÃ© nastavenÃ­ kontejneru pro grafy */
.charts-container {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
  justify-content: center;
  padding: 25px;
  background-color: #2c3e50;
  border-radius: 10px;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
}

/* Styl jednotlivÃ½ch karet s grafem */
.chart-card {
  background-color: white;
  border-radius: 0px;
  padding: 40px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
  flex: 1 1 305px;
  max-width: 50px;
  min-width: 280px;
  transition: transform 0.3s ease;
   overflow-x: auto; /* pÅ™idÃ¡ scroll pokud se to nevejde */  
}

.chart-card:hover {
  transform: scale(1.02);
}

/* Nadpis grafu */
.chart-card h3 {
  margin-bottom: 15px;
  font-size: 20px;
  color: #2c3e50;
  text-align: center;
}

/* Canvas grafu */
.chart-card canvas {
  width: 100% !important;
  height: auto !important;
}

      
@media (max-width: 768px) { /* Ãšprava breakpointu pro lepÅ¡Ã­ zobrazenÃ­ tabulky */
  .stats {
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  }
   table {
    font-size: 0.75rem; /* JeÅ¡tÄ› menÅ¡Ã­ pÃ­smo pro mobily */
  }
  th, td {
    padding: 4px;
  }
}


@media (max-width: 480px) {
  body {
    padding: 10px;
  }
  h1, h2 {
    font-size: 1.5rem;
  }
  .dashboard {
    grid-template-columns: 1fr;
    gap: 15px;
  }
  .card {
    padding: 15px;
  }
  .charts-container {
    grid-template-columns: 1fr;
  }
  .chart-card {
    padding: 15px;
    overflow-x: auto;
  }
  .stats {
    grid-template-columns: 1fr 1fr; 
  }
  .stat-item {
    padding: 5px;
  }
  .stat-value {
    font-size: 1.2em;
  }
   .stat-label {
    font-size: 0.7em;
  }
  .notification {
    width: 80%;
    left: 10%;
    right: 10%;
  }
  .tabs {
    flex-direction: column;
    border-bottom: none;
  }
  .tab {
    border-bottom: 1px solid #444;
    padding: 8px 15px;
  }
  .tab.active {
    border-left: 3px solid #00d9ff;
    border-bottom: 1px solid #444;
  }
  button {
    min-height: 5px; /* DoporuÄenÃ¡ minimÃ¡lnÃ­ vÃ½Å¡ka pro dotyk */
        padding: 0px 0px; /* VÄ›tÅ¡Ã­ padding pro snadnÄ›jÅ¡Ã­ dotyk */
        display: inline-flex; /* ZajistÃ­, Å¾e text je vycentrovanÃ½ vertikÃ¡lnÄ› */
        align-items: center;
        justify-content: center;
  }
  button.fullscreen {
    width: 40px !important;
    height: 40px !important;
    bottom: 10px !important;
    right: 10px !important;
  }
  table {
    font-size: 0.65rem; /* ExtrÃ©mnÄ› malÃ© pÃ­smo - zvÃ¡Å¾it skrytÃ­ sloupcÅ¯ */
    display: block; /* UmoÅ¾nÃ­ horizontÃ¡lnÃ­ scroll pro tabulku */
    overflow-x: auto; /* PÅ™idÃ¡ horizontÃ¡lnÃ­ scroll pro tabulku */
  }
  th, td {
    padding: 3px;
     white-space: nowrap; /* ZabrÃ¡nÃ­ zalomenÃ­ textu v buÅˆkÃ¡ch */
  }
}

.charts-container {
  display: grid; 
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
  gap: 20px; 
  padding: 20px; 
  background-color: #1a222d; 
  border-radius: 10px;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
  margin-top: 20px; 
}

.chart-card {
  background-color: #1f2633; 
  border-radius: 10px; 
  padding: 20px; 
  box-shadow: none; 
  border: 1px solid #444; 
  transition: transform 0.3s ease, border-color 0.3s ease; 
  overflow-x: auto;
}
.chart-card:hover {
  transform: translateY(-5px); 
  border-color: #00d9ff; 
}

.chart-card h3 {
  margin-bottom: 15px;
  font-size: 1.2rem; 
  color: #00ff99; 
  text-align: center;
}

.chart-card canvas {
  width: 100% !important;
  height: auto !important;
  max-height: 200px; 
}

/* ===== MOBILNÃ RESPONZIVITA - KOMPLETNÃ @MEDIA QUERIES ===== */

/* Tablety a menÅ¡Ã­ desktopy */
@media (max-width: 1024px) {
  .container {
    max-width: 95%;
    padding: 0 10px;
  }
  
  .dashboard {
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 15px;
  }
  
  .charts-container {
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 15px;
    padding: 15px;
  }
  
  .stats {
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  }
}

/* VÄ›tÅ¡Ã­ mobily a malÃ© tablety */
@media (max-width: 768px) {
  body {
    padding: 15px 10px;
    font-size: 14px;
  }
  
  .container {
    max-width: 100%;
    padding: 0 5px;
  }
  
  h1 {
    font-size: 1.8rem;
    margin: 15px 0;
  }
  
  h2 {
    font-size: 1.4rem;
    margin: 12px 0;
  }
  
  .dashboard {
    grid-template-columns: 1fr;
    gap: 12px;
    margin: 15px 0;
  }
  
  .card {
    padding: 15px;
    margin: 0 5px;
  }
  
  .card h3 {
    font-size: 1.1rem;
    margin-bottom: 10px;
  }
  
  /* FormulÃ¡Å™ovÃ© prvky */
  input, select, textarea {
    padding: 12px 8px;
    font-size: 16px; /* ZabrÃ¡nÃ­ zoomovÃ¡nÃ­ na iOS */
    border-radius: 8px;
  }
  
  button {
    min-height: 5px; /* DoporuÄenÃ¡ minimÃ¡lnÃ­ vÃ½Å¡ka pro dotyk */
        padding: 0px 0px; /* VÄ›tÅ¡Ã­ padding pro snadnÄ›jÅ¡Ã­ dotyk */
        display: inline-flex; /* ZajistÃ­, Å¾e text je vycentrovanÃ½ vertikÃ¡lnÄ› */
        align-items: center;
        justify-content: center;
  }
  
  /* Tabulky */
  table {
    font-size: 0.8rem;
    display: block;
    overflow-x: auto;
    white-space: nowrap;
    border-radius: 8px;
  }
  
  th, td {
    padding: 6px 4px;
    min-width: 60px;
  }
  
  /* Statistiky */
  .stats {
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 8px;
  }
  
  .stat-item {
    padding: 12px 8px;
  }
  
  .stat-value {
    font-size: 1.3em;
  }
  
  .stat-label {
    font-size: 0.75em;
  }
  
  /* Grafy */
  .charts-container {
    grid-template-columns: 1fr;
    gap: 12px;
    padding: 12px;
    margin: 15px 0;
  }
  
  .chart-card {
    padding: 15px;
    margin: 0;
    min-width: unset;
    max-width: 100%;
  }
  
  .chart-card h3 {
    font-size: 1rem;
    margin-bottom: 10px;
  }
  
  .chart-card canvas {
    max-height: 250px;
  }
  
  /* Taby */
  .tabs {
    flex-wrap: wrap;
    gap: 2px;
    margin: 2px 0;
  }
  
  .tab {
    padding: 8px 12px;
    font-size: 0.9rem;
    flex: 1;
    text-align: center;
    min-width: 80px;
  }
  
  /* Progress bar */
  .progress-bar {
    height: 25px;
    margin: 15px 0;
  }
  
  /* Notifikace */
  .notification {
    width: 85%;
    left: 7.5%;
    right: 7.5%;
    top: 15px;
    padding: 12px;
    font-size: 0.9rem;
  }
  
  /* Fullscreen tlaÄÃ­tko */
  button.fullscreen {
    width: 45px;
    height: 45px;
    bottom: 15px;
    right: 15px;
    font-size: 1.1rem;
  }
}

/* StandardnÃ­ mobily */
@media (max-width: 480px) {
  body {
    padding: 10px 5px;
    font-size: 13px;
  }
  
  .container {
    padding: 0;
  }
  
  h1 {
    font-size: 1.5rem;
    margin: 10px 0;
    line-height: 1.3;
  }
  
  h2 {
    font-size: 1.2rem;
    margin: 8px 0;
    line-height: 1.3;
  }
  
  .dashboard {
    gap: 10px;
    margin: 10px 0;
  }
  
  .card {
    padding: 12px;
    margin: 0 2px;
    border-radius: 8px;
  }
  
  .card h3 {
    font-size: 1rem;
    margin-bottom: 8px;
  }
  
  /* FormulÃ¡Å™e */
  .form-group {
    margin: 12px 0;
  }
  
  label {
    font-size: 0.9rem;
    margin-bottom: 4px;
  }
  
  input, select, textarea {
    padding: 10px 6px;
    font-size: 16px;
    border-radius: 6px;
  }
  
  button {
    min-height: 5px; /* DoporuÄenÃ¡ minimÃ¡lnÃ­ vÃ½Å¡ka pro dotyk */
        padding: 0px 0px; /* VÄ›tÅ¡Ã­ padding pro snadnÄ›jÅ¡Ã­ dotyk */
        display: inline-flex; /* ZajistÃ­, Å¾e text je vycentrovanÃ½ vertikÃ¡lnÄ› */
        align-items: center;
        justify-content: center;
  }
  
  /* Tabulky - extrÃ©mnÃ­ optimalizace */
  table {
    font-size: 0.65rem;
    display: block;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    border-radius: 6px;
  }
  
  th, td {
    padding: 5px 5px;
    white-space: nowrap;
    min-width: 50px;
    text-align: center;
  }
  
  th {
    position: sticky;
    top: 0;
    background: green;
    z-index: 10;
  }
  
  /* Statistiky - dvousloupkovÃ½ layout */
  .stats {
    grid-template-columns: 1fr 1fr;
    gap: 6px;
    margin: 12px 0;
  }
  
  .stat-item {
    padding: 8px 6px;
    border-radius: 6px;
  }
  
  .stat-value {
    font-size: 1.1em;
    line-height: 1.2;
  }
  
  .stat-label {
    font-size: 0.65em;
    margin-top: 2px;
    line-height: 1.1;
  }
  
  /* Grafy - plnÃ¡ Å¡Ã­Å™ka */
  .charts-container {
    grid-template-columns: 1fr;
    gap: 10px;
    padding: 8px;
    margin: 12px 0;
    border-radius: 8px;
  }
  
  .chart-card {
    padding: 12px;
    border-radius: 8px;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  .chart-card h3 {
    font-size: 0.9rem;
    margin-bottom: 8px;
  }
  
  .chart-card canvas {
    max-height: 200px;
    min-height: 150px;
  }
  
  /* Taby - vertikÃ¡lnÃ­ layout */
  .tabs {
    flex-direction: row;
    border-bottom: none;
    gap: 0;
    margin: 2px 0;
  }
  
  .tab {
    border-bottom: 1px solid #444;
    padding: 10px 12px;
    text-align: left;
    font-size: 0.9rem;
  }
  
  .tab.active {
    border-left: 3px solid #00d9ff;
    border-bottom: 1px solid #444;
    background: rgba(0, 217, 255, 0.1);
  }
  
  .tab-content {
    padding: 10px 0;
  }
  
  /* Progress bar */
  .progress-bar {
    height: 20px;
    margin: 12px 0;
    border-radius: 10px;
  }
  
  /* Alert */
  .alert {
    padding: 10px;
    margin: 10px 0;
    font-size: 0.9rem;
    border-radius: 6px;
  }
  
  /* Notifikace */
  .notification {
    width: 90%;
    left: 5%;
    right: 5%;
    top: 10px;
    padding: 10px;
    font-size: 0.85rem;
    border-radius: 8px;
  }
  
  /* Fullscreen tlaÄÃ­tko */
  button.fullscreen {
    width: 40px !important;
    height: 40px !important;
    bottom: 10px !important;
    right: 10px !important;
    font-size: 1rem;
  }
}

/* Velmi malÃ© mobily */
@media (max-width: 360px) {
  body {
    padding: 8px 3px;
    font-size: 12px;
  }
  
  h1 {
    font-size: 1.3rem;
  }
  
  h2 {
    font-size: 1.1rem;
  }
  
  .card {
    padding: 10px;
    margin: 0 1px;
  }
  
  .card h3 {
    font-size: 0.95rem;
  }
  
  input, select, textarea {
    padding: 8px 5px;
    font-size: 16px;
  }
  
  button {
    padding: 8px 10px;
    font-size: 0.85rem;
  }
  
  table {
    font-size: 0.6rem;
  }
  
  th, td {
    padding: 2px 1px;
    min-width: 10px;
  }
  
  .stats {
    grid-template-columns: 1fr 1fr 1fr;
    gap: 4px;
  }
  
  .stat-item {
    padding: 5px 5px;
  }
  
  .stat-value {
    font-size: 1rem;
  }
  
  .stat-label {
    font-size: 0.6em;
  }
  
  .charts-container {
    padding: 4px;
    gap: 4px;
  }
  
  .chart-card {
    padding: 10px;
  }
  
  .chart-card h3 {
    font-size: 0.85rem;
  }
  
  .chart-card canvas {
    max-height: 180px;
  }
  
  .tab {
    padding: 8px 10px;
    font-size: 0.85rem;
  }
  
  button.fullscreen {
    width: 35px !important;
    height: 35px !important;
    font-size: 0.9rem;
  }
}

/* Landscape orientace na mobilech */
@media (max-width: 768px) and (orientation: landscape) {
  .dashboard {
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  }
  
  .charts-container {
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  }
  
  .stats {
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
  }
  
  .chart-card canvas {
    max-height: 180px;
  }
  
  /* Optimalizace pro landscape - vÃ­ce horizontÃ¡lnÃ­ho prostoru */
  .stats {
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  }
  
  .card {
    padding: 10px 15px;
  }
  
  h1, h2 {
    margin: 8px 0;
  }
}

/* Portrait orientace na mobilech */
@media (max-width: 768px) and (orientation: portrait) {
  body {
    padding: 15px 8px;
  }
  
  .container {
    max-width: 100%;
    padding: 0 3px;
  }
  
  /* VertikÃ¡lnÃ­ layout pro portrait */
  .dashboard {
    grid-template-columns: 1fr;
    gap: 12px;
  }
  
  .charts-container {
    grid-template-columns: 1fr;
    gap: 10px;
    padding: 10px;
  }
  
  .chart-card {
    padding: 15px 10px;
  }
  
  .chart-card canvas {
    max-height: 220px;
    min-height: 160px;
  }
  
  /* Statistiky v portrait - 3 sloupce */
  .stats {
    grid-template-columns: 1fr 1fr 1fr;
    gap: 8px;
  }
  
  .stat-item {
    padding: 5px 5px;
    text-align: center;
  }
  
  .stat-value {
    font-size: 1.2em;
    display: block;
  }
  
  .stat-label {
    font-size: 0.7em;
    margin-top: 3px;
  }
  
  /* Tabulky v portrait - vÃ­ce vertikÃ¡lnÃ­ho prostoru */
  table {
    max-height: 300px;
    overflow-y: auto;
    display: block;
  }
  
  /* FormulÃ¡Å™e optimalizovanÃ© pro portrait */
  .form-group {
    margin: 10px 0;
  }
  
  input, select, textarea {
    width: 100%;
    padding: 12px 8px;
  }
  
  button {
    min-height: 5px; /* DoporuÄenÃ¡ minimÃ¡lnÃ­ vÃ½Å¡ka pro dotyk */
        padding: 0px 0px; /* VÄ›tÅ¡Ã­ padding pro snadnÄ›jÅ¡Ã­ dotyk */
        display: inline-flex; /* ZajistÃ­, Å¾e text je vycentrovanÃ½ vertikÃ¡lnÄ› */
        align-items: center;
        justify-content: center;
  }
  
  /* Taby ve vertikÃ¡lnÃ­m layoutu */
  .tabs {
    flex-direction: row;
    margin: 2px 0;
  }
  
  .tab {
    width: 100%;
    text-align: left;
    padding: 12px 15px;
    border-bottom: 1px solid #444;
  }
  
  .tab.active {
    border-left: 4px solid #00d9ff;
    background: rgba(0, 217, 255, 0.1);
  }
}

/* MalÃ© mobily v portrait orientaci */
@media (max-width: 480px) and (orientation: portrait) {
  body {
    padding: 10px 5px;
  }
  
  h1 {
    font-size: 1.4rem;
    text-align: center;
    margin: 8px 0;
  }
  
  h2 {
    font-size: 1.1rem;
    text-align: center;
    margin: 6px 0;
  }
  
  .card {
    padding: 10px;
    margin: 0 2px 8px 2px;
  }
  
  .charts-container {
    padding: 8px 5px;
    gap: 8px;
  }
  
  .chart-card {
    padding: 12px 8px;
  }
  
  .chart-card canvas {
    max-height: 200px;
    min-height: 140px;
  }
  
  /* Extra kompaktnÃ­ statistiky */
  .stats {
    grid-template-columns: 2fr 2fr 2fr;
    gap: 5px;
  }
  
  .stat-item {
    padding: 2px 2px;
  }
  
  .stat-value {
    font-size: 1.1em;
  }
  
  .stat-label {
    font-size: 0.65em;
  }
  
  /* Tabulky s extra scroll moÅ¾nostmi */
  table {
    font-size: 0.6rem;
    max-height: 2500px;
    overflow: auto;
  }
  
  th, td {
    padding: 2px 2px;
    min-width: 5px;
  }
}

/* Velmi malÃ© mobily v portrait */
@media (max-width: 360px) and (orientation: portrait) {
  body {
    padding: 8px 3px;
  }
  
  .container {
    padding: 0 1px;
  }
  
  .card {
    padding: 8px;
    margin: 0 1px 6px 1px;
  }
  
  .charts-container {
    padding: 6px 3px;
    gap: 6px;
  }
  
  .chart-card {
    padding: 10px 6px;
  }
  
  .chart-card h3 {
    font-size: 0.9rem;
    margin-bottom: 6px;
  }
  
  .chart-card canvas {
    max-height: 170px;
    min-height: 120px;
  }
  
  .stats {
    gap: 3px;
  }
  
  .stat-item {
    padding: 6px 4px;
  }
  
  .stat-value {
    font-size: 1rem;
  }
  
  .stat-label {
    font-size: 0.6em;
  }
  
  table {
    font-size: 0.6rem;
    max-height: 2500px;
    overflow: auto;
  }
  
  th, td {
    padding: 2px 1px;
    min-width: 2px;
  }
  
  button {
    min-height: 5px; /* DoporuÄenÃ¡ minimÃ¡lnÃ­ vÃ½Å¡ka pro dotyk */
        padding: 0px 0px; /* VÄ›tÅ¡Ã­ padding pro snadnÄ›jÅ¡Ã­ dotyk */
        display: inline-flex; /* ZajistÃ­, Å¾e text je vycentrovanÃ½ vertikÃ¡lnÄ› */
        align-items: center;
        justify-content: center;
  }
  
  input, select, textarea {
    padding: 2px 2px;
  }
}

/* Touch-friendly Ãºpravy */
@media (pointer: coarse) {
  button {
    min-height: 5px; /* DoporuÄenÃ¡ minimÃ¡lnÃ­ vÃ½Å¡ka pro dotyk */
        padding: 0px 0px; /* VÄ›tÅ¡Ã­ padding pro snadnÄ›jÅ¡Ã­ dotyk */
        display: inline-flex; /* ZajistÃ­, Å¾e text je vycentrovanÃ½ vertikÃ¡lnÄ› */
        align-items: center;
        justify-content: center;
  }
  
  input, select, textarea {
    min-height: 44px;
    padding: 12px;
  }
  
  .tab {
    min-height: 44px;
    display: flex;
    align-items: center;
  }
  
  table th, table td {
    min-height: 5x;
    padding: 2px 2px;
  }
}
table td button { /* Tato pravidla pÅ™epÃ­Å¡Ã­ ty vÃ½Å¡e definovanÃ© pro 768px a mÃ©nÄ› */
        min-height: 5px; /* DoporuÄenÃ¡ minimÃ¡lnÃ­ vÃ½Å¡ka pro dotyk */
        padding: 0px 0px; /* VÄ›tÅ¡Ã­ padding pro snadnÄ›jÅ¡Ã­ dotyk */
        display: inline-flex; /* ZajistÃ­, Å¾e text je vycentrovanÃ½ vertikÃ¡lnÄ› */
        align-items: center;
        justify-content: center;
    }
}
      /* ===== SPECIFICKÃ‰ ÃšPRAVY PRO BUTTON.DANGER A BUTTON.SUCCESS V @MEDIA ===== */

/* Tablety a menÅ¡Ã­ desktopy */
@media (max-width: 1024px) {
    button.danger,
    button.success, button {
        min-height: 5px; /* DoporuÄenÃ¡ minimÃ¡lnÃ­ vÃ½Å¡ka pro dotyk */
        padding: 0px 0px; /* VÄ›tÅ¡Ã­ padding pro snadnÄ›jÅ¡Ã­ dotyk */
        display: inline-flex; /* ZajistÃ­, Å¾e text je vycentrovanÃ½ vertikÃ¡lnÄ› */
        align-items: center;
        justify-content: center;
    }
}

/* VÄ›tÅ¡Ã­ mobily a malÃ© tablety */
@media (max-width: 768px) {
    button.danger,
    button.success, button {
        min-height: 5px; /* DoporuÄenÃ¡ minimÃ¡lnÃ­ vÃ½Å¡ka pro dotyk */
        padding: 0px 0px; /* VÄ›tÅ¡Ã­ padding pro snadnÄ›jÅ¡Ã­ dotyk */
        display: inline-flex; /* ZajistÃ­, Å¾e text je vycentrovanÃ½ vertikÃ¡lnÄ› */
        align-items: center;
        justify-content: center;
    }
}

/* StandardnÃ­ mobily */
@media (max-width: 480px) {
    button.danger,
    button.success, button {
        min-height: 5px; /* DoporuÄenÃ¡ minimÃ¡lnÃ­ vÃ½Å¡ka pro dotyk */
        padding: 0px 0px; /* VÄ›tÅ¡Ã­ padding pro snadnÄ›jÅ¡Ã­ dotyk */
        display: inline-flex; /* ZajistÃ­, Å¾e text je vycentrovanÃ½ vertikÃ¡lnÄ› */
        align-items: center;
        justify-content: center;
    }
}

/* Velmi malÃ© mobily */
@media (max-width: 360px) {
    button.danger,
    button.success, button {
        min-height: 5px; /* DoporuÄenÃ¡ minimÃ¡lnÃ­ vÃ½Å¡ka pro dotyk */
        padding: 0px 0px; /* VÄ›tÅ¡Ã­ padding pro snadnÄ›jÅ¡Ã­ dotyk */
        display: inline-flex; /* ZajistÃ­, Å¾e text je vycentrovanÃ½ vertikÃ¡lnÄ› */
        align-items: center;
        justify-content: center;
    }
}

/* Touch-friendly Ãºpravy (platÃ­ pro zaÅ™Ã­zenÃ­ s dotykovÃ½m ovlÃ¡dÃ¡nÃ­m) */
/* Tato pravidla zajistÃ­, Å¾e tlaÄÃ­tka majÃ­ dostateÄnou dotykovou plochu */
@media (pointer: coarse) {
    button.danger,
    button.success, button {
        min-height: 5px; /* DoporuÄenÃ¡ minimÃ¡lnÃ­ vÃ½Å¡ka pro dotyk */
        padding: 0px 0px; /* VÄ›tÅ¡Ã­ padding pro snadnÄ›jÅ¡Ã­ dotyk */
        display: inline-flex; /* ZajistÃ­, Å¾e text je vycentrovanÃ½ vertikÃ¡lnÄ› */
        align-items: center;
        justify-content: center;
    }
}
/* ===== FULLSCREEN REÅ½IM OPTIMALIZACE ===== */

/* Fullscreen detekce pro vÅ¡echny browsery */
:fullscreen table,
:-webkit-full-screen table,
:-moz-full-screen table,
:-ms-fullscreen table {
  width: 100%;
  height: 900vh; /* 80% vÃ½Å¡ky obrazovky */
  max-height: none;
  font-size: 1rem;
  display: table;
  overflow: auto;
  border-radius: 0;
  margin: 0;
}

:fullscreen th,
:-webkit-full-screen th,
:-moz-full-screen th,
:-ms-fullscreen th {
  padding: 12px 8px;
  font-size: 1rem;
  position: sticky;
  top: 0;
  background: #0d1117;
  z-index: 100;
  border-bottom: 2px solid #00d9ff;
}

:fullscreen td,
:-webkit-full-screen td,
:-moz-full-screen td,
:-ms-fullscreen td {
  padding: 10px 8px;
  font-size: 0.95rem;
  white-space: normal;
  min-width: auto;
  max-width: none;
}

/* Fullscreen container optimalizace */
:fullscreen .container,
:-webkit-full-screen .container,
:-moz-full-screen .container,
:-ms-fullscreen .container {
  max-width: 100%;
  padding: 20px;
  height: 900vh;
  overflow-y: auto;
}

:fullscreen .card,
:-webkit-full-screen .card,
:-moz-full-screen .card,
:-ms-fullscreen .card {
  margin: 10px 0;
  padding: 20px;
  height: auto;
  min-height: auto;
}

/* Fullscreen dashboard optimalizace */
:fullscreen .dashboard,
:-webkit-full-screen .dashboard,
:-moz-full-screen .dashboard,
:-ms-fullscreen .dashboard {
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 20px;
  height: auto;
}

/* Fullscreen grafy optimalizace */
:fullscreen .charts-container,
:-webkit-full-screen .charts-container,
:-moz-full-screen .charts-container,
:-ms-fullscreen .charts-container {
  grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
  gap: 25px;
  padding: 25px;
  height: auto;
}

:fullscreen .chart-card,
:-webkit-full-screen .chart-card,
:-moz-full-screen .chart-card,
:-ms-fullscreen .chart-card {
  padding: 25px;
  min-height: 400px;
}

:fullscreen .chart-card canvas,
:-webkit-full-screen .chart-card canvas,
:-moz-full-screen .chart-card canvas,
:-ms-fullscreen .chart-card canvas {
  max-height: 350px;
  min-height: 300px;
}

/* Fullscreen statistiky */
:fullscreen .stats,
:-webkit-full-screen .stats,
:-moz-full-screen .stats,
:-ms-fullscreen .stats {
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
}

:fullscreen .stat-item,
:-webkit-full-screen .stat-item,
:-moz-full-screen .stat-item,
:-ms-fullscreen .stat-item {
  padding: 20px 15px;
}

:fullscreen .stat-value,
:-webkit-full-screen .stat-value,
:-moz-full-screen .stat-value,
:-ms-fullscreen .stat-value {
  font-size: 2em;
}

:fullscreen .stat-label,
:-webkit-full-screen .stat-label,
:-moz-full-screen .stat-label,
:-ms-fullscreen .stat-label {
  font-size: 1em;
}

/* Fullscreen typography */
:fullscreen h1,
:-webkit-full-screen h1,
:-moz-full-screen h1,
:-ms-fullscreen h1 {
  font-size: 2.5rem;
  margin: 20px 0;
}

:fullscreen h2,
:-webkit-full-screen h2,
:-moz-full-screen h2,
:-ms-fullscreen h2 {
  font-size: 2rem;
  margin: 15px 0;
}

:fullscreen h3,
:-webkit-full-screen h3,
:-moz-full-screen h3,
:-ms-fullscreen h3 {
  font-size: 1.5rem;
}

/* Fullscreen formulÃ¡Å™e */
:fullscreen input,
:-webkit-full-screen input,
:-moz-full-screen input,
:-ms-fullscreen input,
:fullscreen select,
:-webkit-full-screen select,
:-moz-full-screen select,
:-ms-fullscreen select,
:fullscreen textarea,
:-webkit-full-screen textarea,
:-moz-full-screen textarea,
:-ms-fullscreen textarea {
  padding: 15px 12px;
  font-size: 1rem;
}

:fullscreen button,
:-webkit-full-screen button,
:-moz-full-screen button,
:-ms-fullscreen button {
  padding: 15px 25px;
  font-size: 1rem;
  margin: 8px;
}

/* Fullscreen taby */
:fullscreen .tabs,
:-webkit-full-screen .tabs,
:-moz-full-screen .tabs,
:-ms-fullscreen .tabs {
  margin: 25px 0;
}

:fullscreen .tab,
:-webkit-full-screen .tab,
:-moz-full-screen .tab,
:-ms-fullscreen .tab {
  padding: 15px 25px;
  font-size: 1.1rem;
}

/* Fullscreen na mobilech - speciÃ¡lnÃ­ pÅ™Ã­pady */
@media (max-width: 768px) {
  :fullscreen table,
  :-webkit-full-screen table,
  :-moz-full-screen table,
  :-ms-fullscreen table {
    height: 900vh;
    font-size: 0.9rem;
  }
  
  :fullscreen .dashboard,
  :-webkit-full-screen .dashboard,
  :-moz-full-screen .dashboard,
  :-ms-fullscreen .dashboard {
    grid-template-columns: 1fr;
  }
  
  :fullscreen .charts-container,
  :-webkit-full-screen .charts-container,
  :-moz-full-screen .charts-container,
  :-ms-fullscreen .charts-container {
    grid-template-columns: 1fr;
    padding: 15px;
  }
  
  :fullscreen .chart-card,
  :-webkit-full-screen .chart-card,
  :-moz-full-screen .chart-card,
  :-ms-fullscreen .chart-card {
    min-height: 300px;
    padding: 20px;
  }
}

/* Fullscreen scrollbar styling pro lepÅ¡Ã­ UX */
:fullscreen ::-webkit-scrollbar,
:-webkit-full-screen ::-webkit-scrollbar,
:-moz-full-screen ::-webkit-scrollbar,
:-ms-fullscreen ::-webkit-scrollbar {
  width: 12px;
}

:fullscreen ::-webkit-scrollbar-track,
:-webkit-full-screen ::-webkit-scrollbar-track,
:-moz-full-screen ::-webkit-scrollbar-track,
:-ms-fullscreen ::-webkit-scrollbar-track {
  background: #1f2633;
}

:fullscreen ::-webkit-scrollbar-thumb,
:-webkit-full-screen ::-webkit-scrollbar-thumb,
:-moz-full-screen ::-webkit-scrollbar-thumb,
:-ms-fullscreen ::-webkit-scrollbar-thumb {
  background: #00d9ff;
  border-radius: 6px;
}

:fullscreen ::-webkit-scrollbar-thumb:hover,
:-webkit-full-screen ::-webkit-scrollbar-thumb:hover,
:-moz-full-screen ::-webkit-scrollbar-thumb:hover,
:-ms-fullscreen ::-webkit-scrollbar-thumb:hover {
  background: #00b8cc;
}
Â  </style>
</head>
<body>
Â  <div class="container">
Â  Â  <h1>ğŸ–– PokroÄilÃ½ vÃ¡hovÃ½ tracker vÃ­ce admirÃ¡la JiÅ™Ã­ka</h1>
Â  Â Â 
Â  Â  <div class="notification" id="notification"></div>
Â  Â  <div class="alert" id="bmiAlert"></div>
Â  Â Â 
Â  Â  <div class="tabs">
Â  Â  Â  <div class="tab active" onclick="showTab('dashboard')">Dashboard</div>
Â  Â  Â  <div class="tab" onclick="showTab('add-entry')">NovÃ½ zÃ¡znam</div>
Â  Â  Â  <div class="tab" onclick="showTab('goals')">CÃ­le</div>
Â  Â  Â  <div class="tab" onclick="showTab('settings')">NastavenÃ­</div>
Â  Â  Â  <div class="tab" onclick="showTab('export')">Export/Import</div>
Â  Â  </div>

Â  Â  <div id="dashboard" class="tab-content active">
Â  Â  Â  <div class="stats">
Â  Â  Â  Â  <div class="stat-item">
Â  Â  Â  Â  Â  <div class="stat-value" id="currentWeight">-</div>
Â  Â  Â  Â  Â  <div class="stat-label">AktuÃ¡lnÃ­ vÃ¡ha (kg)</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="stat-item">
Â  Â  Â  Â  Â  <div class="stat-value" id="currentBMI">-</div>
Â  Â  Â  Â  Â  <div class="stat-label">AktuÃ¡lnÃ­ BMI</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="stat-item">
Â  Â  Â  Â  Â  <div class="stat-value" id="weightChange">-</div>
Â  Â  Â  Â  Â  <div class="stat-label">ZmÄ›na vÃ¡hy (kg)</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â <div class="stat-item">
Â  Â  Â  Â  Â  <div class="stat-value" id="currentBodyWater">-</div>
Â  Â  Â  Â  Â  <div class="stat-label">Voda v tÄ›le (%)</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="stat-item">
Â  Â  Â  Â  Â  <div class="stat-value" id="lastManualBMR">-</div>
Â  Â  Â  Â  Â  <div class="stat-label">Posl. zadanÃ½ BMR</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="stat-item">
Â  Â  Â  Â  Â  <div class="stat-value" id="lastManualAMR">-</div>
Â  Â  Â  Â  Â  <div class="stat-label">Posl. zadanÃ½ AMR</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â <div class="stat-item">
Â  Â  Â  Â  Â  <div class="stat-value" id="theoreticalBMR">-</div>
Â  Â  Â  Â  Â  <div class="stat-label">TeoretickÃ½ BMR</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="stat-item">
Â  Â  Â  Â  Â  <div class="stat-value" id="theoreticalAMR">-</div>
Â  Â  Â  Â  Â  <div class="stat-label">TeoretickÃ½ AMR</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="stat-item">
Â  Â  Â  Â  Â  <div class="stat-value" id="goalProgress">-</div>
Â  Â  Â  Â  Â  <div class="stat-label">Pokrok k cÃ­li (%)</div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div id="goalProgressBarCard" class="card" style="display:none; margin-bottom: 20px;">
Â  Â  Â  Â  <h3>Pokrok k cÃ­li</h3>
Â  Â  Â  Â  <div class="progress-bar">
Â  Â  Â  Â  Â  <div class="progress-fill" id="progressFill"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="goalStatus" style="text-align: center; margin-top: 10px; color: #00d9ff;"></div>
Â  Â  Â  Â  <div id="goalEstimate" class="stat-subtext" style="text-align: center; margin-top: 5px; color: #ccc;">Odhad: ...</div>
Â  Â  Â  Â  <div id="latestEntryDate" style="text-align: center; margin-top: 5px; font-size: 0.9em; color: #aaa;"></div>
Â  Â  Â  </div>

Â  Â  Â  <div class="charts-container">
Â  Â  Â  Â  <div class="chart-card">
Â  Â  Â  Â  Â  <h3>VÃ½voj vÃ¡hy</h3>
Â  Â  Â  Â  Â  <canvas id="weightChart"></canvas>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="chart-card">
Â  Â  Â  Â  Â  <h3>VÃ½voj BMI</h3>
Â  Â  Â  Â  Â  <canvas id="bmiChart"></canvas>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="chart-card">
Â  Â  Â  Â  Â  <h3>VÃ½voj tÄ›lesnÃ©ho tuku (%)</h3>
Â  Â  Â  Â  Â  <canvas id="bodyFatOnlyChart"></canvas>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="chart-card">
Â  Â  Â  Â  Â  <h3>VÃ½voj svalovÃ© hmoty (%)</h3> <canvas id="muscleMassOnlyChart"></canvas>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â <div class="chart-card">
Â  Â  Â  Â  Â  <h3>VÃ½voj vody v tÄ›le</h3>
Â  Â  Â  Â  Â  <canvas id="bodyWaterChart"></canvas>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="chart-card">
Â  Â  Â  Â  Â  <h3>VÃ½voj zadanÃ©ho BMR (kcal)</h3>
Â  Â  Â  Â  Â  <canvas id="manualBMRChart"></canvas>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="chart-card">
Â  Â  Â  Â  Â  <h3>VÃ½voj zadanÃ©ho AMR (kcal)</h3>
Â  Â  Â  Â  Â  <canvas id="manualAMRChart"></canvas>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <table>
Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  <th>#</th>
Â  Â  Â  Â  Â  Â  <th>Datum</th>
Â  Â  Â  Â  Â  Â  <th>VÃ¡ha</th>
Â  Â  Â  Â  Â  Â  <th>RozdÃ­l</th>
Â  Â  Â  Â  Â  Â  <th>BMI</th>
Â  Â  Â  Â  Â  Â  <th>Klasif.</th>
Â  Â  Â  Â  Â  Â  <th>Tuk%</th>
Â  Â  Â  Â  Â  Â  <th>Svaly (%)</th> <th>Voda%</th>
Â  Â  Â  Â  Â  Â  <th>Zad. BMR</th>
Â  Â  Â  Â  Â  Â  <th>Zad. AMR</th>
Â  Â  Â  Â  Â  Â  <th>Pozn.</th>
Â  Â  Â  Â  Â  Â  <th>Akce</th>
Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  </thead>
Â  Â  Â  Â  <tbody id="tableBody"></tbody>
Â  Â  Â  </table>
Â  Â  </div>

Â  Â  <div id="add-entry" class="tab-content">
Â  Â  Â  <div class="card">
Â  Â  Â  Â  <h3>PÅ™idat novÃ½ zÃ¡znam</h3>
Â  Â  Â  Â  <form id="entryForm">
Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="entryDate">Datum:</label>
Â  Â  Â  Â  Â  Â  <input type="date" id="entryDate" required>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="entryWeight">VÃ¡ha (kg):</label>
Â  Â  Â  Â  Â  Â  <input type="number" id="entryWeight" step="0.1" required>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="entryBodyFat">TÄ›lesnÃ½ tuk (%):</label>
Â  Â  Â  Â  Â  Â  <input type="number" id="entryBodyFat" step="0.1" min="0" max="100">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="entryMuscleMass">SvalovÃ¡ hmota (kg):</label>
Â  Â  Â  Â  Â  Â  <input type="number" id="entryMuscleMass" step="0.1" min="0">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="entryBodyWater">Voda v tÄ›le (%):</label>
Â  Â  Â  Â  Â  Â  <input type="number" id="entryBodyWater" step="0.1" min="0" max="100">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="entryManualBMR">RuÄnÄ› zadanÃ© BMR (kcal):</label>
Â  Â  Â  Â  Â  Â  <input type="number" id="entryManualBMR" step="1" min="0">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="entryManualAMR">RuÄnÄ› zadanÃ© AMR (kcal):</label>
Â  Â  Â  Â  Â  Â  <input type="number" id="entryManualAMR" step="1" min="0">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="entryNotes">PoznÃ¡mky:</label>
Â  Â  Â  Â  Â  Â  <textarea id="entryNotes" rows="3"></textarea>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <button type="submit">PÅ™idat zÃ¡znam</button>
Â  Â  Â  Â  </form>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="goals" class="tab-content">
Â  Â  Â  <div class="card">
Â  Â  Â  Â  <h3>NastavenÃ­ cÃ­lÅ¯</h3>
Â  Â  Â  Â  <form id="goalsForm">
Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="targetWeight">CÃ­lovÃ¡ vÃ¡ha (kg):</label>
Â  Â  Â  Â  Â  Â  <input type="number" id="targetWeight" step="0.1">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="targetBMI">CÃ­lovÃ© BMI:</label>
Â  Â  Â  Â  Â  Â  <input type="number" id="targetBMI" step="0.1">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="targetDate">TermÃ­n splnÄ›nÃ­ cÃ­le:</label>
Â  Â  Â  Â  Â  Â  <input type="date" id="targetDate">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="weeklyGoal">TÃ½dennÃ­ zmÄ›na vÃ¡hy (kg) (napÅ™. -0.5 pro hubnutÃ­):</label>
Â  Â  Â  Â  Â  Â  <input type="number" id="weeklyGoal" step="0.1">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <button type="submit">UloÅ¾it cÃ­le</button>
Â  Â  Â  Â  </form>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="recommendations" class="card" style="margin-top: 20px; background: #2a3441;">
Â  Â  Â  Â  Â  <h3>DoporuÄenÃ­</h3>
Â  Â  Â  Â  Â  <div id="recommendationText"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="settings" class="tab-content">
Â  Â  Â  <div class="dashboard">
Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  <h3>OsobnÃ­ Ãºdaje (pro teoretickÃ© vÃ½poÄty)</h3>
Â  Â  Â  Â  Â  <form id="settingsForm">
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  <label for="height">VÃ½Å¡ka (cm):</label>
Â  Â  Â  Â  Â  Â  Â  <input type="number" id="height" min="100" max="250" value="174">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  <label for="age">VÄ›k:</label>
Â  Â  Â  Â  Â  Â  Â  <input type="number" id="age" min="1" max="120">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  <label for="gender">PohlavÃ­:</label>
Â  Â  Â  Â  Â  Â  Â  <select id="gender">
Â  Â  Â  Â  Â  Â  Â  Â  <option value="male">MuÅ¾</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="female">Å½ena</option>
Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  <label for="activityLevel">ÃšroveÅˆ fyzickÃ© aktivity:</label>
Â  Â  Â  Â  Â  Â  Â  <select id="activityLevel">
Â  Â  Â  Â  Â  Â  Â  Â  <option value="1.2">SedavÃ© (mÃ¡lo nebo Å¾Ã¡dnÃ© cviÄenÃ­)</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="1.375">Lehce aktivnÃ­ (cviÄenÃ­ 1-3 dny/tÃ½den)</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="1.55">MÃ­rnÄ› aktivnÃ­ (cviÄenÃ­ 3-5 dnÃ­/tÃ½den)</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="1.725">Velmi aktivnÃ­ (cviÄenÃ­ 6-7 dnÃ­/tÃ½den)</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="1.9">ExtrÃ©mnÄ› aktivnÃ­ (velmi tÄ›Å¾kÃ© cviÄenÃ­, fyzickÃ¡ prÃ¡ce)</option>
Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <button type="submit">UloÅ¾it nastavenÃ­</button>
Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  <h3>BMI hranice</h3>
Â  Â  Â  Â  Â  <form id="bmiAlertsForm">
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  <label for="bmiWarningUpper">HornÃ­ hranice BMI (varovÃ¡nÃ­):</label>
Â  Â  Â  Â  Â  Â  Â  <input type="number" id="bmiWarningUpper" step="0.1" value="25">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  <label for="bmiDangerUpper">HornÃ­ hranice BMI (nebezpeÄÃ­):</label>
Â  Â  Â  Â  Â  Â  Â  <input type="number" id="bmiDangerUpper" step="0.1" value="30">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  <label for="bmiWarningLower">DolnÃ­ hranice BMI (varovÃ¡nÃ­):</label>
Â  Â  Â  Â  Â  Â  Â  <input type="number" id="bmiWarningLower" step="0.1" value="18.5">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <button type="submit">UloÅ¾it hranice</button>
Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="card">
Â  Â  <h3>PÅ™ipomÃ­nky</h3>
Â  Â  <form id="remindersForm">
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="reminderEnabled">Povolit pÅ™ipomÃ­nky:</label>
Â  Â  Â  Â  Â  Â  <input type="checkbox" id="reminderEnabled" style="width: auto;">
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="reminderInterval">Interval pÅ™ipomÃ­nek (dny):</label>
Â  Â  Â  Â  Â  Â  <input type="number" id="reminderInterval" min="1" max="30" value="7">
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <button type="submit">UloÅ¾it pÅ™ipomÃ­nky</button>
Â  Â  Â  Â  <button type="button" onclick="window.requestNotificationPermission()">ğŸ”” Povolit webovÃ¡ upozornÄ›nÃ­</button>
Â  Â  Â  Â  </form>
</div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="export" class="tab-content">
Â  Â  Â  <div class="dashboard">
Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  <h3>Export dat</h3>
Â  Â  Â  Â  Â  <button onclick="exportToCSV()">ğŸ“Š Export do CSV</button>
Â  Â  Â  Â  Â  <button onclick="exportToPDF()">ğŸ“„ Export do PDF</button>
Â  Â  Â  Â  Â  <button onclick="exportChartsAsPDF()">ğŸ“ˆ Export grafÅ¯ do PDF</button>
Â  Â  Â  Â  Â  <button onclick="exportBackup()">ğŸ’¾ ÃšplnÃ¡ zÃ¡loha</button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  <h3>Import dat</h3>
Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="csvImport">Import CSV:</label>
Â  Â  Â  Â  Â  Â  <input type="file" id="csvImport" accept=".csv" onchange="importFromCSV(this)">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label for="backupImport">Obnovit ze zÃ¡lohy:</label>
Â  Â  Â  Â  Â  Â  <input type="file" id="backupImport" accept=".json" onchange="importFromBackup(this)">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <button class="danger" onclick="clearAllData()">ğŸ—‘ï¸ Vymazat vÅ¡echna data</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  Â 
Â  Â  <script>
Â  Â  // GlobÃ¡lnÃ­ promÄ›nnÃ© (deklarace zÅ¯stÃ¡vÃ¡ nahoÅ™e)
Â  Â  let weightChart, bmiChart, bodyFatOnlyChart, muscleMassOnlyChart, bodyWaterChart, manualBMRChart, manualAMRChart;
Â  Â  let weightLog = [];
Â  Â  let settings = {
Â  Â  Â  Â  height: 174,
Â  Â  Â  Â  age: 24,
Â  Â  Â  Â  gender: 'male',
Â  Â  Â  Â  activityLevel: 1.55,
Â  Â  Â  Â  bmiWarningUpper: 25,
Â  Â  Â  Â  bmiDangerUpper: 30,
Â  Â  Â  Â  bmiWarningLower: 18.5,
Â  Â  Â  Â  reminderEnabled: true,
Â  Â  Â  Â  reminderInterval: 7
Â  Â  };
Â  Â  let goals = {
Â  Â  Â  Â  targetWeight: 80,
Â  Â  Â  Â  targetBMI: 24.9,
Â  Â  Â  Â  targetDate: '2026-05-18',
Â  Â  Â  Â  weeklyGoal: null
Â  Â  };

Â  Â  const ACTIVITY_LEVELS = {
Â  Â  Â  Â  SEDENTARY: 1.2,
Â  Â  Â  Â  LIGHT: 1.375,
Â  Â  Â  Â  MODERATE: 1.55,
Â  Â  Â  Â  ACTIVE: 1.725,
Â  Â  Â  Â  VERY_ACTIVE: 1.9
Â  Â  };

Â  Â  // --- Zde zaÄÃ­nÃ¡ JavaScriptovÃ¡ logika tvÃ©ho trackeru ---

Â  Â  // Funkce, kterÃ© jsou volÃ¡ny z HTML atributÅ¯ (onclick, onchange), musÃ­ bÃ½t globÃ¡lnÃ­.
Â  Â  // Proto je pÅ™ipojujeme k objektu window.

Â  Â  window.setTodayDate = function() {
Â  Â  Â  Â  console.log("setTodayDate: Nastavuji dneÅ¡nÃ­ datum pro vstupnÃ­ pole.");
Â  Â  Â  Â  const today = new Date().toISOString().split('T')[0];
Â  Â  Â  Â  document.getElementById('entryDate').value = today;
Â  Â  };

Â  Â  // loadData - NynÃ­ primÃ¡rnÄ› volÃ¡ Firebase funkce, s fallbackem na LocalStorage a vÃ½chozÃ­ data
Â  Â  window.loadData = async function() {
Â  Â  Â  Â  console.log("loadData: SpuÅ¡tÄ›no naÄÃ­tÃ¡nÃ­ vÅ¡ech dat (vÃ¡ha, nastavenÃ­, cÃ­le).");
Â  Â  Â  Â  const savedWeightLog = localStorage.getItem('weightLog_JirikTracker_v2_charts_separated_musclePercent');
Â  Â  Â  Â  const savedSettings = localStorage.getItem('weightSettings_JirikTracker_v2_charts_separated_musclePercent');
Â  Â  Â  Â  const savedGoals = localStorage.getItem('weightGoals_JirikTracker_v2_charts_separated_musclePercent');

Â  Â  Â  Â  let firestoreWeightDataLoaded = false;
Â  Â  Â  Â  let firestoreSettingsDataLoaded = false;
Â  Â  Â  Â  let firestoreGoalsDataLoaded = false;

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  console.log("loadData: PokouÅ¡Ã­m se naÄÃ­st data z Firebase Firestore (weightLog).");
Â  Â  Â  Â  Â  Â  const firestoreWeightData = await window.loadWeightLogFromFirestore();
Â  Â  Â  Â  Â  Â  if (firestoreWeightData && firestoreWeightData.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  weightLog = firestoreWeightData;
Â  Â  Â  Â  Â  Â  Â  Â  firestoreWeightDataLoaded = true;
Â  Â  Â  Â  Â  Â  Â  Â  console.log("loadData: Data weightLog ÃºspÄ›Å¡nÄ› naÄtena z Firebase Firestore.");
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  console.log("loadData: Å½Ã¡dnÃ¡ data weightLog v Firebase Firestore nebo kolekce prÃ¡zdnÃ¡.");
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  console.log("loadData: PokouÅ¡Ã­m se naÄÃ­st nastavenÃ­ z Firebase Firestore.");
Â  Â  Â  Â  Â  Â  const firestoreSettings = await window.loadSettingsFromFirestore();
Â  Â  Â  Â  Â  Â  if (firestoreSettings) {
Â  Â  Â  Â  Â  Â  Â  Â  settings = { ...settings, ...firestoreSettings }; // SlouÄenÃ­ naÄtenÃ½ch nastavenÃ­ s vÃ½chozÃ­mi
Â  Â  Â  Â  Â  Â  Â  Â  firestoreSettingsDataLoaded = true;
Â  Â  Â  Â  Â  Â  Â  Â  console.log("loadData: NastavenÃ­ ÃºspÄ›Å¡nÄ› naÄtena z Firebase Firestore.");
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  console.log("loadData: Å½Ã¡dnÃ¡ nastavenÃ­ v Firebase Firestore nebo dokument neexistuje.");
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  console.log("loadData: PokouÅ¡Ã­m se naÄÃ­st cÃ­le z Firebase Firestore.");
Â  Â  Â  Â  Â  Â  const firestoreGoals = await window.loadGoalsFromFirestore();
Â  Â  Â  Â  Â  Â  if (firestoreGoals) {
Â  Â  Â  Â  Â  Â  Â  Â  goals = { ...goals, ...firestoreGoals }; // SlouÄenÃ­ naÄtenÃ½ch cÃ­lÅ¯ s vÃ½chozÃ­mi
Â  Â  Â  Â  Â  Â  Â  Â  firestoreGoalsDataLoaded = true;
Â  Â  Â  Â  Â  Â  Â  Â  console.log("loadData: CÃ­le ÃºspÄ›Å¡nÄ› naÄteny z Firebase Firestore.");
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  console.log("loadData: Å½Ã¡dnÃ© cÃ­le v Firebase Firestore nebo dokument neexistuje.");
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  console.error("loadData: KritickÃ¡ chyba pÅ™i naÄÃ­tÃ¡nÃ­ dat z Firebase Firestore (pro vÅ¡echny typy).", error);
Â  Â  Â  Â  Â  Â  window.showNotification("Chyba: Data z cloudu nebylo moÅ¾nÃ© naÄÃ­st. PokouÅ¡Ã­m se naÄÃ­st lokÃ¡lnÃ­ data.", 5000);
Â  Â  Â  Â  }

Â  Â  Â  Â  // Fallback pro weightLog
Â  Â  Â  Â  if (!firestoreWeightDataLoaded) {
Â  Â  Â  Â  Â  Â  console.log("loadData: Firestore weightLog nenaÄteno, pokouÅ¡Ã­m se z LocalStorage.");
Â  Â  Â  Â  Â  Â  if (savedWeightLog) {
Â  Â  Â  Â  Â  Â  Â  Â  weightLog = JSON.parse(savedWeightLog);
Â  Â  Â  Â  Â  Â  Â  Â  console.log("loadData: Data weightLog naÄtena z LocalStorage.");
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  console.log("loadData: Å½Ã¡dnÃ¡ data weightLog v LocalStorage. NaÄÃ­tÃ¡m vÃ½chozÃ­ data z kÃ³du.");
Â  Â  Â  Â  Â  Â  Â  Â  // PÅ™Ã­klad dat, aby bylo co zobrazit pÅ™i prvnÃ­m spuÅ¡tÄ›nÃ­
Â  Â  Â  Â  Â  Â  Â  Â  weightLog = [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  //tvoje data prosÃ­m nemazat ani jeden zaznam je to dÅ¯leÅ¾itÃ©??
{ date: "2024-05-25", weight: 133.6, bodyFat: 41.5, muscleMass: 31.0, bodyWater: 40.2, manualBMR: 2665 , manualAMR:3205, notes: "Start" },
{ date: "2024-05-26", weight: 134.0, bodyFat: 41.8, muscleMass: 30.9, bodyWater: 40.0, manualBMR: 2676, manualAMR: 3211, notes: "" },
{ date: "2024-06-01", weight: 134.0, bodyFat: 41.8, muscleMass: 30.9, bodyWater: 40.0, manualBMR: 2671, manualAMR: 3205, notes: "" },
{ date: "2024-06-01", weight: 133.4, bodyFat: 42.0, muscleMass: 30.7, bodyWater: 39.8, manualBMR: 2670, manualAMR: 3194, notes: "" },
{ date: "2024-06-07", weight: 132.2, bodyFat: 41.1, muscleMass: 31.2, bodyWater: 40.4, manualBMR: 2645, manualAMR: 3174, notes: "" },
{ date: "2024-06-08", weight: 131.3, bodyFat: 40.9, muscleMass: 31.3, bodyWater: 40.6, manualBMR: 2632, manualAMR: 3158, notes: "" },
{ date: "2024-06-08", weight: 131.3, bodyFat: 40.7, muscleMass: 31.4, bodyWater: 40.7, manualBMR: 2632, manualAMR: 3158, notes: "" },
{ date: "2024-06-09", weight: 132.2, bodyFat: 42.8, muscleMass: 30.3, bodyWater: 39.3, manualBMR: 2645, manualAMR: 3174, notes: "" },
{ date: "2024-06-11", weight: 131.5, bodyFat: 41.0, muscleMass: 31.2, bodyWater: 40.5, manualBMR: 2635, manualAMR: 3162, notes: "" },
{ date: "2024-06-18", weight: 134.6, bodyFat: 42.2, muscleMass: 30.6, bodyWater: 39.7, manualBMR: 2678, manualAMR: 3213, notes: "" },
{ date: "2024-06-20", weight: 134.4, bodyFat: 42.1, muscleMass: 30.7, bodyWater: 39.8, manualBMR: 2676, manualAMR: 3211, notes: "" },
{ date: "2024-06-20", weight: 134.4, bodyFat: 42.0, muscleMass: 30.7, bodyWater: 39.8, manualBMR: 2676, manualAMR: 3211, notes: "" },
{ date: "2024-06-21", weight: 136.7, bodyFat: 43.0, muscleMass: 30.2, bodyWater: 39.1, manualBMR: 2708, manualAMR: 3249, notes: "" },
{ date: "2024-06-29", weight: 137.3, bodyFat: 43.4, muscleMass: 30.0, bodyWater: 38.9, manualBMR: 2716, manualAMR: 3259, notes: "" },
{ date: "2024-07-03", weight: 136.9, bodyFat: 43.0, muscleMass: 30.2, bodyWater: 39.1, manualBMR: 2711, manualAMR: 3253, notes: "" },
{ date: "2024-07-09", weight: 139.3, bodyFat: 44.0, muscleMass: 29.7, bodyWater: 38.5, manualBMR: 2744, manualAMR: 3292, notes: "" },
{ date: "2024-09-08", weight: 138.6, bodyFat: 43.7, muscleMass: 29.9, bodyWater: 38.7, manualBMR: 2734, manualAMR: 3280, notes: "" },
{ date: "2025-02-16", weight: 145.6, bodyFat: 46.5, muscleMass: 28.3, bodyWater: 36.7, manualBMR: 2831, manualAMR: 3397, notes: "" },
{ date: "2025-04-19", weight: 146.3, bodyFat: 47.0, muscleMass: 28.1, bodyWater: 36.4, manualBMR: 2842, manualAMR: 3410, notes: "" },
{ date: "2025-05-10", weight: 144.2, bodyFat: 45.8, muscleMass: 28.7, bodyWater: 37.2, manualBMR: 2806, manualAMR: 3367, notes: "" },
{ date: "2025-05-13", weight: 141.3, bodyFat: 44.6, muscleMass: 29.3, bodyWater: 38.0, manualBMR: 2765, manualAMR: 3318, notes: "" },
{ date: "2025-05-18", weight: 138.8, bodyFat: 43.7, muscleMass: 29.3, bodyWater: 38.7, manualBMR: 2731, manualAMR: 3277, notes: "" },
{ date: "2025-05-19", weight: 139.3, bodyFat: 45.8, muscleMass: 28.7, bodyWater: 37.2, manualBMR: 2728, manualAMR: 3273, notes: "" },
{ date: "2025-05-20", weight: 138.5, bodyFat: 45.5, muscleMass: 28.9, bodyWater: 37.4, manualBMR: 2716, manualAMR: 3259, notes: "" },Â Â 
{ date: "2025-05-21", weight: 138.3, bodyFat: 45.4, muscleMass: 29.0, bodyWater: 37.5, manualBMR: 2713, manualAMR: 3255, notes: "" },Â Â 
{ date: "2025-05-22", weight: 139.2, bodyFat: 45.7, muscleMass: 28.8, bodyWater: 37.3, manualBMR: 2725, manualAMR: 3270, notes: "" },Â 
{ date: "2025-05-23", weight: 139.2, bodyFat: 45.9, muscleMass: 28.7, bodyWater: 37.1, manualBMR: 2725, manualAMR: 3270, notes: "" },Â Â 
{ date: "2025-05-24", weight: 139.7, bodyFat: 46.0, muscleMass: 28.7, bodyWater: 37.1, manualBMR: 2733, manualAMR: 3270, notes: "" },Â  Â  Â  Â  Â 
{ date: "2025-05-25", weight: 140.3, bodyFat: 46.2, muscleMass: 28.5, bodyWater: 36.9, manualBMR: 2741, manualAMR: 3279, notes: "" },Â  Â Â 
{ date: "2025-05-31", weight: 140.0, bodyFat: 46.2, muscleMass: 28.7, bodyWater: 37.1, manualBMR: 2737, manualAMR: 3289, notes: "" },Â  Â  Â  Â Â 
{ date: "2025-06-01", weight: 140.0, bodyFat: 46.2, muscleMass: 28.5, bodyWater: 36.9, manualBMR: 2737, manualAMR: 3289, notes: "" },
Â  Â  Â  Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  Â  Â  Â  console.log("loadData: NaÄtena vÃ½chozÃ­ data z kÃ³du.");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // NaÄÃ­tÃ¡nÃ­ settings a goals z LocalStorage, pokud nejsou z Firestore
Â  Â  Â  Â  if (!firestoreSettingsDataLoaded) { // Pokud settings nebyly naÄteny z Firestore
Â  Â  Â  Â  Â  Â  console.log("loadData: Firestore nastavenÃ­ nenaÄteno, pokouÅ¡Ã­m se z LocalStorage.");
Â  Â  Â  Â  Â  Â  if (savedSettings) {
Â  Â  Â  Â  Â  Â  Â  Â  settings = { ...settings, ...JSON.parse(savedSettings) };
Â  Â  Â  Â  Â  Â  Â  Â  console.log("loadData: NastavenÃ­ naÄtena z LocalStorage.");
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  console.log("loadData: Å½Ã¡dnÃ¡ nastavenÃ­ v LocalStorage. PouÅ¾Ã­vÃ¡m vÃ½chozÃ­.");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  console.log("loadData: NastavenÃ­ jiÅ¾ naÄtena z Firestore, pÅ™eskoÄeno LocalStorage.");
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (!firestoreGoalsDataLoaded) { // Pokud goals nebyly naÄteny z Firestore
Â  Â  Â  Â  Â  Â  console.log("loadData: Firestore cÃ­le nenaÄteny, pokouÅ¡Ã­m se z LocalStorage.");
Â  Â  Â  Â  Â  Â  if (savedGoals) {
Â  Â  Â  Â  Â  Â  Â  Â  goals = { ...goals, ...JSON.parse(savedGoals) };
Â  Â  Â  Â  Â  Â  Â  Â  console.log("loadData: CÃ­le naÄteny z LocalStorage.");
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  console.log("loadData: Å½Ã¡dnÃ© cÃ­le v LocalStorage. PouÅ¾Ã­vÃ¡m vÃ½chozÃ­.");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  console.log("loadData: CÃ­le jiÅ¾ naÄteny z Firestore, pÅ™eskoÄeno LocalStorage.");
Â  Â  Â  Â  }

Â  Â  Â  Â  settings.activityLevel = parseFloat(settings.activityLevel) || 1.55;
Â  Â  Â  Â  console.log("loadData: DokonÄeno naÄÃ­tÃ¡nÃ­ dat. Aktualizuji formulÃ¡Å™e.");
Â  Â  Â  Â  window.updateForms(); // VolÃ¡me globÃ¡lnÃ­ updateForms()

Â  Â  Â  Â  // PrvotnÃ­ uloÅ¾enÃ­ dat do Firebase, pokud byla naÄtena z LocalStorage nebo kÃ³du
Â  Â  Â  Â  // a nejsou jiÅ¾ ve Firestore.
Â  Â  Â  Â  if (!firestoreWeightDataLoaded && (weightLog.length > 0 || savedWeightLog)) {
Â  Â  Â  Â  Â  Â  console.log("loadData: DetekovÃ¡na chybÄ›jÃ­cÃ­ data weightLog ve Firestore. UklÃ¡dÃ¡m aktuÃ¡lnÃ­ data do cloudu.");
Â  Â  Â  Â  Â  Â  await window.saveData(); // UloÅ¾Ã­ aktuÃ¡lnÃ­ weightLog, settings, goals do Firestore
Â  Â  Â  Â  } else if (!firestoreSettingsDataLoaded && savedSettings) {
Â  Â  Â  Â  Â  Â  console.log("loadData: DetekovÃ¡na chybÄ›jÃ­cÃ­ nastavenÃ­ ve Firestore. UklÃ¡dÃ¡m aktuÃ¡lnÃ­ nastavenÃ­ do cloudu.");
Â  Â  Â  Â  Â  Â  await window.saveData(); // UloÅ¾Ã­ aktuÃ¡lnÃ­ weightLog, settings, goals do Firestore
Â  Â  Â  Â  } else if (!firestoreGoalsDataLoaded && savedGoals) {
Â  Â  Â  Â  Â  Â  console.log("loadData: DetekovÃ¡ny chybÄ›jÃ­cÃ­ cÃ­le ve Firestore. UklÃ¡dÃ¡m aktuÃ¡lnÃ­ cÃ­le do cloudu.");
Â  Â  Â  Â  Â  Â  await window.saveData(); // UloÅ¾Ã­ aktuÃ¡lnÃ­ weightLog, settings, goals do Firestore
Â  Â  Â  Â  }
Â  Â  Â  Â  console.log("loadData: NaÄÃ­tÃ¡nÃ­ dat dokonÄeno pro vÅ¡echny zdroje.");
Â  Â  };

Â  Â  // saveData - NynÃ­ uklÃ¡dÃ¡ do LocalStorage a Firebase
Â  Â  window.saveData = async function() {
Â  Â  Â  Â  console.log("saveData: SpuÅ¡tÄ›no uklÃ¡dÃ¡nÃ­ vÅ¡ech dat (vÃ¡ha, nastavenÃ­, cÃ­le) do LocalStorage a Firebase.");
Â  Â  Â  Â  localStorage.setItem('weightLog_JirikTracker_v2_charts_separated_musclePercent', JSON.stringify(weightLog));
Â  Â  Â  Â  localStorage.setItem('weightSettings_JirikTracker_v2_charts_separated_musclePercent', JSON.stringify(settings));
Â  Â  Â  Â  localStorage.setItem('weightGoals_JirikTracker_v2_charts_separated_musclePercent', JSON.stringify(goals));
Â  Â  Â  Â  console.log("saveData: Data ÃºspÄ›Å¡nÄ› uloÅ¾ena do LocalStorage.");

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  // UklÃ¡dÃ¡me weightLog do Firebase Firestore
Â  Â  Â  Â  Â  Â  console.log("saveData: PokouÅ¡Ã­m se uloÅ¾it weightLog do Firebase Firestore.");
Â  Â  Â  Â  Â  Â  // Tato funkce (window.saveWeightLogToFirestore) je definovÃ¡na v firebaseFunctions.js
Â  Â  Â  Â  Â  Â  await window.saveWeightLogToFirestore(weightLog);
Â  Â  Â  Â  Â  Â  console.log("saveData: Data weightLog ÃºspÄ›Å¡nÄ› uloÅ¾ena do Firebase Firestore.");
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // UklÃ¡dÃ¡me settings do Firebase Firestore
Â  Â  Â  Â  Â  Â  console.log("saveData: PokouÅ¡Ã­m se uloÅ¾it nastavenÃ­ do Firebase Firestore.");
Â  Â  Â  Â  Â  Â  await window.saveSettingsToFirestore(settings);
Â  Â  Â  Â  Â  Â  console.log("saveData: NastavenÃ­ ÃºspÄ›Å¡nÄ› uloÅ¾ena do Firebase Firestore.");

Â  Â  Â  Â  Â  Â  // UklÃ¡dÃ¡me goals do Firebase Firestore
Â  Â  Â  Â  Â  Â  console.log("saveData: PokouÅ¡Ã­m se uloÅ¾it cÃ­le do Firebase Firestore.");
Â  Â  Â  Â  Â  Â  await window.saveGoalsToFirestore(goals);
Â  Â  Â  Â  Â  Â  console.log("saveData: CÃ­le ÃºspÄ›Å¡nÄ› uloÅ¾eny do Firebase Firestore.");

Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  console.error("saveData: NepodaÅ™ilo se uloÅ¾it data do Firebase Firestore:", error);
Â  Â  Â  Â  Â  Â  window.showNotification("Chyba: Data se nepodaÅ™ilo uloÅ¾it do cloudu!", 4000);
Â  Â  Â  Â  }
Â  Â  Â  Â  console.log("saveData: UklÃ¡dÃ¡nÃ­ dat dokonÄeno pro vÅ¡echny cÃ­le.");
Â  Â  };

Â  Â  window.updateForms = function() {
Â  Â  Â  Â  console.log("updateForms: Aktualizuji hodnoty formulÃ¡Å™ovÃ½ch polÃ­.");
Â  Â  Â  Â  document.getElementById('height').value = settings.height || '';
Â  Â  Â  Â  document.getElementById('age').value = settings.age || '';
Â  Â  Â  Â  document.getElementById('gender').value = settings.gender || 'male';
Â  Â  Â  Â  document.getElementById('activityLevel').value = settings.activityLevel || '1.55';
Â  Â  Â  Â  document.getElementById('bmiWarningUpper').value = settings.bmiWarningUpper || '';
Â  Â  Â  Â  document.getElementById('bmiDangerUpper').value = settings.bmiDangerUpper || '';
Â  Â  Â  Â  document.getElementById('bmiWarningLower').value = settings.bmiWarningLower || '';
Â  Â  Â  Â  document.getElementById('reminderEnabled').checked = settings.reminderEnabled === true;
Â  Â  Â  Â  document.getElementById('reminderInterval').value = settings.reminderInterval || 7;

Â  Â  Â  Â  document.getElementById('targetWeight').value = goals.targetWeight || '';
Â  Â  Â  Â  document.getElementById('targetBMI').value = goals.targetBMI || '';
Â  Â  Â  Â  document.getElementById('targetDate').value = goals.targetDate || '';
Â  Â  Â  Â  document.getElementById('weeklyGoal').value = goals.weeklyGoal || '';
Â  Â  Â  Â  console.log("updateForms: FormulÃ¡Å™e aktualizovÃ¡ny.");
Â  Â  };

Â  Â  window.calculateBMI = function(weight, height) {
Â  Â  Â  Â  // console.log("calculateBMI: PoÄÃ­tÃ¡m BMI."); // Velmi ÄastÃ© volÃ¡nÃ­, mÅ¯Å¾e zahltit log
Â  Â  Â  Â  if (!height || height <=0 || !weight || weight <=0) return 0;
Â  Â  Â  Â  const heightInMeters = height / 100;
Â  Â  Â  Â  return weight / (heightInMeters * heightInMeters);
Â  Â  };

Â  Â  window.calculateBMR = function(weight, height, age, gender) {
Â  Â  Â  Â  // console.log("calculateBMR: PoÄÃ­tÃ¡m BMR."); // Velmi ÄastÃ© volÃ¡nÃ­
Â  Â  Â  Â  if (!weight || !height || !age || !gender) return 0;
Â  Â  Â  Â  if (gender === 'male') {
Â  Â  Â  Â  Â  Â  return (10 * weight) + (6.25 * height) - (5 * age) + 5;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  return (10 * weight) + (6.25 * height) - (5 * age) - 161;
Â  Â  Â  Â  }
Â  Â  };

Â  Â  window.calculateAMR = function(bmr, activityLevel) {
Â  Â  Â  Â  // console.log("calculateAMR: PoÄÃ­tÃ¡m AMR."); // Velmi ÄastÃ© volÃ¡nÃ­
Â  Â  Â  Â  if (!bmr || !activityLevel) return 0;
Â  Â  Â  Â  return bmr * activityLevel;
Â  Â  };

Â  Â  window.classifyBMI = function(bmi) {
Â  Â  Â  Â  // console.log("classifyBMI: Klasifikuji BMI."); // Velmi ÄastÃ© volÃ¡nÃ­
Â  Â  Â  Â  if (bmi === 0) return { class: '', text: '-' };
Â  Â  Â  Â  if (bmi < 18.5) return { class: 'bmi-underweight', text: 'PodvÃ¡ha' };
Â  Â  Â  Â  if (bmi < 25) return { class: 'bmi-normal', text: 'NormÃ¡lnÃ­' };
Â  Â  Â  Â  if (bmi < 30) return { class: 'bmi-overweight', text: 'NadvÃ¡ha' };
Â  Â  Â  Â  return { class: 'bmi-obese', text: 'Obezita' };
Â  Â  };

Â  Â  window.checkBMIAlert = function(bmi) {
Â  Â  Â  Â  console.log("checkBMIAlert: Kontroluji BMI pro upozornÄ›nÃ­.");
Â  Â  Â  Â  const alertEl = document.getElementById('bmiAlert');
Â  Â  Â  Â  if (bmi === 0) {
Â  Â  Â  Â  Â  Â  alertEl.className = 'alert';
Â  Â  Â  Â  Â  Â  console.log("checkBMIAlert: BMI je 0, upozornÄ›nÃ­ skryto.");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  if (bmi > settings.bmiDangerUpper) {
Â  Â  Â  Â  Â  Â  alertEl.innerHTML = `âš ï¸ VarovÃ¡nÃ­: VaÅ¡e BMI (${bmi.toFixed(1)}) je vÃ½raznÄ› nad doporuÄenou hranicÃ­!`;
Â  Â  Â  Â  Â  Â  alertEl.className = 'alert show';
Â  Â  Â  Â  Â  Â  alertEl.style.background = '#ff5555';
Â  Â  Â  Â  Â  Â  console.warn(`checkBMIAlert: BMI (${bmi.toFixed(1)}) je v nebezpeÄnÃ©m pÃ¡smu.`);
Â  Â  Â  Â  } else if (bmi > settings.bmiWarningUpper) {
Â  Â  Â  Â  Â  Â  alertEl.innerHTML = `âš¡ UpozornÄ›nÃ­: VaÅ¡e BMI (${bmi.toFixed(1)}) pÅ™ekraÄuje doporuÄenou hranici.`;
Â  Â  Â  Â  Â  Â  alertEl.className = 'alert show';
Â  Â  Â  Â  Â  Â  alertEl.style.background = '#ffaa00';
Â  Â  Â  Â  Â  Â  console.warn(`checkBMIAlert: BMI (${bmi.toFixed(1)}) je v varovnÃ©m pÃ¡smu.`);
Â  Â  Â  Â  } else if (bmi < settings.bmiWarningLower && bmi > 0) {
Â  Â  Â  Â  Â  Â  alertEl.innerHTML = `âš¡ UpozornÄ›nÃ­: VaÅ¡e BMI (${bmi.toFixed(1)}) je pod doporuÄenou hranicÃ­.`;
Â  Â  Â  Â  Â  Â  alertEl.className = 'alert show';
Â  Â  Â  Â  Â  Â  alertEl.style.background = '#00aaff';
Â  Â  Â  Â  Â  Â  console.warn(`checkBMIAlert: BMI (${bmi.toFixed(1)}) je pod doporuÄenou hranicÃ­.`);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  alertEl.className = 'alert';
Â  Â  Â  Â  Â  Â  console.log("checkBMIAlert: BMI je v normÄ›, upozornÄ›nÃ­ skryto.");
Â  Â  Â  Â  }
Â  Â  };

Â  Â  window.showNotification = function(message, duration = 3000) {
Â  Â  Â  Â  console.log(`showNotification: Zobrazuji notifikaci: "${message}"`);
Â  Â  Â  Â  const notification = document.getElementById('notification');
Â  Â  Â  Â  notification.textContent = message;
Â  Â  Â  Â  notification.style.display = 'block';
Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  notification.style.display = 'none';
Â  Â  Â  Â  Â  Â  console.log("showNotification: Notifikace skryta.");
Â  Â  Â  Â  }, duration);
Â  Â  };

Â  Â  window.showTab = function(tabName) {
Â  Â  Â  Â  console.log(`showTab: PÅ™epÃ­nÃ¡m na zÃ¡loÅ¾ku: ${tabName}`);
Â  Â  Â  Â  document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
Â  Â  Â  Â  document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
Â  Â  Â  Â  document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
Â  Â  Â  Â  document.getElementById(tabName).classList.add('active');
Â  Â  Â  Â  console.log(`showTab: ZÃ¡loÅ¾ka '${tabName}' aktivovÃ¡na.`);
Â  Â  };
Â  Â Â 
Â  Â  window.formatDateForDisplay = function(dateStr) {
Â  Â  Â  Â  // console.log("formatDateForDisplay: FormÃ¡tuji datum pro zobrazenÃ­."); // Velmi ÄastÃ© volÃ¡nÃ­
Â  Â  Â  Â  if (!dateStr) return '-';
Â  Â  Â  Â  const date = new Date(dateStr);
Â  Â  Â  Â  if (isNaN(date.getTime())) {
Â  Â  Â  Â  Â  Â  console.warn(`formatDateForDisplay: NeplatnÃ© datum: ${dateStr}`);
Â  Â  Â  Â  Â  Â  return 'NeplatnÃ© datum';
Â  Â  Â  Â  }
Â  Â  Â  Â  const day = date.getDate();
Â  Â  Â  Â  const month = date.getMonth() + 1;
Â  Â  Â  Â  const year = date.getFullYear();
Â  Â  Â  Â  return `${day}. ${month}. ${year}`;
Â  Â  };

Â  Â  window.initializeCharts = function() {
Â  Â  Â  Â  console.log("initializeCharts: SpuÅ¡tÄ›na inicializace grafÅ¯.");
Â  Â  Â  Â  const commonOptions = (yLabel, xLabelColor = '#00d9ff', yLabelColor = '#00d9ff', gridColor = '#444', yPrecision = 1) => ({
Â  Â  Â  Â  Â  Â  responsive: true, maintainAspectRatio: false,
Â  Â  Â  Â  Â  Â  scales: {
Â  Â  Â  Â  Â  Â  Â  Â  y: { beginAtZero: false, grid: { color: gridColor }, ticks: { color: yLabelColor, precision: yPrecision }, title: { display: !!yLabel, text: yLabel, color: yLabelColor } },
Â  Â  Â  Â  Â  Â  Â  Â  x: { grid: { color: gridColor }, ticks: { color: xLabelColor, autoSkip: true, maxTicksLimit: 10 } }
Â  Â  Â  Â  Â  Â  }, plugins: { legend: { labels: { color: xLabelColor } } }
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  const lineChartDataset = (label, data, borderColor, bgColor) => ({
Â  Â  Â  Â  Â  Â  label: label, data: data, borderColor: borderColor, backgroundColor: bgColor,
Â  Â  Â  Â  Â  Â  tension: 0.1, pointBackgroundColor: borderColor, pointBorderColor: '#fff',
Â  Â  Â  Â  Â  Â  pointRadius: 4, pointHoverRadius: 6
Â  Â  Â  Â  });

Â  Â  Â  Â  // Destroy existing chart instances before re-initializing
Â  Â  Â  Â  console.log("initializeCharts: NiÄÃ­m existujÃ­cÃ­ instance grafÅ¯ pro znovuinicializaci.");
Â  Â  Â  Â  if (weightChart) weightChart.destroy();
Â  Â  Â  Â  if (bmiChart) bmiChart.destroy();
Â  Â  Â  Â  if (bodyFatOnlyChart) bodyFatOnlyChart.destroy();
Â  Â  Â  Â  if (muscleMassOnlyChart) muscleMassOnlyChart.destroy();
Â  Â  Â  Â  if (bodyWaterChart) bodyWaterChart.destroy();
Â  Â  Â  Â  if (manualBMRChart) manualBMRChart.destroy();
Â  Â  Â  Â  if (manualAMRChart) manualAMRChart.destroy();

Â  Â  Â  Â  weightChart = new Chart(document.getElementById('weightChart').getContext('2d'), { type: 'line', data: { labels: [], datasets: [lineChartDataset('VÃ¡ha (kg)', [], '#00d9ff', 'rgba(0,217,255,0.2)')] }, options: commonOptions('VÃ¡ha (kg)') });
Â  Â  Â  Â  bmiChart = new Chart(document.getElementById('bmiChart').getContext('2d'), { type: 'line', data: { labels: [], datasets: [lineChartDataset('BMI', [], '#55ff99', 'rgba(85,255,153,0.2)')] }, options: commonOptions('BMI') });
Â  Â  Â  Â  bodyWaterChart = new Chart(document.getElementById('bodyWaterChart').getContext('2d'), { type: 'line', data: { labels: [], datasets: [lineChartDataset('Voda v tÄ›le (%)', [], '#00aaff', 'rgba(0,170,255,0.2)')] }, options: commonOptions('Voda v tÄ›le (%)') });
Â  Â  Â  Â  manualBMRChart = new Chart(document.getElementById('manualBMRChart').getContext('2d'), { type: 'line', data: { labels: [], datasets: [lineChartDataset('ZadanÃ© BMR (kcal)', [], '#ff9933', 'rgba(255,153,51,0.2)')] }, options: commonOptions('BMR (kcal)', undefined, undefined, undefined, 0) });
Â  Â  Â  Â  manualAMRChart = new Chart(document.getElementById('manualAMRChart').getContext('2d'), { type: 'line', data: { labels: [], datasets: [lineChartDataset('ZadanÃ© AMR (kcal)', [], '#cc66ff', 'rgba(204,102,255,0.2)')] }, options: commonOptions('AMR (kcal)', undefined, undefined, undefined, 0) });
Â  Â  Â  Â  bodyFatOnlyChart = new Chart(document.getElementById('bodyFatOnlyChart').getContext('2d'), { type: 'line', data: { labels: [], datasets: [lineChartDataset('TÄ›lesnÃ½ tuk (%)', [], '#ff5555', 'rgba(255,85,85,0.2)')]}, options: commonOptions('Tuk (%)') });
Â  Â  Â  Â  muscleMassOnlyChart = new Chart(document.getElementById('muscleMassOnlyChart').getContext('2d'), { type: 'line', data: { labels: [], datasets: [lineChartDataset('SvalovÃ¡ hmota (%)', [], '#ffff55', 'rgba(255,255,85,0.2)')]}, options: commonOptions('Svaly (%)') });
Â  Â  Â  Â  console.log("initializeCharts: Grafy inicializovÃ¡ny.");
Â  Â  };

Â  Â  window.updateCharts = function() {
Â  Â  Â  Â  console.log("updateCharts: Aktualizuji data v grafech.");
Â  Â  Â  Â  if (!weightLog || weightLog.length === 0) {
Â  Â  Â  Â  Â  Â  console.log("updateCharts: Å½Ã¡dnÃ¡ data pro aktualizaci grafÅ¯.");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  const sortedData = [...weightLog].sort((a, b) => new Date(a.date) - new Date(b.date));
Â  Â  Â  Â  const labels = sortedData.map(entry => window.formatDateForDisplay(entry.date)); // VolÃ¡me globÃ¡lnÃ­ formÃ¡tovÃ¡nÃ­
Â  Â  Â  Â Â 
Â  Â  Â  Â  const weights = sortedData.map(entry => entry.weight);
Â  Â  Â  Â  const bmis = sortedData.map(entry => window.calculateBMI(entry.weight, settings.height).toFixed(1)); // VolÃ¡me globÃ¡lnÃ­ vÃ½poÄet
Â  Â  Â  Â  const bodyFats = sortedData.map(entry => entry.bodyFat);
Â  Â  Â  Â Â 
Â  Â  Â  Â  const muscleMassPercentages = sortedData.map(entry => {
Â  Â  Â  Â  Â  Â  if (entry.muscleMass && entry.weight && entry.weight > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  return parseFloat(((entry.muscleMass / entry.weight) * 100).toFixed(1));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return NaN;
Â  Â  Â  Â  });

Â  Â  Â  Â  const bodyWaters = sortedData.map(entry => entry.bodyWater);
Â  Â  Â  Â  const manualBMRs = sortedData.map(entry => entry.manualBMR);
Â  Â  Â  Â  const manualAMRs = sortedData.map(entry => entry.manualAMR);


Â  Â  Â  Â  weightChart.data.labels = labels; weightChart.data.datasets[0].data = weights; weightChart.update();
Â  Â  Â  Â  bmiChart.data.labels = labels; bmiChart.data.datasets[0].data = bmis; bmiChart.update();
Â  Â  Â  Â  bodyWaterChart.data.labels = labels; bodyWaterChart.data.datasets[0].data = bodyWaters.map(bw => bw === null || bw === undefined ? NaN : bw); bodyWaterChart.update();
Â  Â  Â  Â  manualBMRChart.data.labels = labels; manualBMRChart.data.datasets[0].data = manualBMRs.map(val => val === null || val === undefined ? NaN : val); manualBMRChart.update();
Â  Â  Â  Â  manualAMRChart.data.labels = labels; manualAMRChart.data.datasets[0].data = manualAMRs.map(val => val === null || val === undefined ? NaN : val); manualAMRChart.update();
Â  Â  Â  Â  bodyFatOnlyChart = new Chart(document.getElementById('bodyFatOnlyChart').getContext('2d'), { type: 'line', data: { labels: [], datasets: [lineChartDataset('TÄ›lesnÃ½ tuk (%)', [], '#ff5555', 'rgba(255,85,85,0.2)')]}, options: commonOptions('Tuk (%)') });
Â  Â  Â  Â  muscleMassOnlyChart = new Chart(document.getElementById('muscleMassOnlyChart').getContext('2d'), { type: 'line', data: { labels: [], datasets: [lineChartDataset('SvalovÃ¡ hmota (%)', [], '#ffff55', 'rgba(255,255,85,0.2)')]}, options: commonOptions('Svaly (%)') });
Â  Â  Â  Â  console.log("updateCharts: Grafy ÃºspÄ›Å¡nÄ› aktualizovÃ¡ny.");
Â  Â  };

Â  Â  window.updateTable = function() {
Â  Â  Â  Â  console.log("updateTable: Aktualizuji tabulku zÃ¡znamÅ¯.");
Â  Â  Â  Â  const tableBody = document.getElementById('tableBody');
Â  Â  Â  Â  tableBody.innerHTML = ''; // VyprÃ¡zdnÃ­m tabulku pÅ™ed novÃ½m naplnÄ›nÃ­m
Â  Â  Â  Â  if (!weightLog || settings.height <=0) {
Â  Â  Â  Â  Â  Â  console.log("updateTable: Å½Ã¡dnÃ¡ data nebo nastavenÃ­ vÃ½Å¡ky pro zobrazenÃ­ tabulky.");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const sortedData = [...weightLog].sort((a, b) => new Date(b.date) - new Date(a.date)); // Å˜adÃ­me od nejnovÄ›jÅ¡Ã­ho
Â  Â  Â  Â  console.log(`updateTable: ZpracovÃ¡vÃ¡m ${sortedData.length} zÃ¡znamÅ¯ pro tabulku.`);
Â  Â  Â  Â Â 
Â  Â  Â  Â  sortedData.forEach((entry, index) => {
Â  Â  Â  Â  Â  Â  const bmi = window.calculateBMI(entry.weight, settings.height);
Â  Â  Â  Â  Â  Â  const classification = window.classifyBMI(bmi);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let weightDiffText = '-';
Â  Â  Â  Â  Â  Â  let diffClass = '';
Â  Â  Â  Â  Â  Â  // NalezenÃ­ pÅ™edchozÃ­ho zÃ¡znamu v chronologickÃ©m poÅ™adÃ­ pro vÃ½poÄet rozdÃ­lu
Â  Â  Â  Â  Â  Â  const chronologicalLog = [...weightLog].sort((a, b) => new Date(a.date) - new Date(b.date));
Â  Â  Â  Â  Â  Â  const currentEntryIndexChronological = chronologicalLog.findIndex(e => e.date === entry.date);
Â  Â  Â  Â  Â  Â  const previousChronologicalEntry = currentEntryIndexChronological > 0 ? chronologicalLog[currentEntryIndexChronological -1] : null;

Â  Â  Â  Â  Â  Â  if (previousChronologicalEntry) {
Â  Â  Â  Â  Â  Â  Â  Â  const weightDiff = (entry.weight - previousChronologicalEntry.weight);
Â  Â  Â  Â  Â  Â  Â  Â  weightDiffText = (weightDiff > 0 ? '+' : '') + weightDiff.toFixed(1);
Â  Â  Â  Â  Â  Â  Â  Â  diffClass = weightDiff > 0 ? 'gain' : (weightDiff < 0 ? 'loss' : '');
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  let muscleMassDisplay = '-';
Â  Â  Â  Â  Â  Â  if (entry.muscleMass && entry.weight && entry.weight > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  muscleMassDisplay = ((entry.muscleMass / entry.weight) * 100).toFixed(1) + '%';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const row = document.createElement('tr');
Â  Â  Â  Â  Â  Â  row.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <td>${sortedData.length - index}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td>${window.formatDateForDisplay(entry.date)}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td>${entry.weight !== null && entry.weight !== undefined ? entry.weight.toFixed(1) : '-'}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td class="${diffClass}">${weightDiffText}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td class="${classification.class}">${bmi > 0 ? bmi.toFixed(1) : '-'}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td class="${classification.class}">${classification.text}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td>${entry.bodyFat !== null && entry.bodyFat !== undefined ? entry.bodyFat.toFixed(1) : '-'}%</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td>${muscleMassDisplay}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td>${entry.bodyWater !== null && entry.bodyWater !== undefined ? entry.bodyWater.toFixed(1) : '-'}%</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td>${entry.manualBMR !== null && entry.manualBMR !== undefined ? entry.manualBMR : '-'}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td>${entry.manualAMR !== null && entry.manualAMR !== undefined ? entry.manualAMR : '-'}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td title="${entry.notes || ''}">${(entry.notes || '').substring(0,10)}${(entry.notes || '').length > 10 ? '...' : ''}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="danger" onclick="deleteEntry('${entry.date}')" title="Smazat">ğŸ—‘ï¸</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="editEntry('${entry.date}')" title="Upravit">âœï¸</button>
Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  tableBody.appendChild(row);
Â  Â  Â  Â  });
Â  Â  Â  Â  console.log("updateTable: Tabulka ÃºspÄ›Å¡nÄ› aktualizovÃ¡na.");
Â  Â  };
Â  Â Â 
Â  Â  window.updateStats = function() {
Â  Â  Â  Â  console.log("updateStats: Aktualizuji statistiky.");
Â  Â  Â  Â  if (weightLog.length === 0) {
Â  Â  Â  Â  Â  Â  console.log("updateStats: Å½Ã¡dnÃ¡ data pro zobrazenÃ­ statistik.");
Â  Â  Â  Â  Â  Â  document.getElementById('currentWeight').textContent = '-';
Â  Â  Â  Â  Â  Â  document.getElementById('currentBMI').textContent = '-';
Â  Â  Â  Â  Â  Â  document.getElementById('currentBMI').className = 'stat-value';
Â  Â  Â  Â  Â  Â  document.getElementById('weightChange').textContent = '-';
Â  Â  Â  Â  Â  Â  document.getElementById('weightChange').className = 'stat-value';
Â  Â  Â  Â  Â  Â  document.getElementById('currentBodyWater').textContent = '-';
Â  Â  Â  Â  Â  Â  document.getElementById('lastManualBMR').textContent = '-';
Â  Â  Â  Â  Â  Â  document.getElementById('lastManualAMR').textContent = '-';
Â  Â  Â  Â  Â  Â  document.getElementById('theoreticalBMR').textContent = '-';
Â  Â  Â  Â  Â  Â  document.getElementById('theoreticalAMR').textContent = '-';
Â  Â  Â  Â  Â  Â  document.getElementById('goalProgress').textContent = '-';
Â  Â  Â  Â  Â  Â  document.getElementById('goalProgressBarCard').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('latestEntryDate').textContent = 'Å½Ã¡dnÃ¡ data k zobrazenÃ­.';
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const sortedLog = [...weightLog].sort((a, b) => new Date(a.date) - new Date(b.date));
Â  Â  Â  Â  const latestEntry = sortedLog[sortedLog.length - 1];
Â  Â  Â  Â Â 
Â  Â  Â  Â  const currentWeight = latestEntry.weight;
Â  Â  Â  Â  const currentBMI = window.calculateBMI(currentWeight, settings.height);
Â  Â  Â  Â  const currentBodyWater = latestEntry.bodyWater;

Â  Â  Â  Â  document.getElementById('currentWeight').textContent = currentWeight.toFixed(1);
Â  Â  Â  Â  document.getElementById('currentBMI').textContent = currentBMI > 0 ? currentBMI.toFixed(1) : '-';
Â  Â  Â  Â  document.getElementById('currentBMI').className = 'stat-value ' + window.classifyBMI(currentBMI).class;
Â  Â  Â  Â  document.getElementById('currentBodyWater').textContent = currentBodyWater !== null && currentBodyWater !== undefined ? currentBodyWater.toFixed(1) : '-';
Â  Â  Â  Â  document.getElementById('lastManualBMR').textContent = latestEntry.manualBMR !== null && latestEntry.manualBMR !== undefined ? latestEntry.manualBMR : '-';
Â  Â  Â  Â  document.getElementById('lastManualAMR').textContent = latestEntry.manualAMR !== null && latestEntry.manualAMR !== undefined ? latestEntry.manualAMR : '-';

Â  Â  Â  Â  let weightChangeVal = 0;
Â  Â  Â  Â  let weightChangeText = '-';
Â  Â  Â  Â  let changeClass = '';
Â  Â  Â  Â  if (sortedLog.length >= 2) {
Â  Â  Â  Â  Â  Â  const previousEntry = sortedLog[sortedLog.length - 2];
Â  Â  Â  Â  Â  Â  weightChangeVal = currentWeight - previousEntry.weight;
Â  Â  Â  Â  Â  Â  weightChangeText = (weightChangeVal >= 0 ? '+' : '') + weightChangeVal.toFixed(1);
Â  Â  Â  Â  Â  Â  changeClass = weightChangeVal > 0 ? 'gain' : (weightChangeVal < 0 ? 'loss' : '');
Â  Â  Â  Â  }
Â  Â  Â  Â  document.getElementById('weightChange').textContent = weightChangeText;
Â  Â  Â  Â  document.getElementById('weightChange').className = 'stat-value ' + changeClass;

Â  Â  Â  Â  const theoBMR = window.calculateBMR(currentWeight, settings.height, settings.age, settings.gender);
Â  Â  Â  Â  const theoAMR = window.calculateAMR(theoBMR, settings.activityLevel);
Â  Â  Â  Â  document.getElementById('theoreticalBMR').textContent = theoBMR > 0 ? Math.round(theoBMR) : '-';
Â  Â  Â  Â  document.getElementById('theoreticalAMR').textContent = theoAMR > 0 ? Math.round(theoAMR) : '-';
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById('latestEntryDate').textContent = `PoslednÃ­ zÃ¡znam: ${window.formatDateForDisplay(latestEntry.date)}`;

Â  Â  Â  Â  if (goals.targetWeight && sortedLog.length > 0) {
Â  Â  Â  Â  Â  Â  console.log("updateStats: PoÄÃ­tÃ¡m pokrok k cÃ­li.");
Â  Â  Â  Â  Â  Â  const initialWeight = sortedLog[0].weight;
Â  Â  Â  Â  Â  Â  const totalChangeNeeded = goals.targetWeight - initialWeight;
Â  Â  Â  Â  Â  Â  const currentChangeAchieved = currentWeight - initialWeight;
Â  Â  Â  Â  Â  Â  let progressPercent = 0;

Â  Â  Â  Â  Â  Â  if (totalChangeNeeded !== 0) {
Â  Â  Â  Â  Â  Â  Â  Â  if ((totalChangeNeeded < 0 && currentWeight <= initialWeight && currentWeight >= goals.targetWeight) ||
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (totalChangeNeeded > 0 && currentWeight >= initialWeight && currentWeight <= goals.targetWeight)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  progressPercent = (Math.abs(currentChangeAchieved) / Math.abs(totalChangeNeeded)) * 100;
Â  Â  Â  Â  Â  Â  Â  Â  } else if ((totalChangeNeeded < 0 && currentWeight < goals.targetWeight) || (totalChangeNeeded > 0 && currentWeight > goals.targetWeight)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  progressPercent = 100;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  progressPercent = 0;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  progressPercent = (initialWeight === currentWeight) ? 100 : 0;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  progressPercent = Math.min(100, Math.max(0, progressPercent));

Â  Â  Â  Â  Â  Â  document.getElementById('goalProgress').textContent = `${progressPercent.toFixed(1)}%`;
Â  Â  Â  Â  Â  Â  document.getElementById('goalProgressBarCard').style.display = 'block';
Â  Â  Â  Â  Â  Â  document.getElementById('progressFill').style.width = `${progressPercent}%`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const remainingKg = goals.targetWeight - currentWeight;
Â  Â  Â  Â  Â  Â  if (progressPercent >= 100) {
Â  Â  Â  Â  Â  Â  Â  Â  window.document.getElementById('goalStatus').textContent = `ğŸ‰ CÃ­l ${goals.targetWeight} kg dosaÅ¾en/pÅ™ekonÃ¡n!`;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  window.document.getElementById('goalStatus').textContent = `ZbÃ½vÃ¡: ${remainingKg.toFixed(1)} kg do cÃ­le (${goals.targetWeight} kg)`;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const THIRTY_DAYS_MS = 30 * 24 * 60 * 60 * 1000;
Â  Â  Â  Â  Â  Â  const now = new Date();
Â  Â  Â  Â  Â  Â  const recentLog = sortedLog.filter(entry => (now - new Date(entry.date)) <= THIRTY_DAYS_MS);

Â  Â  Â  Â  Â  Â  if (recentLog.length >= 2 && remainingKg !== 0) {
Â  Â  Â  Â  Â  Â  Â  Â  const oldestRecent = recentLog[0];
Â  Â  Â  Â  Â  Â  Â  Â  const latestRecent = recentLog[recentLog.length - 1];
Â  Â  Â  Â  Â  Â  Â  Â  const daysElapsed = Math.max(1, Math.floor((new Date(latestRecent.date) - new Date(oldestRecent.date)) / (1000 * 60 * 60 * 24)));
Â  Â  Â  Â  Â  Â  Â  Â  const weightChangeInPeriod = latestRecent.weight - oldestRecent.weight;
Â  Â  Â  Â  Â  Â  Â  Â  const dailyChange = weightChangeInPeriod / daysElapsed;
Â  Â  Â  Â  Â  Â  Â  Â  let estimateText = 'Nedostatek dat pro odhad.';

Â  Â  Â  Â  Â  Â  Â  Â  if (dailyChange !== 0 && ((remainingKg < 0 && dailyChange < 0) || (remainingKg > 0 && dailyChange > 0))) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const estimatedDays = Math.abs(remainingKg / dailyChange);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (estimatedDays > 365 * 3) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  estimateText = 'Odhad: vÃ­ce neÅ¾ 3 roky';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (estimatedDays > 365) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  estimateText = `Odhad: cca ${Math.round(estimatedDays/30.44)} mÄ›sÃ­cÅ¯`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  estimateText = `Odhad: cca ${Math.round(estimatedDays)} dnÃ­ (~${Math.round(estimatedDays / 7)} tÃ½dnÅ¯)`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } else if (dailyChange === 0 && remainingKg !== 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  estimateText = 'Odhad: stagnace, cÃ­l se nepÅ™ibliÅ¾uje.';
Â  Â  Â  Â  Â  Â  Â  Â  } else if (remainingKg !== 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  estimateText = 'Odhad: aktuÃ¡lnÄ› se vzdalujete od cÃ­le.';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('goalEstimate').textContent = estimateText;
Â  Â  Â  Â  Â  Â  } else if (remainingKg === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('goalEstimate').textContent = 'CÃ­l dosaÅ¾en!';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('goalEstimate').textContent = 'Nedostatek dat za posl. 30 dnÃ­ pro odhad.';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  document.getElementById('goalProgress').textContent = '-';
Â  Â  Â  Â  Â  Â  document.getElementById('goalProgressBarCard').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('goalEstimate').textContent = 'CÃ­l nenÃ­ nastaven.';
Â  Â  Â  Â  }
Â  Â  Â  Â  window.checkBMIAlert(currentBMI);
Â  Â  Â  Â  console.log("updateStats: Statistiky aktualizovÃ¡ny.");
Â  Â  };

Â  Â  window.updateRecommendations = function() {
Â  Â  Â  Â  console.log("updateRecommendations: Aktualizuji doporuÄenÃ­.");
Â  Â  Â  Â  if (weightLog.length === 0 ) {
Â  Â  Â  Â  Â  Â  document.getElementById('recommendationText').innerHTML = '<p>Pro doporuÄenÃ­ zadejte vÃ­ce dat.</p>';
Â  Â  Â  Â  Â  Â  console.log("updateRecommendations: Å½Ã¡dnÃ¡ data pro generovÃ¡nÃ­ doporuÄenÃ­.");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  const sortedDataDesc = [...weightLog].sort((a, b) => new Date(b.date) - new Date(a.date));
Â  Â  Â  Â  const latestEntry = sortedDataDesc[0];
Â  Â  Â  Â  const currentWeight = latestEntry.weight;
Â  Â  Â  Â  const currentBMI = window.calculateBMI(currentWeight, settings.height);
Â  Â  Â  Â Â 
Â  Â  Â  Â  let recommendations = [];

Â  Â  Â  Â  if (currentBMI > 0) {
Â  Â  Â  Â  Â  Â  if (currentBMI < 18.5) recommendations.push("ğŸ’š VaÅ¡e BMI naznaÄuje podvÃ¡hu. ZvaÅ¾te konzultaci s lÃ©kaÅ™em o zdravÃ©m pÅ™Ã­rÅ¯stku vÃ¡hy.");
Â  Â  Â  Â  Â  Â  else if (currentBMI > settings.bmiDangerUpper) recommendations.push("â¤ï¸ VaÅ¡e BMI je v pÃ¡smu obezity. DÅ¯raznÄ› doporuÄujeme konzultaci s lÃ©kaÅ™em a Ãºpravu Å¾ivotnÃ­ho stylu.");
Â  Â  Â  Â  Â  Â  else if (currentBMI > settings.bmiWarningUpper) recommendations.push("ğŸ’› VaÅ¡e BMI signalizuje nadvÃ¡hu. DoporuÄujeme zamÄ›Å™it se na vyvÃ¡Å¾enou stravu a pravidelnÃ½ pohyb.");
Â  Â  Â  Â  Â  Â  else recommendations.push("âœ… VaÅ¡e BMI je v normÃ¡lnÃ­m rozmezÃ­. UdrÅ¾ujte si zdravÃ½ Å¾ivotnÃ­ styl!");
Â  Â  Â  Â  } else if(settings.height) {
Â  Â  Â  Â  Â  Â  recommendations.push("âš ï¸ Zadejte vÃ½Å¡ku pro vÃ½poÄet BMI a relevantnÃ­ doporuÄenÃ­.");
Â  Â  Â  Â  }

Â  Â  Â  Â  const sevenDaysAgo = new Date(new Date().setDate(new Date().getDate() - 7));
Â  Â  Â  Â  const fourteenDaysAgo = new Date(new Date().setDate(new Date().getDate() - 14));
Â  Â  Â  Â Â 
Â  Â  Â  Â  const last7DaysEntries = weightLog.filter(e => new Date(e.date) >= sevenDaysAgo);
Â  Â  Â  Â  const prev7DaysEntries = weightLog.filter(e => new Date(e.date) >= fourteenDaysAgo && new Date(e.date) < sevenDaysAgo);

Â  Â  Â  Â  if (last7DaysEntries.length > 1 && prev7DaysEntries.length > 1) {
Â  Â  Â  Â  Â  Â  const avgLast7 = last7DaysEntries.reduce((sum, e) => sum + e.weight, 0) / last7DaysEntries.length;
Â  Â  Â  Â  Â  Â  const avgPrev7 = prev7DaysEntries.reduce((sum, e) => sum + e.weight, 0) / prev7DaysEntries.length;
Â  Â  Â  Â  Â  Â  const weeklyTrend = avgLast7 - avgPrev7;

Â  Â  Â  Â  Â  Â  if (Math.abs(weeklyTrend) > 1.5) {
Â  Â  Â  Â  Â  Â  Â  Â  recommendations.push(`âš ï¸ RychlÃ¡ zmÄ›na vÃ¡hy (${weeklyTrend.toFixed(1)} kg/tÃ½den prÅ¯mÄ›rnÄ›). ZvaÅ¾te pozvolnÄ›jÅ¡Ã­ tempo (ideÃ¡lnÄ› 0.5-1 kg/tÃ½den).`);
Â  Â  Â  Â  Â  Â  } else if (weeklyTrend !== 0) {
Â  Â  Â  Â  Â  Â  Â  Â  recommendations.push(`ğŸ“ˆ TÃ½dennÃ­ trend vÃ¡hy: ${weeklyTrend.toFixed(1)} kg. PokraÄujte ve svÃ©m ÃºsilÃ­!`);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else if (last7DaysEntries.length >=2) {
Â  Â  Â  Â  Â  Â  const sortedWeek = last7DaysEntries.sort((a,b) => new Date(a.date) - new Date(b.date));
Â  Â  Â  Â  Â  Â  const weekChange = sortedWeek[sortedWeek.length-1].weight - sortedWeek[0].weight;
Â  Â  Â  Â  Â  Â  if (Math.abs(weekChange) > 1.5) {
Â  Â  Â  Â  Â  Â  Â  Â  recommendations.push(`âš ï¸ RychlÃ¡ zmÄ›na vÃ¡hy za poslednÃ­ dny: ${weekChange.toFixed(1)} kg. DoporuÄujeme pozvolnÄ›jÅ¡Ã­ zmÄ›ny.`);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  if (goals.targetWeight && goals.targetDate) {
Â  Â  Â  Â  Â  Â  console.log("updateRecommendations: PoÄÃ­tÃ¡m doporuÄenÃ­ pro cÃ­le.");
Â  Â  Â  Â  Â  Â  const daysToGoal = Math.ceil((new Date(goals.targetDate) - new Date()) / (1000 * 60 * 60 * 24));
Â  Â  Â  Â  Â  Â  const weightToChange = goals.targetWeight - currentWeight;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (daysToGoal > 0 && weightToChange !== 0) {
Â  Â  Â  Â  Â  Â  Â  Â  const requiredWeeklyChange = (weightToChange / (daysToGoal / 7)).toFixed(1);
Â  Â  Â  Â  Â  Â  Â  Â  recommendations.push(`ğŸ¯ Pro dosaÅ¾enÃ­ cÃ­le (${goals.targetWeight} kg) do ${window.formatDateForDisplay(goals.targetDate)}, je potÅ™eba prÅ¯mÄ›rnÃ¡ tÃ½dennÃ­ zmÄ›na ${requiredWeeklyChange} kg.`);
Â  Â  Â  Â  Â  Â  Â  Â  if (Math.abs(requiredWeeklyChange) > 1.5) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  recommendations.push("ğŸ’¡ Tento tÃ½dennÃ­ cÃ­l je pomÄ›rnÄ› ambiciÃ³znÃ­. UjistÄ›te se, Å¾e je udrÅ¾itelnÃ½ a zdravÃ½.");
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else if (weightToChange === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  recommendations.push(`ğŸ¯ CÃ­lovÃ¡ vÃ¡ha ${goals.targetWeight} kg dosaÅ¾ena! Gratulujeme!`);
Â  Â  Â  Â  Â  Â  } else if (daysToGoal <=0 && weightToChange !==0) {
Â  Â  Â  Â  Â  Â  Â  Â  recommendations.push(`ğŸ—“ï¸ TermÃ­n pro cÃ­l ${goals.targetWeight} kg jiÅ¾ vyprÅ¡el. ZvaÅ¾te nastavenÃ­ novÃ©ho cÃ­le.`);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else if (goals.targetWeight) {
Â  Â  Â  Â  Â  Â  const weightToChange = goals.targetWeight - currentWeight;
Â  Â  Â  Â  Â  Â  if (weightToChange === 0) recommendations.push(`ğŸ¯ CÃ­lovÃ¡ vÃ¡ha ${goals.targetWeight} kg dosaÅ¾ena!`);
Â  Â  Â  Â  Â  Â  else recommendations.push(`ğŸ¯ CÃ­l: ${goals.targetWeight} kg. AktuÃ¡lnÄ› zbÃ½vÃ¡ ${weightToChange.toFixed(1)} kg.`);
Â  Â  Â  Â  }

Â  Â  Â  Â  const theoBMR = window.calculateBMR(currentWeight, settings.height, settings.age, settings.gender);
Â  Â  Â  Â  const theoAMR = window.calculateAMR(theoBMR, settings.activityLevel);
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (theoAMR > 0 && goals.weeklyGoal) {
Â  Â  Â  Â  Â  Â  const weeklyCalDeficitOrSurplus = goals.weeklyGoal * 7700;
Â  Â  Â  Â  Â  Â  const dailyCalAdjustment = weeklyCalDeficitOrSurplus / 7;
Â  Â  Â  Â  Â  Â  const targetCalories = Math.round(theoAMR + dailyCalAdjustment);
Â  Â  Â  Â  Â  Â  let goalType = goals.weeklyGoal < 0 ? "hubnutÃ­" : (goals.weeklyGoal > 0 ? "nabÃ­rÃ¡nÃ­" : "udrÅ¾ovÃ¡nÃ­");

Â  Â  Â  Â  Â  Â  recommendations.push(`ğŸ”¥ Pro tÃ½dennÃ­ cÃ­l ${goals.weeklyGoal} kg (${goalType}), vÃ¡Å¡ odhadovanÃ½ dennÃ­ pÅ™Ã­jem by mohl bÃ½t okolo ${targetCalories} kcal (TeoretickÃ½ AMR: ${Math.round(theoAMR)} kcal).`);
Â  Â  Â  Â  Â  Â  if (targetCalories < theoBMR && goals.weeklyGoal < 0) {
Â  Â  Â  Â  Â  Â  Â  Â  recommendations.push("â— VÃ¡Å¡ cÃ­lovÃ½ dennÃ­ pÅ™Ã­jem je pod vaÅ¡Ã­m teoretickÃ½m BMR. DlouhodobÄ› to nemusÃ­ bÃ½t udrÅ¾itelnÃ©. ZvaÅ¾te mÃ­rnÄ›jÅ¡Ã­ cÃ­l nebo konzultaci s odbornÃ­kem.");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else if (theoAMR > 0 && latestEntry.manualAMR) {
Â  Â  Â  Â  Â  Â  recommendations.push(`ğŸ’¡ VÃ¡Å¡ poslednÃ­ zadanÃ½ AMR je ${latestEntry.manualAMR} kcal. Teoreticky vypoÄtenÃ½ AMR je ${Math.round(theoAMR)} kcal. RozdÃ­l mÅ¯Å¾e bÃ½t dÃ¡n specifickou aktivitou nebo metodikou mÄ›Å™enÃ­.`);
Â  Â  Â  Â  }
Â  Â  Â  Â  document.getElementById('recommendationText').innerHTML = recommendations.length > 0 ? recommendations.map(rec => `<p>${rec}</p>`).join('') : '<p>Å½Ã¡dnÃ¡ specifickÃ¡ doporuÄenÃ­. UdrÅ¾ujte zdravÃ© nÃ¡vyky!</p>';
Â  Â  Â  Â  console.log("updateRecommendations: DoporuÄenÃ­ aktualizovÃ¡na.");
Â  Â  };

Â  Â  window.updateDisplay = function() {
Â  Â  Â  Â  console.log("updateDisplay: SpuÅ¡tÄ›na celkovÃ¡ aktualizace zobrazenÃ­.");
Â  Â  Â  Â  window.updateTable();
Â  Â  Â  Â  window.updateCharts();
Â  Â  Â  Â  window.updateStats();
Â  Â  Â  Â  window.updateRecommendations();
Â  Â  Â  Â  console.log("updateDisplay: CelkovÃ© zobrazenÃ­ aktualizovÃ¡no.");
Â  Â  };

Â  Â  // UdÃ¡losti formulÃ¡Å™Å¯ a tlaÄÃ­tek - volÃ¡me globÃ¡lnÃ­ funkce
Â  Â  document.getElementById('entryForm').addEventListener('submit', async function(e) {
Â  Â  Â  Â  console.log("entryForm: OdesÃ­lÃ¡nÃ­ novÃ©ho zÃ¡znamu.");
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  const date = document.getElementById('entryDate').value;
Â  Â  Â  Â  const weight = parseFloat(document.getElementById('entryWeight').value);
Â  Â  Â  Â  const bodyFat = document.getElementById('entryBodyFat').value ? parseFloat(document.getElementById('entryBodyFat').value) : null;
Â  Â  Â  Â  const muscleMass = document.getElementById('entryMuscleMass').value ? parseFloat(document.getElementById('entryMuscleMass').value) : null;
Â  Â  Â  Â  const bodyWater = document.getElementById('entryBodyWater').value ? parseFloat(document.getElementById('entryBodyWater').value) : null;
Â  Â  Â  Â  const manualBMR = document.getElementById('entryManualBMR').value ? parseInt(document.getElementById('entryManualBMR').value) : null;
Â  Â  Â  Â  const manualAMR = document.getElementById('entryManualAMR').value ? parseInt(document.getElementById('entryManualAMR').value) : null;
Â  Â  Â  Â  const notes = document.getElementById('entryNotes').value;

Â  Â  Â  Â  if (isNaN(weight) || weight <= 0) {
Â  Â  Â  Â  Â  Â  window.showNotification('Chyba: Zadejte platnou vÃ¡hu.', 3000);
Â  Â  Â  Â  Â  Â  console.warn("entryForm: NeplatnÃ¡ vÃ¡ha zadÃ¡na.");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const newEntryData = { date, weight, bodyFat, muscleMass, bodyWater, manualBMR, manualAMR, notes };
Â  Â  Â  Â  console.log("entryForm: NovÃ¡ data zÃ¡znamu:", newEntryData);

Â  Â  Â  Â  const existingIndex = weightLog.findIndex(entry => entry.date === date);
Â  Â  Â  Â  if (existingIndex !== -1) {
Â  Â  Â  Â  Â  Â  console.log("entryForm: ZÃ¡znam pro toto datum jiÅ¾ existuje. Dotazuji na pÅ™epsÃ¡nÃ­.");
Â  Â  Â  Â  Â  Â  if (confirm('ZÃ¡znam pro tento datum jiÅ¾ existuje. Chcete ho pÅ™epsat?')) {
Â  Â  Â  Â  Â  Â  Â  Â  weightLog[existingIndex] = newEntryData;
Â  Â  Â  Â  Â  Â  Â  Â  console.log("entryForm: ExistujÃ­cÃ­ zÃ¡znam pÅ™epsÃ¡n.");
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  console.log("entryForm: PÅ™epsÃ¡nÃ­ zÃ¡znamu zruÅ¡eno.");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  weightLog.push(newEntryData);
Â  Â  Â  Â  Â  Â  console.log("entryForm: NovÃ½ zÃ¡znam pÅ™idÃ¡n.");
Â  Â  Â  Â  }
Â  Â  Â  Â  await window.saveData(); // VolÃ¡me globÃ¡lnÃ­ saveData()
Â  Â  Â  Â  window.updateDisplay(); // VolÃ¡me globÃ¡lnÃ­ updateDisplay()
Â  Â  Â  Â  window.showNotification('ZÃ¡znam byl ÃºspÄ›Å¡nÄ› pÅ™idÃ¡n/aktualizovÃ¡n!'); // VolÃ¡me globÃ¡lnÃ­ showNotification()
Â  Â  Â  Â  this.reset();
Â  Â  Â  Â  window.setTodayDate(); // VolÃ¡me globÃ¡lnÃ­ setTodayDate()
Â  Â  Â  Â  window.showTab('dashboard'); // VolÃ¡me globÃ¡lnÃ­ showTab()
Â  Â  Â  Â  console.log("entryForm: ZpracovÃ¡nÃ­ zÃ¡znamu dokonÄeno.");
Â  Â  });

Â  Â  document.getElementById('settingsForm').addEventListener('submit', async function(e) {
Â  Â  Â  Â  console.log("settingsForm: OdesÃ­lÃ¡nÃ­ nastavenÃ­.");
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  settings.height = parseInt(document.getElementById('height').value);
Â  Â  Â  Â  settings.age = document.getElementById('age').value ? parseInt(document.getElementById('age').value) : null;
Â  Â  Â  Â  settings.gender = document.getElementById('gender').value;
Â  Â  Â  Â  settings.activityLevel = parseFloat(document.getElementById('activityLevel').value);
Â  Â  Â  Â  console.log("settingsForm: NovÃ© hodnoty nastavenÃ­:", settings);
Â  Â  Â  Â  await window.saveData(); // VolÃ¡me globÃ¡lnÃ­ saveData()
Â  Â  Â  Â  window.updateDisplay(); // VolÃ¡me globÃ¡lnÃ­ updateDisplay()
Â  Â  Â  Â  window.showNotification('NastavenÃ­ byla uloÅ¾ena!'); // VolÃ¡me globÃ¡lnÃ­ showNotification()
Â  Â  Â  Â  console.log("settingsForm: NastavenÃ­ uloÅ¾ena.");
Â  Â  });

Â  Â  document.getElementById('bmiAlertsForm').addEventListener('submit', async function(e) {
Â  Â  Â  Â  console.log("bmiAlertsForm: OdesÃ­lÃ¡nÃ­ BMI hranic.");
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  settings.bmiWarningUpper = parseFloat(document.getElementById('bmiWarningUpper').value);
Â  Â  Â  Â  settings.bmiDangerUpper = parseFloat(document.getElementById('bmiDangerUpper').value);
Â  Â  Â  Â  settings.bmiWarningLower = parseFloat(document.getElementById('bmiWarningLower').value);
Â  Â  Â  Â  console.log("bmiAlertsForm: NovÃ© BMI hranice:", { warningUpper: settings.bmiWarningUpper, dangerUpper: settings.bmiDangerUpper, warningLower: settings.bmiWarningLower });
Â  Â  Â  Â  await window.saveData(); // VolÃ¡me globÃ¡lnÃ­ saveData()
Â  Â  Â  Â  window.updateDisplay(); // VolÃ¡me globÃ¡lnÃ­ updateDisplay()
Â  Â  Â  Â  window.showNotification('BMI hranice byly uloÅ¾eny!'); // VolÃ¡me globÃ¡lnÃ­ showNotification()
Â  Â  Â  Â  console.log("bmiAlertsForm: BMI hranice uloÅ¾eny.");
Â  Â  });

Â  Â  document.getElementById('remindersForm').addEventListener('submit', async function(e) {
Â  Â  Â  Â  console.log("remindersForm: OdesÃ­lÃ¡nÃ­ nastavenÃ­ pÅ™ipomÃ­nek.");
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  settings.reminderEnabled = document.getElementById('reminderEnabled').checked;
Â  Â  Â  Â  settings.reminderInterval = parseInt(document.getElementById('reminderInterval').value);
Â  Â  Â  Â  console.log("remindersForm: NovÃ© nastavenÃ­ pÅ™ipomÃ­nek:", { enabled: settings.reminderEnabled, interval: settings.reminderInterval });
Â  Â  Â  Â  await window.saveData(); // VolÃ¡me globÃ¡lnÃ­ saveData()
Â  Â  Â  Â  window.showNotification('NastavenÃ­ pÅ™ipomÃ­nek bylo uloÅ¾eno!'); // VolÃ¡me globÃ¡lnÃ­ showNotification()
Â  Â  Â  Â  console.log("remindersForm: NastavenÃ­ pÅ™ipomÃ­nek uloÅ¾eno.");
Â  Â  });

Â  Â  document.getElementById('goalsForm').addEventListener('submit', async function(e) {
Â  Â  Â  Â  console.log("goalsForm: OdesÃ­lÃ¡nÃ­ cÃ­lÅ¯.");
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  goals.targetWeight = document.getElementById('targetWeight').value ? parseFloat(document.getElementById('targetWeight').value) : null;
Â  Â  Â  Â  goals.targetBMI = document.getElementById('targetBMI').value ? parseFloat(document.getElementById('targetBMI').value) : null;
Â  Â  Â  Â  goals.targetDate = document.getElementById('targetDate').value || null;
Â  Â  Â  Â  goals.weeklyGoal = document.getElementById('weeklyGoal').value ? parseFloat(document.getElementById('weeklyGoal').value) : null;
Â  Â  Â  Â  console.log("goalsForm: NovÃ© cÃ­le:", goals);
Â  Â  Â  Â  await window.saveData(); // VolÃ¡me globÃ¡lnÃ­ saveData()
Â  Â  Â  Â  window.updateDisplay(); // VolÃ¡me globÃ¡lnÃ­ updateDisplay()
Â  Â  Â  Â  window.showNotification('CÃ­le byly uloÅ¾eny!'); // VolÃ¡me globÃ¡lnÃ­ showNotification()
Â  Â  Â  Â  console.log("goalsForm: CÃ­le uloÅ¾eny.");
Â  Â  });

Â  Â  // GlobalizovanÃ© funkce pro onclick atributy
Â  Â  window.deleteEntry = async function(date) {
Â  Â  Â  Â  console.log(`deleteEntry: Pokus o smazÃ¡nÃ­ zÃ¡znamu pro datum: ${date}.`);
Â  Â  Â  Â  if (confirm(`Opravdu chcete smazat zÃ¡znam ze dne ${window.formatDateForDisplay(date)}?`)) {
Â  Â  Â  Â  Â  Â  weightLog = weightLog.filter(entry => entry.date !== date);
Â  Â  Â  Â  Â  Â  console.log(`deleteEntry: ZÃ¡znam pro datum ${date} smazÃ¡n z lokÃ¡lnÃ­ pamÄ›ti.`);
Â  Â  Â  Â  Â  Â  await window.saveData(); // VolÃ¡me globÃ¡lnÃ­ saveData() (kterÃ© nynÃ­ maÅ¾e i z Firestore)
Â  Â  Â  Â  Â  Â  // SmazÃ¡nÃ­ z Firebase je nynÃ­ souÄÃ¡stÃ­ saveData, kterÃ© volÃ¡ deleteWeightEntryFromFirestore
Â  Â  Â  Â  Â  Â  window.updateDisplay(); // VolÃ¡me globÃ¡lnÃ­ updateDisplay()
Â  Â  Â  Â  Â  Â  window.showNotification('ZÃ¡znam byl smazÃ¡n!'); // VolÃ¡me globÃ¡lnÃ­ showNotification()
Â  Â  Â  Â  Â  Â  console.log("deleteEntry: ZÃ¡znam smazÃ¡nÃ­ dokonÄeno.");
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  console.log("deleteEntry: SmazÃ¡nÃ­ zÃ¡znamu zruÅ¡eno.");
Â  Â  Â  Â  }
Â  Â  };

Â  Â  window.editEntry = function(date) {
Â  Â  Â  Â  console.log(`editEntry: Pokus o editaci zÃ¡znamu pro datum: ${date}.`);
Â  Â  Â  Â  const entry = weightLog.find(e => e.date === date);
Â  Â  Â  Â  if (entry) {
Â  Â  Â  Â  Â  Â  document.getElementById('entryDate').value = entry.date;
Â  Â  Â  Â  Â  Â  document.getElementById('entryWeight').value = entry.weight;
Â  Â  Â  Â  Â  Â  document.getElementById('entryBodyFat').value = entry.bodyFat || '';
Â  Â  Â  Â  Â  Â  document.getElementById('entryMuscleMass').value = entry.muscleMass || '';
Â  Â  Â  Â  Â  Â  document.getElementById('entryBodyWater').value = entry.bodyWater || '';
Â  Â  Â  Â  Â  Â  document.getElementById('entryManualBMR').value = entry.manualBMR || '';
Â  Â  Â  Â  Â  Â  document.getElementById('entryManualAMR').value = entry.manualAMR || '';
Â  Â  Â  Â  Â  Â  document.getElementById('entryNotes').value = entry.notes || '';
Â  Â  Â  Â  Â  Â  window.showTab('add-entry');
Â  Â  Â  Â  Â  Â  window.showNotification(`ZÃ¡znam ze dne ${window.formatDateForDisplay(date)} naÄten pro editaci.`);
Â  Â  Â  Â  Â  Â  console.log("editEntry: ZÃ¡znam naÄten do formulÃ¡Å™e pro editaci.");
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  console.warn(`editEntry: ZÃ¡znam pro datum ${date} nebyl nalezen pro editaci.`);
Â  Â  Â  Â  }
Â  Â  };

Â  Â  window.exportToCSV = function() {
Â  Â  Â  Â  console.log("exportToCSV: SpuÅ¡tÄ›n export dat do CSV.");
Â  Â  Â  Â  if (weightLog.length === 0) { window.showNotification("NenÃ­ co exportovat.", 2000); console.warn("exportToCSV: Å½Ã¡dnÃ¡ data k exportu."); return; }
Â  Â  Â  Â  const headers = ['Datum', 'Vaha (kg)', 'BMI', 'Telesny tuk (%)', 'Svalova hmota (%)', 'Svalova hmota (%)', 'Voda v tele (%)', 'Manual BMR', 'Manual AMR', 'Poznamky'];
Â  Â  Â  Â  const rows = weightLog.map(entry => {
Â  Â  Â  Â  Â  Â  let musclePercent = '';
Â  Â  Â  Â  Â  Â  if (entry.muscleMass && entry.weight && entry.weight > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  musclePercent = ((entry.muscleMass / entry.weight) * 100).toFixed(1);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return [
Â  Â  Â  Â  Â  Â  Â  Â  entry.date, entry.weight, window.calculateBMI(entry.weight, settings.height).toFixed(1),
Â  Â  Â  Â  Â  Â  Â  Â  entry.bodyFat || '', musclePercent, entry.muscleMass || '', entry.bodyWater || '',
Â  Â  Â  Â  Â  Â  Â  Â  entry.manualBMR || '', entry.manualAMR || '', `"${(entry.notes || '').replace(/"/g, '""')}"`
Â  Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  });

Â  Â  Â  Â  const csvContent = "data:text/csv;charset=utf-8," + headers.join(',') + '\n' + rows.map(row => row.join(',')).join('\n');
Â  Â  Â  Â  const encodedUri = encodeURI(csvContent);
Â  Â  Â  Â  const link = document.createElement('a');
Â  Â  Â  Â  link.setAttribute('href', encodedUri);
Â  Â  Â  Â  link.setAttribute('download', `vaha_export_Jirik_${new Date().toISOString().split('T')[0]}.csv`);
Â  Â  Â  Â  document.body.appendChild(link); link.click(); document.body.removeChild(link);
Â  Â  Â  Â  window.showNotification('CSV export dokonÄen!');
Â  Â  Â  Â  console.log("exportToCSV: Export CSV dokonÄen.");
Â  Â  };

Â  Â  window.exportToPDF = function() {
Â  Â  Â  Â  console.log("exportToPDF: SpuÅ¡tÄ›n export dat do PDF.");
Â  Â  Â  Â  if (weightLog.length === 0) { window.showNotification("NenÃ­ co exportovat.", 2000); console.warn("exportToPDF: Å½Ã¡dnÃ¡ data k exportu."); return; }
Â  Â  Â  Â  const { jsPDF } = window.jspdf;
Â  Â  Â  Â  const doc = new jsPDF();
Â  Â  Â  Â Â 
Â  Â  Â  Â  doc.setFontSize(18); doc.text('VÃ¡hovÃ½ report - AdmirÃ¡l JiÅ™Ã­k', 14, 22);
Â  Â  Â  Â  doc.setFontSize(11); doc.text(`GenerovÃ¡no: ${new Date().toLocaleDateString('cs-CZ')}`, 14, 30);
Â  Â  Â  Â  doc.text(`VÃ½Å¡ka: ${settings.height} cm, VÄ›k: ${settings.age || '-'} let, PohlavÃ­: ${settings.gender === 'male' ? 'MuÅ¾' : 'Å½ena'}`, 14, 36);
Â  Â  Â  Â Â 
Â  Â  Â  Â  const latestEntry = [...weightLog].sort((a, b) => new Date(b.date) - new Date(a.date))[0];
Â  Â  Â  Â  if (latestEntry) {
Â  Â  Â  Â  Â  Â  const currentBMI = window.calculateBMI(latestEntry.weight, settings.height);
Â  Â  Â  Â  Â  Â  const theoBMR = window.calculateBMR(latestEntry.weight, settings.height, settings.age, settings.gender);
Â  Â  Â  Â  Â  Â  const theoAMR = window.calculateAMR(theoBMR, settings.activityLevel);
Â  Â  Â  Â  Â  Â  doc.text(`AktuÃ¡lnÃ­ vÃ¡ha: ${latestEntry.weight.toFixed(1)} kg, BMI: ${currentBMI > 0 ? currentBMI.toFixed(1) : '-'}`, 14, 42);
Â  Â  Â  Â  Â  Â  if (latestEntry.manualBMR || latestEntry.manualAMR) {
Â  Â  Â  Â  Â  Â  Â  Â  doc.text(`Posl. zadanÃ½ BMR: ${latestEntry.manualBMR || '-'} kcal, AMR: ${latestEntry.manualAMR || '-'} kcal`, 14, 48);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  doc.text(`TeoretickÃ½ BMR: ${theoBMR > 0 ? Math.round(theoBMR) : '-'} kcal, AMR: ${theoAMR > 0 ? Math.round(theoAMR) : '-'} kcal`, 14, 48);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  const tableColumn = ["#", "Datum", "VÃ¡ha", "BMI", "Tuk%", "Svaly%", "Voda%", "Zad.BMR", "Zad.AMR"];
Â  Â  Â  Â  const tableRows = [];
Â  Â  Â  Â  const sortedLog = [...weightLog].sort((a, b) => new Date(a.date) - new Date(b.date));

Â  Â  Â  Â  sortedLog.forEach((entry, index) => {
Â  Â  Â  Â  Â  Â  const bmi = window.calculateBMI(entry.weight, settings.height);
Â  Â  Â  Â  Â  Â  let musclePercentText = '-';
Â  Â  Â  Â  Â  Â  if (entry.muscleMass && entry.weight && entry.weight > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  musclePercentText = ((entry.muscleMass / entry.weight) * 100).toFixed(1);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  const rowData = [
Â  Â  Â  Â  Â  Â  Â  Â  index + 1, window.formatDateForDisplay(entry.date), entry.weight.toFixed(1),
Â  Â  Â  Â  Â  Â  Â  Â  bmi > 0 ? bmi.toFixed(1) : '-',
Â  Â  Â  Â  Â  Â  Â  Â  entry.bodyFat !== null && entry.bodyFat !== undefined ? entry.bodyFat.toFixed(1) : '-',
Â  Â  Â  Â  Â  Â  Â  Â  musclePercentText,
Â  Â  Â  Â  Â  Â  Â  Â  entry.bodyWater !== null && entry.bodyWater !== undefined ? entry.bodyWater.toFixed(1) : '-',
Â  Â  Â  Â  Â  Â  Â  Â  entry.manualBMR !== null && entry.manualBMR !== undefined ? entry.manualBMR : '-',
Â  Â  Â  Â  Â  Â  Â  Â  entry.manualAMR !== null && entry.manualAMR !== undefined ? entry.manualAMR : '-',
Â  Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  Â  tableRows.push(rowData);
Â  Â  Â  Â  });

Â  Â  Â  Â  doc.autoTable({ head: [tableColumn], body: tableRows, startY: 55, theme: 'grid', headStyles: { fillColor: [13, 17, 23], textColor: [0, 217, 255] }, styles: { font: "Consolas", cellPadding: 1.5, fontSize: 7 }, columnStyles: { 0: { cellWidth: 8 }, 1: { cellWidth: 20 }, } });
Â  Â  Â  Â  doc.save(`vaha_report_Jirik_${new Date().toISOString().split('T')[0]}.pdf`);
Â  Â  Â  Â  window.showNotification('PDF report dokonÄen!');
Â  Â  Â  Â  console.log("exportToPDF: Export PDF dokonÄen.");
Â  Â  };

Â  Â  window.exportChartsAsPDF = function() {
Â  Â  Â  Â  console.log("exportChartsAsPDF: SpuÅ¡tÄ›n export grafÅ¯ do PDF.");
Â  Â  Â  Â  if (weightLog.length === 0) { window.showNotification("NenÃ­ co exportovat.", 2000); console.warn("exportChartsAsPDF: Å½Ã¡dnÃ¡ data pro export."); return; }
Â  Â  Â  Â  const { jsPDF } = window.jspdf;
Â  Â  Â  Â  const doc = new jsPDF('p', 'mm', 'a4');
Â  Â  Â  Â  let yPos = 20; const chartWidth = 180; const chartHeight = 70; const spacing = 10;
Â  Â  Â  Â  doc.setFontSize(18); doc.text('Grafy vÃ½voje - AdmirÃ¡l JiÅ™Ã­k', doc.internal.pageSize.getWidth() / 2, 15, { align: 'center' });
Â  Â  Â  Â  const chartsToExport = [
Â  Â  Â  Â  Â  Â  { canvasId: 'weightChart', title: 'VÃ½voj vÃ¡hy' }, { canvasId: 'bmiChart', title: 'VÃ½voj BMI' },
Â  Â  Â  Â  Â  Â  { canvasId: 'bodyFatOnlyChart', title: 'VÃ½voj tÄ›lesnÃ©ho tuku (%)' }, { canvasId: 'muscleMassOnlyChart', title: 'VÃ½voj svalovÃ© hmoty (%)' },
Â  Â  Â  Â  Â  Â  { canvasId: 'bodyWaterChart', title: 'VÃ½voj vody v tÄ›le (%)' }, { canvasId: 'manualBMRChart', title: 'VÃ½voj zadanÃ©ho BMR (kcal)' },
Â  Â  Â  Â  Â  Â  { canvasId: 'manualAMRChart', title: 'VÃ½voj zadanÃ©ho AMR (kcal)' }
Â  Â  Â  Â  ];
Â  Â  Â  Â  chartsToExport.forEach((chartInfo, index) => {
Â  Â  Â  Â  Â  Â  const canvas = document.getElementById(chartInfo.canvasId);
Â  Â  Â  Â  Â  Â  const chartInstance = Chart.getChart(canvas);
Â  Â  Â  Â  Â  Â  let hasData = false;
Â  Â  Â  Â  Â  Â  if (chartInstance && chartInstance.data.labels.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  hasData = chartInstance.data.datasets.some(dataset => dataset.data.some(d => d !== null && !isNaN(d) && d !== undefined));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (!hasData) return;
Â  Â  Â  Â  Â  Â  if (yPos + chartHeight + spacing > doc.internal.pageSize.getHeight() - 15 && index > 0) { doc.addPage(); yPos = 20; }
Â  Â  Â  Â  Â  Â  doc.setFontSize(12); doc.text(chartInfo.title, 15, yPos); yPos += 5;
Â  Â  Â  Â  Â  Â  const imgData = canvas.toDataURL('image/png', 0.95);
Â  Â  Â  Â  Â  Â  doc.addImage(imgData, 'PNG', 15, yPos, chartWidth, chartHeight); yPos += chartHeight + spacing;
Â  Â  Â  Â  });
Â  Â  Â  Â  doc.save(`vaha_grafy_Jirik_${new Date().toISOString().split('T')[0]}.pdf`);
Â  Â  Â  Â  window.showNotification('Grafy exportovÃ¡ny do PDF!');
Â  Â  Â  Â  console.log("exportChartsAsPDF: Export grafÅ¯ dokonÄen.");
Â  Â  };

Â  Â  window.exportBackup = function() {
Â  Â  Â  Â  console.log("exportBackup: SpuÅ¡tÄ›no vytvÃ¡Å™enÃ­ ÃºplnÃ© zÃ¡lohy.");
Â  Â  Â  Â  const backupData = {
Â  Â  Â  Â  Â  Â  weightLog: weightLog, settings: settings, goals: goals,
Â  Â  Â  Â  Â  Â  exportDate: new Date().toISOString(), appName: "PokroÄilÃ½ vÃ¡hovÃ½ tracker vÃ­ce admirÃ¡la JiÅ™Ã­ka", version: "1.5.0"
Â  Â  Â  Â  };
Â  Â  Â  Â  const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
Â  Â  Â  Â  const link = document.createElement('a');
Â  Â  Â  Â  link.href = URL.createObjectURL(blob);
Â  Â  Â  Â  link.download = `vaha_zaloha_Jirik_${new Date().toISOString().split('T')[0]}.json`;
Â  Â  Â  Â  document.body.appendChild(link); link.click(); document.body.removeChild(link);
Â  Â  Â  Â  window.showNotification('ÃšplnÃ¡ zÃ¡loha vytvoÅ™ena!');
Â  Â  Â  Â  console.log("exportBackup: ÃšplnÃ¡ zÃ¡loha vytvoÅ™ena.");
Â  Â  };

Â  Â  window.importFromCSV = async function(inputElement) {
Â  Â  Â  Â  console.log("importFromCSV: SpuÅ¡tÄ›n import dat z CSV.");
Â  Â  Â  Â  const file = inputElement.files[0]; if (!file) { console.warn("importFromCSV: Å½Ã¡dnÃ½ soubor vybrÃ¡n."); return; }
Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  reader.onload = async function(e) {
Â  Â  Â  Â  Â  Â  console.log("importFromCSV: Soubor CSV naÄten.");
Â  Â  Â  Â  Â  Â  const csv = e.target.result; const lines = csv.split(/\r\n|\n/);
Â  Â  Â  Â  Â  Â  if (lines.length <= 1) { window.showNotification('CSV soubor je prÃ¡zdnÃ½ nebo neobsahuje data.', 3000); console.warn("importFromCSV: CSV soubor je prÃ¡zdnÃ½."); inputElement.value = ''; return; }
Â  Â  Â  Â  Â  Â  const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
Â  Â  Â  Â  Â  Â  const muscleKgOrPercentIdx = headers.indexOf('svalova hmota (kg)') !== -1 ? headers.indexOf('svalova hmota (kg)') : headers.indexOf('svalova hmota (%)');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const dateIdx = headers.indexOf('datum'); const weightIdx = headers.indexOf('vaha (kg)');
Â  Â  Â  Â  Â  Â  const fatIdx = headers.indexOf('telesny tuk (%)'); const waterIdx = headers.indexOf('voda v tele (%)');
Â  Â  Â  Â  Â  Â  const manualBmrIdx = headers.indexOf('manual bmr'); const manualAmrIdx = headers.indexOf('manual amr');
Â  Â  Â  Â  Â  Â  const notesIdx = headers.indexOf('poznamky');

Â  Â  Â  Â  Â  Â  let importedCount = 0; let skippedCount = 0;
Â  Â  Â  Â  Â  Â  console.log(`importFromCSV: ZpracovÃ¡vÃ¡m ${lines.length - 1} Å™Ã¡dkÅ¯ CSV.`);
Â  Â  Â  Â  Â  Â  for (let i = 1; i < lines.length; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  const data = lines[i].split(',');
Â  Â  Â  Â  Â  Â  Â  Â  const date = data[dateIdx] ? data[dateIdx].trim() : null;
Â  Â  Â  Â  Â  Â  Â  Â  const weight = data[weightIdx] ? parseFloat(data[weightIdx].trim()) : null;
Â  Â  Â  Â  Â  Â  Â  Â  if (!date || !weight || isNaN(weight)) { skippedCount++; console.warn(`importFromCSV: PÅ™eskoÄen neplatnÃ½ Å™Ã¡dek ${i}: ${lines[i]}`); continue; }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let muscleMassKg = null;
Â  Â  Â  Â  Â  Â  Â  Â  if (muscleKgOrPercentIdx !== -1 && data[muscleKgOrPercentIdx] && !isNaN(parseFloat(data[muscleKgOrPercentIdx].trim()))) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (headers[muscleKgOrPercentIdx] === 'svalova hmota (%)') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const percent = parseFloat(data[muscleKgOrPercentIdx].trim());
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  muscleMassKg = parseFloat(((percent / 100) * weight).toFixed(2));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else { muscleMassKg = parseFloat(data[muscleKgOrPercentIdx].trim()); }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  const newEntry = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  date: date, weight: weight, bodyFat: fatIdx !== -1 && data[fatIdx] ? parseFloat(data[fatIdx].trim()) : null,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  muscleMass: muscleMassKg, bodyWater: waterIdx !== -1 && data[waterIdx] ? parseFloat(data[waterIdx].trim()) : null,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  manualBMR: manualBmrIdx !== -1 && data[manualBmrIdx] ? parseInt(data[manualBmrIdx].trim()) : null,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  manualAMR: manualAmrIdx !== -1 && data[manualAmrIdx] ? parseInt(data[manualAmrIdx].trim()) : null,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  notes: notesIdx !== -1 && data[notesIdx] ? data[notesIdx].trim().replace(/^"|"$/g, '') : ""
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  const existingIndex = weightLog.findIndex(entry => entry.date === newEntry.date);
Â  Â  Â  Â  Â  Â  Â  Â  if (existingIndex !== -1) { weightLog[existingIndex] = newEntry; console.log(`importFromCSV: AktualizovÃ¡n zÃ¡znam pro datum ${date}.`); } else { weightLog.push(newEntry); console.log(`importFromCSV: PÅ™idÃ¡n novÃ½ zÃ¡znam pro datum ${date}.`); }
Â  Â  Â  Â  Â  Â  Â  Â  importedCount++;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (importedCount > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  console.log("importFromCSV: UklÃ¡dÃ¡m importovanÃ¡ data.");
Â  Â  Â  Â  Â  Â  Â  Â  await window.saveData(); // VolÃ¡me globÃ¡lnÃ­ saveData()
Â  Â  Â  Â  Â  Â  Â  Â  window.updateDisplay(); // VolÃ¡me globÃ¡lnÃ­ updateDisplay()
Â  Â  Â  Â  Â  Â  Â  Â  window.showNotification(`ImportovÃ¡no ${importedCount} zÃ¡znamÅ¯. ${skippedCount > 0 ? skippedCount + ' pÅ™eskoÄeno.' : ''}`);
Â  Â  Â  Â  Â  Â  } else { window.showNotification('Nebyly nalezeny Å¾Ã¡dnÃ© platnÃ© zÃ¡znamy k importu v CSV.', 3000); }
Â  Â  Â  Â  Â  Â  inputElement.value = '';
Â  Â  Â  Â  Â  Â  console.log("importFromCSV: Import CSV dokonÄen.");
Â  Â  Â  Â  };
Â  Â  Â  Â  reader.readAsText(file);
Â  Â  };

Â  Â  window.importFromBackup = async function(inputElement) { // GlobalizovÃ¡no a async
Â  Â  Â  Â  console.log("importFromBackup: SpuÅ¡tÄ›n import ze zÃ¡lohy.");
Â  Â  Â  Â  const file = inputElement.files[0]; if (!file) { console.warn("importFromBackup: Å½Ã¡dnÃ½ soubor zÃ¡lohy vybrÃ¡n."); return; }
Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  reader.onload = async function(e) { // async vnoÅ™enÃ¡ funkce
Â  Â  Â  Â  Â  Â  console.log("importFromBackup: Soubor zÃ¡lohy naÄten.");
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const backupData = JSON.parse(e.target.result);
Â  Â  Â  Â  Â  Â  Â  Â  console.log("importFromBackup: Data zÃ¡lohy analyzovÃ¡na:", backupData);
Â  Â  Â  Â  Â  Â  Â  Â  if (backupData.appName !== "PokroÄilÃ½ vÃ¡hovÃ½ tracker vÃ­ce admirÃ¡la JiÅ™Ã­ka") {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.warn("importFromBackup: Soubor zÃ¡lohy nepochÃ¡zÃ­ z tÃ©to aplikace. Dotazuji uÅ¾ivatele na pokraÄovÃ¡nÃ­.");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!confirm("ZdÃ¡ se, Å¾e tento soubor nepochÃ¡zÃ­ z tÃ©to aplikace. PÅ™esto pokraÄovat?")) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  inputElement.value = ''; console.log("importFromBackup: Import zÃ¡lohy zruÅ¡en uÅ¾ivatelem."); return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  if (backupData.weightLog) { weightLog = backupData.weightLog; console.log("importFromBackup: weightLog ze zÃ¡lohy naÄten."); }
Â  Â  Â  Â  Â  Â  Â  Â  if (backupData.settings) { settings = { ...settings, ...backupData.settings }; console.log("importFromBackup: NastavenÃ­ ze zÃ¡lohy naÄtena."); }
Â  Â  Â  Â  Â  Â  Â  Â  if (backupData.goals) { goals = { ...goals, ...backupData.goals }; console.log("importFromBackup: CÃ­le ze zÃ¡lohy naÄteny."); }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  weightLog.forEach(entry => { // ZajiÅ¡tÄ›nÃ­ kompatibility starÅ¡Ã­ch zÃ¡znamÅ¯
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (entry.manualBMR === undefined) entry.manualBMR = null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (entry.manualAMR === undefined) entry.manualAMR = null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (entry.muscleMass === undefined) entry.muscleMass = null;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  console.log("importFromBackup: Data zÃ¡lohy pÅ™ipravena, uklÃ¡dÃ¡m.");
Â  Â  Â  Â  Â  Â  Â  Â  await window.saveData(); // VolÃ¡me globÃ¡lnÃ­ saveData()
Â  Â  Â  Â  Â  Â  Â  Â  window.updateForms(); // VolÃ¡me globÃ¡lnÃ­ updateForms()
Â  Â  Â  Â  Â  Â  Â  Â  window.updateDisplay(); // VolÃ¡me globÃ¡lnÃ­ updateDisplay()
Â  Â  Â  Â  Â  Â  Â  Â  window.showNotification('ZÃ¡loha ÃºspÄ›Å¡nÄ› obnovena!');
Â  Â  Â  Â  Â  Â  Â  Â  console.log("importFromBackup: Import zÃ¡lohy dokonÄen.");
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  window.showNotification('Chyba pÅ™i naÄÃ­tÃ¡nÃ­ zÃ¡lohy: ' + error.message, 4000);
Â  Â  Â  Â  Â  Â  Â  Â  console.error("importFromBackup: Chyba pÅ™i zpracovÃ¡nÃ­ souboru zÃ¡lohy:", error);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  inputElement.value = '';
Â  Â  Â  Â  };
Â  Â  Â  Â  reader.readAsText(file);
Â  Â  };

Â  Â  window.clearAllData = async function() {
Â  Â  Â  Â  console.log("clearAllData: SpuÅ¡tÄ›n proces mazÃ¡nÃ­ vÅ¡ech dat.");
Â  Â  Â  Â  if (confirm('âš ï¸ OPRAVDU chcete smazat VÅ ECHNA data? Tuto akci nelze vrÃ¡tit zpÄ›t!')) {
Â  Â  Â  Â  Â  Â  console.log("clearAllData: UÅ¾ivatel potvrdil 1. fÃ¡zi mazÃ¡nÃ­.");
Â  Â  Â  Â  Â  Â  if (confirm('âš ï¸ JSTE SI ABSOLUTNÄš JISTI? VÅ¡echna data budou nenÃ¡vratnÄ› ztracena!')) {
Â  Â  Â  Â  Â  Â  Â  Â  console.log("clearAllData: UÅ¾ivatel potvrdil 2. fÃ¡zi mazÃ¡nÃ­. MaÅ¾u data.");
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.removeItem('weightLog_JirikTracker_v2_charts_separated_musclePercent');
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.removeItem('weightSettings_JirikTracker_v2_charts_separated_musclePercent');
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.removeItem('weightGoals_JirikTracker_v2_charts_separated_musclePercent');
Â  Â  Â  Â  Â  Â  Â  Â  console.log("clearAllData: LokÃ¡lnÃ­ data smazÃ¡na z LocalStorage.");
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("clearAllData: PokouÅ¡Ã­m se smazat vÅ¡echna data z Firebase Firestore.");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await window.clearAllFirestoreData(); // Tato funkce je definovÃ¡na v firebaseFunctions.js
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("clearAllData: VÅ¡echna data ÃºspÄ›Å¡nÄ› smazÃ¡na z Firebase Firestore.");
Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("clearAllData: Chyba pÅ™i mazÃ¡nÃ­ vÅ¡ech dat z Firebase Firestore:", error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.showNotification("Chyba pÅ™i mazÃ¡nÃ­ dat z cloudu! SmaÅ¾te je prosÃ­m ruÄnÄ› v konzoli Firebase.", 8000);
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  weightLog = [];
Â  Â  Â  Â  Â  Â  Â  Â  // Reset settings a goals na vÃ½chozÃ­ hodnoty
Â  Â  Â  Â  Â  Â  Â  Â  settings = { height: 174, age: null, gender: 'male', activityLevel: 1.55, bmiWarningUpper: 25, bmiDangerUpper: 30, bmiWarningLower: 18.5, reminderEnabled: true, reminderInterval: 7 };
Â  Â  Â  Â  Â  Â  Â  Â  goals = { targetWeight: null, targetBMI: null, targetDate: null, weeklyGoal: null };
Â  Â  Â  Â  Â  Â  Â  Â  console.log("clearAllData: GlobÃ¡lnÃ­ promÄ›nnÃ© resetovÃ¡ny na vÃ½chozÃ­ hodnoty.");
Â  Â  Â  Â  Â  Â  Â  Â  await window.loadData(); // VolÃ¡me globÃ¡lnÃ­ loadData() pro opÄ›tovnÃ© naÄtenÃ­ (nynÃ­ prÃ¡zdnÃ© nebo vÃ½chozÃ­)
Â  Â  Â  Â  Â  Â  Â  Â  window.showNotification('VÅ¡echna data byla smazÃ¡na!');
Â  Â  Â  Â  Â  Â  Â  Â  console.log("clearAllData: Proces mazÃ¡nÃ­ vÅ¡ech dat dokonÄen.");
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  console.log("clearAllData: MazÃ¡nÃ­ vÅ¡ech dat zruÅ¡eno uÅ¾ivatelem (2. fÃ¡ze).");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  console.log("clearAllData: MazÃ¡nÃ­ vÅ¡ech dat zruÅ¡eno uÅ¾ivatelem (1. fÃ¡ze).");
Â  Â  Â  Â  }
Â  Â  };

Â  Â  window.checkReminders = function() {
Â  Â  Â  Â  console.log("checkReminders: Kontroluji, zda je tÅ™eba zobrazit pÅ™ipomÃ­nku.");
Â  Â  Â  Â  if (!settings.reminderEnabled) {
Â  Â  Â  Â  Â  Â  console.log("checkReminders: PÅ™ipomÃ­nky jsou zakÃ¡zÃ¡ny.");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  if (weightLog.length === 0) {
Â  Â  Â  Â  Â  Â  console.log("checkReminders: Å½Ã¡dnÃ© zÃ¡znamy vÃ¡hy, pÅ™ipomÃ­nka nenÃ­ nutnÃ¡.");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  const lastEntry = [...weightLog].sort((a, b) => new Date(b.date) - new Date(a.date))[0];
Â  Â  Â  Â  if (lastEntry) {
Â  Â  Â  Â  Â  Â  const daysSinceLastEntry = Math.floor((new Date() - new Date(lastEntry.date)) / (1000 * 60 * 60 * 24));
Â  Â  Â  Â  Â  Â  console.log(`checkReminders: DnÃ­ od poslednÃ­ho zÃ¡znamu (${window.formatDateForDisplay(lastEntry.date)}): ${daysSinceLastEntry}. Interval: ${settings.reminderInterval}.`);
Â  Â  Â  Â  Â  Â  if (daysSinceLastEntry >= settings.reminderInterval) {
Â  Â  Â  Â  Â  Â  Â  Â  window.showNotification(`â° PÅ™ipomÃ­nka: PoslednÃ­ zÃ¡znam vÃ¡hy byl pÅ™ed ${daysSinceLastEntry} dny (${window.formatDateForDisplay(lastEntry.date)})!`, 5000);
Â  Â  Â  Â  Â  Â  Â  Â  console.log("checkReminders: Zobrazena pÅ™ipomÃ­nka.");
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  console.log("checkReminders: PÅ™ipomÃ­nka nenÃ­ nutnÃ¡, interval jeÅ¡tÄ› nevyprÅ¡el.");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  };
Â  Â  setInterval(window.checkReminders, 30 * 60 * 1000); // PouÅ¾Ã­vÃ¡me globÃ¡lnÃ­ checkReminders


Â  Â  window.toggleFullScreen = function() {
Â  Â  Â  Â  console.log("toggleFullScreen: Pokus o pÅ™epnutÃ­ reÅ¾imu celÃ© obrazovky.");
Â  Â  Â  Â  const elem = document.documentElement;
Â  Â  Â  Â  const btn = document.getElementById('fullscreen-btn');
Â  Â  Â  Â  if (!document.fullscreenElement) {
Â  Â  Â  Â  Â  Â  console.log("toggleFullScreen: Vstupuji do celoobrazovkovÃ©ho reÅ¾imu.");
Â  Â  Â  Â  Â  Â  if (elem.requestFullscreen) elem.requestFullscreen().catch(err => console.error(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`));
Â  Â  Â  Â  Â  Â  else if (elem.mozRequestFullScreen) elem.mozRequestFullScreen();
Â  Â  Â  Â  Â  Â  else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
Â  Â  Â  Â  Â  Â  else if (elem.msRequestFullscreen) elem.msRequestFullscreen();
Â  Â  Â  Â  Â  Â  if(btn) btn.innerHTML = '&#10006;';
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  console.log("toggleFullScreen: OpouÅ¡tÃ­m celoobrazovkovÃ½ reÅ¾im.");
Â  Â  Â  Â  Â  Â  if (document.exitFullscreen) document.exitFullscreen();
Â  Â  Â  Â  Â  Â  else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
Â  Â  Â  Â  Â  Â  else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
Â  Â  Â  Â  Â  Â  else if (elem.msExitFullscreen) elem.msExitFullscreen();
Â  Â  Â  Â  Â  Â  if(btn) btn.innerHTML = '&#x26F6;';
Â  Â  Â  Â  }
Â  Â  Â  Â  console.log("toggleFullScreen: PÅ™epnutÃ­ reÅ¾imu celÃ© obrazovky dokonÄeno.");
Â  Â  };
Â  Â Â 
Â  Â  window.updateFullscreenButtonIcon = function() {
Â  Â  Â  Â  // console.log("updateFullscreenButtonIcon: Aktualizuji ikonu fullscreen tlaÄÃ­tka."); // Velmi ÄastÃ© volÃ¡nÃ­
Â  Â  Â  Â  const btn = document.getElementById('fullscreen-btn');
Â  Â  Â  Â  if(!btn) return;
Â  Â  Â  Â  if (document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement || document.msFullscreenElement) {
Â  Â  Â  Â  Â  Â  btn.innerHTML = '&#10006;';
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  btn.innerHTML = '&#x26F6;';
Â  Â  Â  Â  }
Â  Â  };

Â  Â  // Funkce pro aktualizaci vÅ¡ech ÃºdajÅ¯ z tlaÄÃ­tka
Â  Â  window.refreshAllData = async function() {
Â  Â  Â  Â  console.log("refreshAllData: SpuÅ¡tÄ›na ruÄnÃ­ aktualizace vÅ¡ech ÃºdajÅ¯ (z tlaÄÃ­tka).");
Â  Â  Â  Â  // NejdÅ™Ã­ve zniÄÃ­me existujÃ­cÃ­ instance grafÅ¯, neÅ¾ je znovu inicializujeme
Â  Â  Â  Â  if (weightChart) { weightChart.destroy(); console.log("refreshAllData: weightChart zniÄen."); }
Â  Â  Â  Â  if (bmiChart) { bmiChart.destroy(); console.log("refreshAllData: bmiChart zniÄen."); }
Â  Â  Â  Â  if (bodyFatOnlyChart) { bodyFatOnlyChart.destroy(); console.log("refreshAllData: bodyFatOnlyChart zniÄen."); }
Â  Â  Â  Â  if (muscleMassOnlyChart) { muscleMassOnlyChart.destroy(); console.log("refreshAllData: muscleMassOnlyChart zniÄen."); }
Â  Â  Â  Â  if (bodyWaterChart) { bodyWaterChart.destroy(); console.log("refreshAllData: bodyWaterChart zniÄen."); }
Â  Â  Â  Â  if (manualBMRChart) { manualBMRChart.destroy(); console.log("refreshAllData: manualBMRChart zniÄen."); }
Â  Â  Â  Â  if (manualAMRChart) { manualAMRChart.destroy(); console.log("refreshAllData: manualAMRChart zniÄen."); }

Â  Â  Â  Â  await window.loadData(); // VolÃ¡me globÃ¡lnÃ­ loadData()
Â  Â  Â  Â  window.updateForms(); // VolÃ¡me globÃ¡lnÃ­ updateForms()
Â  Â  Â  Â  window.initializeCharts(); // VolÃ¡me globÃ¡lnÃ­ initializeCharts()
Â  Â  Â  Â  window.updateDisplay(); // VolÃ¡me globÃ¡lnÃ­ updateDisplay()
Â  Â  Â  Â  window.checkReminders(); // VolÃ¡me globÃ¡lnÃ­ checkReminders()
Â  Â  Â  Â  window.showNotification('VÅ¡echny Ãºdaje byly ÃºspÄ›Å¡nÄ› aktualizovÃ¡ny (vÄetnÄ› cloudu)!', 3000);
Â  Â  Â  Â  console.log("refreshAllData: RuÄnÃ­ aktualizace dokonÄena.");
Â  Â  };

Â  Â  // HlavnÃ­ inicializaÄnÃ­ logika po naÄtenÃ­ DOM
Â  Â  document.addEventListener('DOMContentLoaded', async function() {
Â  Â  Â  Â  console.log("DOMContentLoaded: DOM plnÄ› naÄten. SpouÅ¡tÃ­m hlavnÃ­ inicializaci aplikace.");
Â  Â  Â  Â  
        // ***** ZAÄŒÃTEK KÃ“DU PRO REGISTRACI SERVICE WORKERU *****
        // Tato sekce se starÃ¡ o to, aby prohlÃ­Å¾eÄ vÄ›dÄ›l o Service Workeru pro PUSH NOTIFIKACE
        if ('serviceWorker' in navigator) {
            // PouÅ¾ijte pÅ™esnou zÃ¡kladnÃ­ cestu k vaÅ¡emu GitHub Pages projektu.
            // Toto je klÃ­ÄovÃ©, protoÅ¾e vÃ¡Å¡ projekt nenÃ­ pÅ™Ã­mo v koÅ™eni domÃ©ny jirka22med.github.io,
            // ale v podsloÅ¾ce 'jirikuv-vahovy-tracker-BETA-2'.
            // ÃšplnÃ¡ URL Service Workeru bude: https://jirka22med.github.io/jirikuv-vahovy-tracker-BETA-2/firebase-messaging-sw.js
            const githubPagesBase = '/jirikuv-vahovy-tracker-BETA-2/'; 
            
            navigator.serviceWorker.register(githubPagesBase + 'firebase-messaging-sw.js', { scope: githubPagesBase })
                .then((registration) => {
                    console.log('Service Worker zaregistrovÃ¡n s rozsahem:', registration.scope);
                    // DÅ¯leÅ¾itÃ©: Å½Ã¡dost o povolenÃ­ notifikacÃ­ se volÃ¡ zde,
                    // jakmile je Service Worker ÃºspÄ›Å¡nÄ› zaregistrovÃ¡n.
                    window.requestNotificationPermission(); 
                })
                .catch((error) => {
                    console.error('Registrace Service Workeru selhala:', error);
                    window.showNotification("Chyba pÅ™i inicializaci upozornÄ›nÃ­. Zkuste prosÃ­m naÄÃ­st strÃ¡nku znovu.", 5000);
                });
        }
        // ***** KONEC KÃ“DU PRO REGISTRACI SERVICE WORKERU *****

Â  Â  Â  Â  // Inicializujeme Firebase aplikaci a Firestore databÃ¡zi pomocÃ­ funkce z firebaseFunctions.js
Â  Â  Â  Â  if (window.initializeFirebaseApp()) {
Â  Â  Â  Â  Â  Â  console.log("DOMContentLoaded: Firebase inicializace dokonÄena v hlavnÃ­ strÃ¡nce. PokouÅ¡Ã­m se naÄÃ­st data.");
Â  Â  Â  Â  Â  Â  // NynÃ­, kdyÅ¾ je Firebase pÅ™ipraveno, mÅ¯Å¾eme naÄÃ­st data
Â  Â  Â  Â  Â  Â  await window.loadData();
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  console.error("DOMContentLoaded: KritickÃ¡ chyba: NepodaÅ™ilo se inicializovat Firebase. Aplikace bude fungovat pouze s LocalStorage daty.");
Â  Â  Â  Â  Â  Â  window.showNotification("KritickÃ¡ chyba: Nelze se pÅ™ipojit k databÃ¡zi. Data se uklÃ¡dajÃ­ pouze lokÃ¡lnÄ›!", 8000);
Â  Â  Â  Â  Â  Â  // I pÅ™es selhÃ¡nÃ­ Firebase se pokusÃ­me naÄÃ­st z LocalStorage a zobrazit UI
Â  Â  Â  Â  Â  Â  await window.loadData(); // SpustÃ­ naÄÃ­tÃ¡nÃ­ (fallback na LocalStorage)
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  console.log("DOMContentLoaded: Inicializuji grafy a aktualizuji zobrazenÃ­.");
Â  Â  Â  Â  window.initializeCharts();
Â  Â  Â  Â  window.updateDisplay();
Â  Â  Â  Â  window.checkReminders();
Â  Â  Â  Â  window.setTodayDate();

Â  Â  Â  Â  // PÅ™idÃ¡nÃ­ tlaÄÃ­tka na celou obrazovku
Â  Â  Â  Â  const fullscreenButton = document.createElement('button');
Â  Â  Â  Â  fullscreenButton.className = 'fullscreen';
Â  Â  Â  Â  fullscreenButton.id = 'fullscreen-btn';
Â  Â  Â  Â  fullscreenButton.innerHTML = '&#x26F6;';
Â  Â  Â  Â  fullscreenButton.title = 'PÅ™epnout na celou obrazovku';
Â  Â  Â  Â  fullscreenButton.addEventListener('click', window.toggleFullScreen);
Â  Â  Â  Â  document.body.appendChild(fullscreenButton);
Â  Â  Â  Â  console.log("DOMContentLoaded: Fullscreen tlaÄÃ­tko pÅ™idÃ¡no.");

Â  Â  Â  Â  ['fullscreenchange', 'mozfullscreenchange', 'webkitfullscreenchange', 'msfullscreenchange'].forEach(event => {
Â  Â  Â  Â  Â  Â  document.addEventListener(event, window.updateFullscreenButtonIcon);
Â  Â  Â  Â  Â  Â  console.log(`DOMContentLoaded: PosluchaÄ udÃ¡losti ${event} pÅ™idÃ¡n.`);
Â  Â  Â  Â  });
Â  Â  Â  Â  console.log("DOMContentLoaded: HlavnÃ­ inicializace aplikace dokonÄena.");
Â  Â  });

</script>
</body>
</html>
