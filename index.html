<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Pokroƒçil√Ω v√°hov√Ω tracker v√≠ce admir√°la Ji≈ô√≠ka</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
¬† <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
¬† <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
¬† ¬†¬†
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-messaging.js"></script> ¬† ¬†¬†
<script src="firebaseFunctions.js"></script>
  <style>
body {
  background: #0d1117;
  color: #f0f0f0;
  font-family: Consolas, monospace;
  padding: 20px;
  margin: 0;
  text-align: center;    
}

.container {
  max-width: 1350px; /* Trochu ≈°ir≈°√≠ kontejner pro v√≠ce sloupc≈Ø */
  margin: 0 auto;
}

h1, h2 {
  color: #00d9ff;
  text-align: center;
}

.dashboard {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
  margin: 20px 0;
}

.card {
  background: #1f2633;
  border: 1px solid #444;
  border-radius: 10px;
  padding: 20px;
  transition: transform 0.3s;
}

.card:hover {
  transform: translateY(-5px);
  border-color: #00d9ff;
}

.card h3 {
  color: #00ff99;
  margin-top: 0;
}

.form-group {
  margin: 15px 0;
}

label {
  display: block;
  margin-bottom: 5px;
  color: #00d9ff;
}

input, select, textarea {
  width: 100%;
  padding: 10px;
  background: #0d1117;
  border: 1px solid #444;
  color: #f0f0f0;
  border-radius: 5px;
  box-sizing: border-box;
}

input:focus, select:focus, textarea:focus {
  border-color: #00d9ff;
  outline: none;
}

button {
  background: #00d9ff;
  color: #000;
  padding: 10px 20px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  margin: 5px;
  transition: background 0.3s;
}

button:hover {
  background: #00b8cc;
}

button.danger {
  background: #ff5555;
  color: #fff;
}

button.success {
  background: #55ff99;
  color: #000;
}

button.fullscreen {
  background: #00d9ff;
  color: #000;
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 1000;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  font-size: 1.2rem;
}

button.fullscreen:hover {
  background: #00b8cc;
  transform: scale(1.1);
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  background: #1f2633;
  font-size: 0.9em; /* Men≈°√≠ p√≠smo pro v√≠ce sloupc≈Ø */
}

th, td {
  border: 1px solid #444;
  padding: 8px; /* Men≈°√≠ padding */
  text-align: center;
}

th {
  background: #0d1117;
  color: #00d9ff;
}

.gain {
  color: #ff5555;
}

.loss {
  color: #55ff99;
}

.bmi-normal { color: #55ff99; }
.bmi-underweight { color: #00d9ff; }
.bmi-overweight { color: #ffff55; }
.bmi-obese { color: #ff5555; }

.alert {
  padding: 15px;
  margin: 15px 0;
  border-radius: 5px;
  background: #ff5555;
  color: #fff;
  display: none;
}

.alert.show {
  display: block;
}

.stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); /* Je≈°tƒõ men≈°√≠ minmax pro v√≠ce polo≈æek */
  gap: 10px; /* Men≈°√≠ mezery */
  margin: 20px 0;
}

.stat-item {
  background: #1f2633;
  padding: 10px; /* Men≈°√≠ padding */
  border-radius: 10px;
  text-align: center;
  border: 1px solid #444;
}

.stat-value {
  font-size: 1.5em; /* Men≈°√≠ p√≠smo */
  font-weight: bold;
  color: #00d9ff;
}
.stat-label {
    font-size: 0.8em; /* Men≈°√≠ p√≠smo */
    color: #ccc;
    margin-top: 3px;
}


.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  background: #00d9ff;
  color: #000;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  display: none;
  z-index: 1000;
}

.progress-bar {
  width: 100%;
  height: 20px;
  background: #444;
  border-radius: 10px;
  overflow: hidden;
  margin: 10px 0;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #00d9ff, #00ff99);
  transition: width 0.3s;
}

.tabs {
  display: flex;
  margin: 20px 0;
  border-bottom: 1px solid #444;
}

.tab {
  padding: 10px 20px;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  color: #ccc;
}

.tab.active {
  color: #00d9ff;
  border-bottom-color: #00d9ff;
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}
  /* Obecn√© nastaven√≠ kontejneru pro grafy */
.charts-container {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
  justify-content: center;
  padding: 25px;
  background-color: #2c3e50;
  border-radius: 10px;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
}

/* Styl jednotliv√Ωch karet s grafem */
.chart-card {
  background-color: white;
  border-radius: 0px;
  padding: 40px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
  flex: 1 1 305px;
  max-width: 50px;
  min-width: 280px;
  transition: transform 0.3s ease;
   overflow-x: auto; /* p≈ôid√° scroll pokud se to nevejde */  
}

.chart-card:hover {
  transform: scale(1.02);
}

/* Nadpis grafu */
.chart-card h3 {
  margin-bottom: 15px;
  font-size: 20px;
  color: #2c3e50;
  text-align: center;
}

/* Canvas grafu */
.chart-card canvas {
  width: 100% !important;
  height: auto !important;
}

      
@media (max-width: 768px) { /* √öprava breakpointu pro lep≈°√≠ zobrazen√≠ tabulky */
  .stats {
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  }
   table {
    font-size: 0.75rem; /* Je≈°tƒõ men≈°√≠ p√≠smo pro mobily */
  }
  th, td {
    padding: 4px;
  }
}


@media (max-width: 480px) {
  body {
    padding: 10px;
  }
  h1, h2 {
    font-size: 1.5rem;
  }
  .dashboard {
    grid-template-columns: 1fr;
    gap: 15px;
  }
  .card {
    padding: 15px;
  }
  .charts-container {
    grid-template-columns: 1fr;
  }
  .chart-card {
    padding: 15px;
    overflow-x: auto;
  }
  .stats {
    grid-template-columns: 1fr 1fr; 
  }
  .stat-item {
    padding: 5px;
  }
  .stat-value {
    font-size: 1.2em;
  }
   .stat-label {
    font-size: 0.7em;
  }
  .notification {
    width: 80%;
    left: 10%;
    right: 10%;
  }
  .tabs {
    flex-direction: column;
    border-bottom: none;
  }
  .tab {
    border-bottom: 1px solid #444;
    padding: 8px 15px;
  }
  .tab.active {
    border-left: 3px solid #00d9ff;
    border-bottom: 1px solid #444;
  }
  button {
    min-height: 5px; /* Doporuƒçen√° minim√°ln√≠ v√Ω≈°ka pro dotyk */
        padding: 0px 0px; /* Vƒõt≈°√≠ padding pro snadnƒõj≈°√≠ dotyk */
        display: inline-flex; /* Zajist√≠, ≈æe text je vycentrovan√Ω vertik√°lnƒõ */
        align-items: center;
        justify-content: center;
  }
  button.fullscreen {
    width: 40px !important;
    height: 40px !important;
    bottom: 10px !important;
    right: 10px !important;
  }
  table {
    font-size: 0.65rem; /* Extr√©mnƒõ mal√© p√≠smo - zv√°≈æit skryt√≠ sloupc≈Ø */
    display: block; /* Umo≈æn√≠ horizont√°ln√≠ scroll pro tabulku */
    overflow-x: auto; /* P≈ôid√° horizont√°ln√≠ scroll pro tabulku */
  }
  th, td {
    padding: 3px;
     white-space: nowrap; /* Zabr√°n√≠ zalomen√≠ textu v bu≈àk√°ch */
  }
}

.charts-container {
  display: grid; 
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
  gap: 20px; 
  padding: 20px; 
  background-color: #1a222d; 
  border-radius: 10px;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
  margin-top: 20px; 
}

.chart-card {
  background-color: #1f2633; 
  border-radius: 10px; 
  padding: 20px; 
  box-shadow: none; 
  border: 1px solid #444; 
  transition: transform 0.3s ease, border-color 0.3s ease; 
  overflow-x: auto;
}
.chart-card:hover {
  transform: translateY(-5px); 
  border-color: #00d9ff; 
}

.chart-card h3 {
  margin-bottom: 15px;
  font-size: 1.2rem; 
  color: #00ff99; 
  text-align: center;
}

.chart-card canvas {
  width: 100% !important;
  height: auto !important;
  max-height: 200px; 
}

/* ===== MOBILN√ç RESPONZIVITA - KOMPLETN√ç @MEDIA QUERIES ===== */

/* Tablety a men≈°√≠ desktopy */
@media (max-width: 1024px) {
  .container {
    max-width: 95%;
    padding: 0 10px;
  }
  
  .dashboard {
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 15px;
  }
  
  .charts-container {
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 15px;
    padding: 15px;
  }
  
  .stats {
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  }
}

/* Vƒõt≈°√≠ mobily a mal√© tablety */
@media (max-width: 768px) {
  body {
    padding: 15px 10px;
    font-size: 14px;
  }
  
  .container {
    max-width: 100%;
    padding: 0 5px;
  }
  
  h1 {
    font-size: 1.8rem;
    margin: 15px 0;
  }
  
  h2 {
    font-size: 1.4rem;
    margin: 12px 0;
  }
  
  .dashboard {
    grid-template-columns: 1fr;
    gap: 12px;
    margin: 15px 0;
  }
  
  .card {
    padding: 15px;
    margin: 0 5px;
  }
  
  .card h3 {
    font-size: 1.1rem;
    margin-bottom: 10px;
  }
  
  /* Formul√°≈ôov√© prvky */
  input, select, textarea {
    padding: 12px 8px;
    font-size: 16px; /* Zabr√°n√≠ zoomov√°n√≠ na iOS */
    border-radius: 8px;
  }
  
  button {
    min-height: 5px; /* Doporuƒçen√° minim√°ln√≠ v√Ω≈°ka pro dotyk */
        padding: 0px 0px; /* Vƒõt≈°√≠ padding pro snadnƒõj≈°√≠ dotyk */
        display: inline-flex; /* Zajist√≠, ≈æe text je vycentrovan√Ω vertik√°lnƒõ */
        align-items: center;
        justify-content: center;
  }
  
  /* Tabulky */
  table {
    font-size: 0.8rem;
    display: block;
    overflow-x: auto;
    white-space: nowrap;
    border-radius: 8px;
  }
  
  th, td {
    padding: 6px 4px;
    min-width: 60px;
  }
  
  /* Statistiky */
  .stats {
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 8px;
  }
  
  .stat-item {
    padding: 12px 8px;
  }
  
  .stat-value {
    font-size: 1.3em;
  }
  
  .stat-label {
    font-size: 0.75em;
  }
  
  /* Grafy */
  .charts-container {
    grid-template-columns: 1fr;
    gap: 12px;
    padding: 12px;
    margin: 15px 0;
  }
  
  .chart-card {
    padding: 15px;
    margin: 0;
    min-width: unset;
    max-width: 100%;
  }
  
  .chart-card h3 {
    font-size: 1rem;
    margin-bottom: 10px;
  }
  
  .chart-card canvas {
    max-height: 250px;
  }
  
  /* Taby */
  .tabs {
    flex-wrap: wrap;
    gap: 2px;
    margin: 2px 0;
  }
  
  .tab {
    padding: 8px 12px;
    font-size: 0.9rem;
    flex: 1;
    text-align: center;
    min-width: 80px;
  }
  
  /* Progress bar */
  .progress-bar {
    height: 25px;
    margin: 15px 0;
  }
  
  /* Notifikace */
  .notification {
    width: 85%;
    left: 7.5%;
    right: 7.5%;
    top: 15px;
    padding: 12px;
    font-size: 0.9rem;
  }
  
  /* Fullscreen tlaƒç√≠tko */
  button.fullscreen {
    width: 45px;
    height: 45px;
    bottom: 15px;
    right: 15px;
    font-size: 1.1rem;
  }
}

/* Standardn√≠ mobily */
@media (max-width: 480px) {
  body {
    padding: 10px 5px;
    font-size: 13px;
  }
  
  .container {
    padding: 0;
  }
  
  h1 {
    font-size: 1.5rem;
    margin: 10px 0;
    line-height: 1.3;
  }
  
  h2 {
    font-size: 1.2rem;
    margin: 8px 0;
    line-height: 1.3;
  }
  
  .dashboard {
    gap: 10px;
    margin: 10px 0;
  }
  
  .card {
    padding: 12px;
    margin: 0 2px;
    border-radius: 8px;
  }
  
  .card h3 {
    font-size: 1rem;
    margin-bottom: 8px;
  }
  
  /* Formul√°≈ôe */
  .form-group {
    margin: 12px 0;
  }
  
  label {
    font-size: 0.9rem;
    margin-bottom: 4px;
  }
  
  input, select, textarea {
    padding: 10px 6px;
    font-size: 16px;
    border-radius: 6px;
  }
  
  button {
    min-height: 5px; /* Doporuƒçen√° minim√°ln√≠ v√Ω≈°ka pro dotyk */
        padding: 0px 0px; /* Vƒõt≈°√≠ padding pro snadnƒõj≈°√≠ dotyk */
        display: inline-flex; /* Zajist√≠, ≈æe text je vycentrovan√Ω vertik√°lnƒõ */
        align-items: center;
        justify-content: center;
  }
  
  /* Tabulky - extr√©mn√≠ optimalizace */
  table {
    font-size: 0.65rem;
    display: block;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    border-radius: 6px;
  }
  
  th, td {
    padding: 5px 5px;
    white-space: nowrap;
    min-width: 50px;
    text-align: center;
  }
  
  th {
    position: sticky;
    top: 0;
    background: green;
    z-index: 10;
  }
  
  /* Statistiky - dvousloupkov√Ω layout */
  .stats {
    grid-template-columns: 1fr 1fr;
    gap: 6px;
    margin: 12px 0;
  }
  
  .stat-item {
    padding: 8px 6px;
    border-radius: 6px;
  }
  
  .stat-value {
    font-size: 1.1em;
    line-height: 1.2;
  }
  
  .stat-label {
    font-size: 0.65em;
    margin-top: 2px;
    line-height: 1.1;
  }
  
  /* Grafy - pln√° ≈°√≠≈ôka */
  .charts-container {
    grid-template-columns: 1fr;
    gap: 10px;
    padding: 8px;
    margin: 12px 0;
    border-radius: 8px;
  }
  
  .chart-card {
    padding: 12px;
    border-radius: 8px;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  .chart-card h3 {
    font-size: 0.9rem;
    margin-bottom: 8px;
  }
  
  .chart-card canvas {
    max-height: 200px;
    min-height: 150px;
  }
  
  /* Taby - vertik√°ln√≠ layout */
  .tabs {
    flex-direction: row;
    border-bottom: none;
    gap: 0;
    margin: 2px 0;
  }
  
  .tab {
    border-bottom: 1px solid #444;
    padding: 10px 12px;
    text-align: left;
    font-size: 0.9rem;
  }
  
  .tab.active {
    border-left: 3px solid #00d9ff;
    border-bottom: 1px solid #444;
    background: rgba(0, 217, 255, 0.1);
  }
  
  .tab-content {
    padding: 10px 0;
  }
  
  /* Progress bar */
  .progress-bar {
    height: 20px;
    margin: 12px 0;
    border-radius: 10px;
  }
  
  /* Alert */
  .alert {
    padding: 10px;
    margin: 10px 0;
    font-size: 0.9rem;
    border-radius: 6px;
  }
  
  /* Notifikace */
  .notification {
    width: 90%;
    left: 5%;
    right: 5%;
    top: 10px;
    padding: 10px;
    font-size: 0.85rem;
    border-radius: 8px;
  }
  
  /* Fullscreen tlaƒç√≠tko */
  button.fullscreen {
    width: 40px !important;
    height: 40px !important;
    bottom: 10px !important;
    right: 10px !important;
    font-size: 1rem;
  }
}

/* Velmi mal√© mobily */
@media (max-width: 360px) {
  body {
    padding: 8px 3px;
    font-size: 12px;
  }
  
  h1 {
    font-size: 1.3rem;
  }
  
  h2 {
    font-size: 1.1rem;
  }
  
  .card {
    padding: 10px;
    margin: 0 1px;
  }
  
  .card h3 {
    font-size: 0.95rem;
  }
  
  input, select, textarea {
    padding: 8px 5px;
    font-size: 16px;
  }
  
  button {
    padding: 8px 10px;
    font-size: 0.85rem;
  }
  
  table {
    font-size: 0.6rem;
  }
  
  th, td {
    padding: 2px 1px;
    min-width: 10px;
  }
  
  .stats {
    grid-template-columns: 1fr 1fr 1fr;
    gap: 4px;
  }
  
  .stat-item {
    padding: 5px 5px;
  }
  
  .stat-value {
    font-size: 1rem;
  }
  
  .stat-label {
    font-size: 0.6em;
  }
  
  .charts-container {
    padding: 4px;
    gap: 4px;
  }
  
  .chart-card {
    padding: 10px;
  }
  
  .chart-card h3 {
    font-size: 0.85rem;
  }
  
  .chart-card canvas {
    max-height: 180px;
  }
  
  .tab {
    padding: 8px 10px;
    font-size: 0.85rem;
  }
  
  button.fullscreen {
    width: 35px !important;
    height: 35px !important;
    font-size: 0.9rem;
  }
}

/* Landscape orientace na mobilech */
@media (max-width: 768px) and (orientation: landscape) {
  .dashboard {
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  }
  
  .charts-container {
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  }
  
  .stats {
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
  }
  
  .chart-card canvas {
    max-height: 180px;
  }
  
  /* Optimalizace pro landscape - v√≠ce horizont√°ln√≠ho prostoru */
  .stats {
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  }
  
  .card {
    padding: 10px 15px;
  }
  
  h1, h2 {
    margin: 8px 0;
  }
}

/* Portrait orientace na mobilech */
@media (max-width: 768px) and (orientation: portrait) {
  body {
    padding: 15px 8px;
  }
  
  .container {
    max-width: 100%;
    padding: 0 3px;
  }
  
  /* Vertik√°ln√≠ layout pro portrait */
  .dashboard {
    grid-template-columns: 1fr;
    gap: 12px;
  }
  
  .charts-container {
    grid-template-columns: 1fr;
    gap: 10px;
    padding: 10px;
  }
  
  .chart-card {
    padding: 15px 10px;
  }
  
  .chart-card canvas {
    max-height: 220px;
    min-height: 160px;
  }
  
  /* Statistiky v portrait - 3 sloupce */
  .stats {
    grid-template-columns: 1fr 1fr 1fr;
    gap: 8px;
  }
  
  .stat-item {
    padding: 5px 5px;
    text-align: center;
  }
  
  .stat-value {
    font-size: 1.2em;
    display: block;
  }
  
  .stat-label {
    font-size: 0.7em;
    margin-top: 3px;
  }
  
  /* Tabulky v portrait - v√≠ce vertik√°ln√≠ho prostoru */
  table {
    max-height: 300px;
    overflow-y: auto;
    display: block;
  }
  
  /* Formul√°≈ôe optimalizovan√© pro portrait */
  .form-group {
    margin: 10px 0;
  }
  
  input, select, textarea {
    width: 100%;
    padding: 12px 8px;
  }
  
  button {
    min-height: 5px; /* Doporuƒçen√° minim√°ln√≠ v√Ω≈°ka pro dotyk */
        padding: 0px 0px; /* Vƒõt≈°√≠ padding pro snadnƒõj≈°√≠ dotyk */
        display: inline-flex; /* Zajist√≠, ≈æe text je vycentrovan√Ω vertik√°lnƒõ */
        align-items: center;
        justify-content: center;
  }
  
  /* Taby ve vertik√°ln√≠m layoutu */
  .tabs {
    flex-direction: row;
    margin: 2px 0;
  }
  
  .tab {
    width: 100%;
    text-align: left;
    padding: 12px 15px;
    border-bottom: 1px solid #444;
  }
  
  .tab.active {
    border-left: 4px solid #00d9ff;
    background: rgba(0, 217, 255, 0.1);
  }
}

/* Mal√© mobily v portrait orientaci */
@media (max-width: 480px) and (orientation: portrait) {
  body {
    padding: 10px 5px;
  }
  
  h1 {
    font-size: 1.4rem;
    text-align: center;
    margin: 8px 0;
  }
  
  h2 {
    font-size: 1.1rem;
    text-align: center;
    margin: 6px 0;
  }
  
  .card {
    padding: 10px;
    margin: 0 2px 8px 2px;
  }
  
  .charts-container {
    padding: 8px 5px;
    gap: 8px;
  }
  
  .chart-card {
    padding: 12px 8px;
  }
  
  .chart-card canvas {
    max-height: 200px;
    min-height: 140px;
  }
  
  /* Extra kompaktn√≠ statistiky */
  .stats {
    grid-template-columns: 2fr 2fr 2fr;
    gap: 5px;
  }
  
  .stat-item {
    padding: 2px 2px;
  }
  
  .stat-value {
    font-size: 1.1em;
  }
  
  .stat-label {
    font-size: 0.65em;
  }
  
  /* Tabulky s extra scroll mo≈ænostmi */
  table {
    font-size: 0.6rem;
    max-height: 2500px;
    overflow: auto;
  }
  
  th, td {
    padding: 2px 2px;
    min-width: 5px;
  }
}

/* Velmi mal√© mobily v portrait */
@media (max-width: 360px) and (orientation: portrait) {
  body {
    padding: 8px 3px;
  }
  
  .container {
    padding: 0 1px;
  }
  
  .card {
    padding: 8px;
    margin: 0 1px 6px 1px;
  }
  
  .charts-container {
    padding: 6px 3px;
    gap: 6px;
  }
  
  .chart-card {
    padding: 10px 6px;
  }
  
  .chart-card h3 {
    font-size: 0.9rem;
    margin-bottom: 6px;
  }
  
  .chart-card canvas {
    max-height: 170px;
    min-height: 120px;
  }
  
  .stats {
    gap: 3px;
  }
  
  .stat-item {
    padding: 6px 4px;
  }
  
  .stat-value {
    font-size: 1rem;
  }
  
  .stat-label {
    font-size: 0.6em;
  }
  
  table {
    font-size: 0.6rem;
    max-height: 2500px;
    overflow: auto;
  }
  
  th, td {
    padding: 2px 1px;
    min-width: 2px;
  }
  
  button {
    min-height: 5px; /* Doporuƒçen√° minim√°ln√≠ v√Ω≈°ka pro dotyk */
        padding: 0px 0px; /* Vƒõt≈°√≠ padding pro snadnƒõj≈°√≠ dotyk */
        display: inline-flex; /* Zajist√≠, ≈æe text je vycentrovan√Ω vertik√°lnƒõ */
        align-items: center;
        justify-content: center;
  }
  
  input, select, textarea {
    padding: 2px 2px;
  }
}

/* Touch-friendly √∫pravy */
@media (pointer: coarse) {
  button {
    min-height: 5px; /* Doporuƒçen√° minim√°ln√≠ v√Ω≈°ka pro dotyk */
        padding: 0px 0px; /* Vƒõt≈°√≠ padding pro snadnƒõj≈°√≠ dotyk */
        display: inline-flex; /* Zajist√≠, ≈æe text je vycentrovan√Ω vertik√°lnƒõ */
        align-items: center;
        justify-content: center;
  }
  
  input, select, textarea {
    min-height: 44px;
    padding: 12px;
  }
  
  .tab {
    min-height: 44px;
    display: flex;
    align-items: center;
  }
  
  table th, table td {
    min-height: 5x;
    padding: 2px 2px;
  }
}
table td button { /* Tato pravidla p≈ôep√≠≈°√≠ ty v√Ω≈°e definovan√© pro 768px a m√©nƒõ */
        min-height: 5px; /* Doporuƒçen√° minim√°ln√≠ v√Ω≈°ka pro dotyk */
        padding: 0px 0px; /* Vƒõt≈°√≠ padding pro snadnƒõj≈°√≠ dotyk */
        display: inline-flex; /* Zajist√≠, ≈æe text je vycentrovan√Ω vertik√°lnƒõ */
        align-items: center;
        justify-content: center;
    }
}
      /* ===== SPECIFICK√â √öPRAVY PRO BUTTON.DANGER A BUTTON.SUCCESS V @MEDIA ===== */

/* Tablety a men≈°√≠ desktopy */
@media (max-width: 1024px) {
    button.danger,
    button.success, button {
        min-height: 5px; /* Doporuƒçen√° minim√°ln√≠ v√Ω≈°ka pro dotyk */
        padding: 0px 0px; /* Vƒõt≈°√≠ padding pro snadnƒõj≈°√≠ dotyk */
        display: inline-flex; /* Zajist√≠, ≈æe text je vycentrovan√Ω vertik√°lnƒõ */
        align-items: center;
        justify-content: center;
    }
}

/* Vƒõt≈°√≠ mobily a mal√© tablety */
@media (max-width: 768px) {
    button.danger,
    button.success, button {
        min-height: 5px; /* Doporuƒçen√° minim√°ln√≠ v√Ω≈°ka pro dotyk */
        padding: 0px 0px; /* Vƒõt≈°√≠ padding pro snadnƒõj≈°√≠ dotyk */
        display: inline-flex; /* Zajist√≠, ≈æe text je vycentrovan√Ω vertik√°lnƒõ */
        align-items: center;
        justify-content: center;
    }
}

/* Standardn√≠ mobily */
@media (max-width: 480px) {
    button.danger,
    button.success, button {
        min-height: 5px; /* Doporuƒçen√° minim√°ln√≠ v√Ω≈°ka pro dotyk */
        padding: 0px 0px; /* Vƒõt≈°√≠ padding pro snadnƒõj≈°√≠ dotyk */
        display: inline-flex; /* Zajist√≠, ≈æe text je vycentrovan√Ω vertik√°lnƒõ */
        align-items: center;
        justify-content: center;
    }
}

/* Velmi mal√© mobily */
@media (max-width: 360px) {
    button.danger,
    button.success, button {
        min-height: 5px; /* Doporuƒçen√° minim√°ln√≠ v√Ω≈°ka pro dotyk */
        padding: 0px 0px; /* Vƒõt≈°√≠ padding pro snadnƒõj≈°√≠ dotyk */
        display: inline-flex; /* Zajist√≠, ≈æe text je vycentrovan√Ω vertik√°lnƒõ */
        align-items: center;
        justify-content: center;
    }
}

/* Touch-friendly √∫pravy (plat√≠ pro za≈ô√≠zen√≠ s dotykov√Ωm ovl√°d√°n√≠m) */
/* Tato pravidla zajist√≠, ≈æe tlaƒç√≠tka maj√≠ dostateƒçnou dotykovou plochu */
@media (pointer: coarse) {
    button.danger,
    button.success, button {
        min-height: 5px; /* Doporuƒçen√° minim√°ln√≠ v√Ω≈°ka pro dotyk */
        padding: 0px 0px; /* Vƒõt≈°√≠ padding pro snadnƒõj≈°√≠ dotyk */
        display: inline-flex; /* Zajist√≠, ≈æe text je vycentrovan√Ω vertik√°lnƒõ */
        align-items: center;
        justify-content: center;
    }
}
/* ===== FULLSCREEN RE≈ΩIM OPTIMALIZACE ===== */

/* Fullscreen detekce pro v≈°echny browsery */
:fullscreen table,
:-webkit-full-screen table,
:-moz-full-screen table,
:-ms-fullscreen table {
  width: 100%;
  height: 900vh; /* 80% v√Ω≈°ky obrazovky */
  max-height: none;
  font-size: 1rem;
  display: table;
  overflow: auto;
  border-radius: 0;
  margin: 0;
}

:fullscreen th,
:-webkit-full-screen th,
:-moz-full-screen th,
:-ms-fullscreen th {
  padding: 12px 8px;
  font-size: 1rem;
  position: sticky;
  top: 0;
  background: #0d1117;
  z-index: 100;
  border-bottom: 2px solid #00d9ff;
}

:fullscreen td,
:-webkit-full-screen td,
:-moz-full-screen td,
:-ms-fullscreen td {
  padding: 10px 8px;
  font-size: 0.95rem;
  white-space: normal;
  min-width: auto;
  max-width: none;
}

/* Fullscreen container optimalizace */
:fullscreen .container,
:-webkit-full-screen .container,
:-moz-full-screen .container,
:-ms-fullscreen .container {
  max-width: 100%;
  padding: 20px;
  height: 900vh;
  overflow-y: auto;
}

:fullscreen .card,
:-webkit-full-screen .card,
:-moz-full-screen .card,
:-ms-fullscreen .card {
  margin: 10px 0;
  padding: 20px;
  height: auto;
  min-height: auto;
}

/* Fullscreen dashboard optimalizace */
:fullscreen .dashboard,
:-webkit-full-screen .dashboard,
:-moz-full-screen .dashboard,
:-ms-fullscreen .dashboard {
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 20px;
  height: auto;
}

/* Fullscreen grafy optimalizace */
:fullscreen .charts-container,
:-webkit-full-screen .charts-container,
:-moz-full-screen .charts-container,
:-ms-fullscreen .charts-container {
  grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
  gap: 25px;
  padding: 25px;
  height: auto;
}

:fullscreen .chart-card,
:-webkit-full-screen .chart-card,
:-moz-full-screen .chart-card,
:-ms-fullscreen .chart-card {
  padding: 25px;
  min-height: 400px;
}

:fullscreen .chart-card canvas,
:-webkit-full-screen .chart-card canvas,
:-moz-full-screen .chart-card canvas,
:-ms-fullscreen .chart-card canvas {
  max-height: 350px;
  min-height: 300px;
}

/* Fullscreen statistiky */
:fullscreen .stats,
:-webkit-full-screen .stats,
:-moz-full-screen .stats,
:-ms-fullscreen .stats {
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
}

:fullscreen .stat-item,
:-webkit-full-screen .stat-item,
:-moz-full-screen .stat-item,
:-ms-fullscreen .stat-item {
  padding: 20px 15px;
}

:fullscreen .stat-value,
:-webkit-full-screen .stat-value,
:-moz-full-screen .stat-value,
:-ms-fullscreen .stat-value {
  font-size: 2em;
}

:fullscreen .stat-label,
:-webkit-full-screen .stat-label,
:-moz-full-screen .stat-label,
:-ms-fullscreen .stat-label {
  font-size: 1em;
}

/* Fullscreen typography */
:fullscreen h1,
:-webkit-full-screen h1,
:-moz-full-screen h1,
:-ms-fullscreen h1 {
  font-size: 2.5rem;
  margin: 20px 0;
}

:fullscreen h2,
:-webkit-full-screen h2,
:-moz-full-screen h2,
:-ms-fullscreen h2 {
  font-size: 2rem;
  margin: 15px 0;
}

:fullscreen h3,
:-webkit-full-screen h3,
:-moz-full-screen h3,
:-ms-fullscreen h3 {
  font-size: 1.5rem;
}

/* Fullscreen formul√°≈ôe */
:fullscreen input,
:-webkit-full-screen input,
:-moz-full-screen input,
:-ms-fullscreen input,
:fullscreen select,
:-webkit-full-screen select,
:-moz-full-screen select,
:-ms-fullscreen select,
:fullscreen textarea,
:-webkit-full-screen textarea,
:-moz-full-screen textarea,
:-ms-fullscreen textarea {
  padding: 15px 12px;
  font-size: 1rem;
}

:fullscreen button,
:-webkit-full-screen button,
:-moz-full-screen button,
:-ms-fullscreen button {
  padding: 15px 25px;
  font-size: 1rem;
  margin: 8px;
}

/* Fullscreen taby */
:fullscreen .tabs,
:-webkit-full-screen .tabs,
:-moz-full-screen .tabs,
:-ms-fullscreen .tabs {
  margin: 25px 0;
}

:fullscreen .tab,
:-webkit-full-screen .tab,
:-moz-full-screen .tab,
:-ms-fullscreen .tab {
  padding: 15px 25px;
  font-size: 1.1rem;
}

/* Fullscreen na mobilech - speci√°ln√≠ p≈ô√≠pady */
@media (max-width: 768px) {
  :fullscreen table,
  :-webkit-full-screen table,
  :-moz-full-screen table,
  :-ms-fullscreen table {
    height: 900vh;
    font-size: 0.9rem;
  }
  
  :fullscreen .dashboard,
  :-webkit-full-screen .dashboard,
  :-moz-full-screen .dashboard,
  :-ms-fullscreen .dashboard {
    grid-template-columns: 1fr;
  }
  
  :fullscreen .charts-container,
  :-webkit-full-screen .charts-container,
  :-moz-full-screen .charts-container,
  :-ms-fullscreen .charts-container {
    grid-template-columns: 1fr;
    padding: 15px;
  }
  
  :fullscreen .chart-card,
  :-webkit-full-screen .chart-card,
  :-moz-full-screen .chart-card,
  :-ms-fullscreen .chart-card {
    min-height: 300px;
    padding: 20px;
  }
}

/* Fullscreen scrollbar styling pro lep≈°√≠ UX */
:fullscreen ::-webkit-scrollbar,
:-webkit-full-screen ::-webkit-scrollbar,
:-moz-full-screen ::-webkit-scrollbar,
:-ms-fullscreen ::-webkit-scrollbar {
  width: 12px;
}

:fullscreen ::-webkit-scrollbar-track,
:-webkit-full-screen ::-webkit-scrollbar-track,
:-moz-full-screen ::-webkit-scrollbar-track,
:-ms-fullscreen ::-webkit-scrollbar-track {
  background: #1f2633;
}

:fullscreen ::-webkit-scrollbar-thumb,
:-webkit-full-screen ::-webkit-scrollbar-thumb,
:-moz-full-screen ::-webkit-scrollbar-thumb,
:-ms-fullscreen ::-webkit-scrollbar-thumb {
  background: #00d9ff;
  border-radius: 6px;
}

:fullscreen ::-webkit-scrollbar-thumb:hover,
:-webkit-full-screen ::-webkit-scrollbar-thumb:hover,
:-moz-full-screen ::-webkit-scrollbar-thumb:hover,
:-ms-fullscreen ::-webkit-scrollbar-thumb:hover {
  background: #00b8cc;
}
  </style>
</head>
<body>
  <div class="container">
    <h1>üññ Pokroƒçil√Ω v√°hov√Ω tracker v√≠ce admir√°la Ji≈ô√≠ka</h1>
    
    <div class="notification" id="notification"></div>
    <div class="alert" id="bmiAlert"></div>
    
    <div class="tabs">
      <div class="tab active" onclick="showTab('dashboard')">Dashboard</div>
      <div class="tab" onclick="showTab('add-entry')">Nov√Ω z√°znam</div>
      <div class="tab" onclick="showTab('goals')">C√≠le</div>
      <div class="tab" onclick="showTab('settings')">Nastaven√≠</div>
      <div class="tab" onclick="showTab('export')">Export/Import</div>
    </div>

    <div id="dashboard" class="tab-content active">
      <div class="stats">
        <div class="stat-item">
          <div class="stat-value" id="currentWeight">-</div>
          <div class="stat-label">Aktu√°ln√≠ v√°ha (kg)</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="currentBMI">-</div>
          <div class="stat-label">Aktu√°ln√≠ BMI</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="weightChange">-</div>
          <div class="stat-label">Zmƒõna v√°hy (kg)</div>
        </div>
         <div class="stat-item">
          <div class="stat-value" id="currentBodyWater">-</div>
          <div class="stat-label">Voda v tƒõle (%)</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="lastManualBMR">-</div>
          <div class="stat-label">Posl. zadan√Ω BMR</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="lastManualAMR">-</div>
          <div class="stat-label">Posl. zadan√Ω AMR</div>
        </div>
         <div class="stat-item">
          <div class="stat-value" id="theoreticalBMR">-</div>
          <div class="stat-label">Teoretick√Ω BMR</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="theoreticalAMR">-</div>
          <div class="stat-label">Teoretick√Ω AMR</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="goalProgress">-</div>
          <div class="stat-label">Pokrok k c√≠li (%)</div>
        </div>
      </div>

      <div id="goalProgressBarCard" class="card" style="display:none; margin-bottom: 20px;">
        <h3>Pokrok k c√≠li</h3>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div id="goalStatus" style="text-align: center; margin-top: 10px; color: #00d9ff;"></div>
        <div id="goalEstimate" class="stat-subtext" style="text-align: center; margin-top: 5px; color: #ccc;">Odhad: ...</div>
        <div id="latestEntryDate" style="text-align: center; margin-top: 5px; font-size: 0.9em; color: #aaa;"></div>
      </div>

      <div class="charts-container">
        <div class="chart-card">
          <h3>V√Ωvoj v√°hy</h3>
          <canvas id="weightChart"></canvas>
        </div>
        <div class="chart-card">
          <h3>V√Ωvoj BMI</h3>
          <canvas id="bmiChart"></canvas>
        </div>
        <div class="chart-card">
          <h3>V√Ωvoj tƒõlesn√©ho tuku (%)</h3>
          <canvas id="bodyFatOnlyChart"></canvas>
        </div>
        <div class="chart-card">
          <h3>V√Ωvoj svalov√© hmoty (%)</h3> <canvas id="muscleMassOnlyChart"></canvas>
        </div>
         <div class="chart-card">
          <h3>V√Ωvoj vody v tƒõle</h3>
          <canvas id="bodyWaterChart"></canvas>
        </div>
        <div class="chart-card">
          <h3>V√Ωvoj zadan√©ho BMR (kcal)</h3>
          <canvas id="manualBMRChart"></canvas>
        </div>
        <div class="chart-card">
          <h3>V√Ωvoj zadan√©ho AMR (kcal)</h3>
          <canvas id="manualAMRChart"></canvas>
        </div>
      </div>

      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Datum</th>
            <th>V√°ha</th>
            <th>Rozd√≠l</th>
            <th>BMI</th>
            <th>Klasif.</th>
            <th>Tuk%</th>
            <th>Svaly (%)</th> <th>Voda%</th>
            <th>Zad. BMR</th>
            <th>Zad. AMR</th>
            <th>Pozn.</th>
            <th>Akce</th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>

    <div id="add-entry" class="tab-content">
      <div class="card">
        <h3>P≈ôidat nov√Ω z√°znam</h3>
        <form id="entryForm">
          <div class="form-group">
            <label for="entryDate">Datum:</label>
            <input type="date" id="entryDate" required>
          </div>
          <div class="form-group">
            <label for="entryWeight">V√°ha (kg):</label>
            <input type="number" id="entryWeight" step="0.1" required>
          </div>
          <div class="form-group">
            <label for="entryBodyFat">Tƒõlesn√Ω tuk (%):</label>
            <input type="number" id="entryBodyFat" step="0.1" min="0" max="100">
          </div>
          <div class="form-group">
            <label for="entryMuscleMass">Svalov√° hmota (kg):</label>
            <input type="number" id="entryMuscleMass" step="0.1" min="0">
          </div>
          <div class="form-group">
            <label for="entryBodyWater">Voda v tƒõle (%):</label>
            <input type="number" id="entryBodyWater" step="0.1" min="0" max="100">
          </div>
          <div class="form-group">
            <label for="entryManualBMR">Ruƒçnƒõ zadan√© BMR (kcal):</label>
            <input type="number" id="entryManualBMR" step="1" min="0">
          </div>
          <div class="form-group">
            <label for="entryManualAMR">Ruƒçnƒõ zadan√© AMR (kcal):</label>
            <input type="number" id="entryManualAMR" step="1" min="0">
          </div>
          <div class="form-group">
            <label for="entryNotes">Pozn√°mky:</label>
            <textarea id="entryNotes" rows="3"></textarea>
          </div>
          <button type="submit">P≈ôidat z√°znam</button>
        </form>
      </div>
    </div>

    <div id="goals" class="tab-content">
      <div class="card">
        <h3>Nastaven√≠ c√≠l≈Ø</h3>
        <form id="goalsForm">
          <div class="form-group">
            <label for="targetWeight">C√≠lov√° v√°ha (kg):</label>
            <input type="number" id="targetWeight" step="0.1">
          </div>
          <div class="form-group">
            <label for="targetBMI">C√≠lov√© BMI:</label>
            <input type="number" id="targetBMI" step="0.1">
          </div>
          <div class="form-group">
            <label for="targetDate">Term√≠n splnƒõn√≠ c√≠le:</label>
            <input type="date" id="targetDate">
          </div>
          <div class="form-group">
            <label for="weeklyGoal">T√Ωdenn√≠ zmƒõna v√°hy (kg) (nap≈ô. -0.5 pro hubnut√≠):</label>
            <input type="number" id="weeklyGoal" step="0.1">
          </div>
          <button type="submit">Ulo≈æit c√≠le</button>
        </form>
        
        <div id="recommendations" class="card" style="margin-top: 20px; background: #2a3441;">
          <h3>Doporuƒçen√≠</h3>
          <div id="recommendationText"></div>
        </div>
      </div>
    </div>

    <div id="settings" class="tab-content">
      <div class="dashboard">
        <div class="card">
          <h3>Osobn√≠ √∫daje (pro teoretick√© v√Ωpoƒçty)</h3>
          <form id="settingsForm">
            <div class="form-group">
              <label for="height">V√Ω≈°ka (cm):</label>
              <input type="number" id="height" min="100" max="250" value="174">
            </div>
            <div class="form-group">
              <label for="age">Vƒõk:</label>
              <input type="number" id="age" min="1" max="120">
            </div>
            <div class="form-group">
              <label for="gender">Pohlav√≠:</label>
              <select id="gender">
                <option value="male">Mu≈æ</option>
                <option value="female">≈Ωena</option>
              </select>
            </div>
            <div class="form-group">
              <label for="activityLevel">√örove≈à fyzick√© aktivity:</label>
              <select id="activityLevel">
                <option value="1.2">Sedav√© (m√°lo nebo ≈æ√°dn√© cviƒçen√≠)</option>
                <option value="1.375">Lehce aktivn√≠ (cviƒçen√≠ 1-3 dny/t√Ωden)</option>
                <option value="1.55">M√≠rnƒõ aktivn√≠ (cviƒçen√≠ 3-5 dn√≠/t√Ωden)</option>
                <option value="1.725">Velmi aktivn√≠ (cviƒçen√≠ 6-7 dn√≠/t√Ωden)</option>
                <option value="1.9">Extr√©mnƒõ aktivn√≠ (velmi tƒõ≈æk√© cviƒçen√≠, fyzick√° pr√°ce)</option>
              </select>
            </div>
            <button type="submit">Ulo≈æit nastaven√≠</button>
          </form>
        </div>

        <div class="card">
          <h3>BMI hranice</h3>
          <form id="bmiAlertsForm">
            <div class="form-group">
              <label for="bmiWarningUpper">Horn√≠ hranice BMI (varov√°n√≠):</label>
              <input type="number" id="bmiWarningUpper" step="0.1" value="25">
            </div>
            <div class="form-group">
              <label for="bmiDangerUpper">Horn√≠ hranice BMI (nebezpeƒç√≠):</label>
              <input type="number" id="bmiDangerUpper" step="0.1" value="30">
            </div>
            <div class="form-group">
              <label for="bmiWarningLower">Doln√≠ hranice BMI (varov√°n√≠):</label>
              <input type="number" id="bmiWarningLower" step="0.1" value="18.5">
            </div>
            <button type="submit">Ulo≈æit hranice</button>
          </form>
        </div>

        <div class="card">
    <h3>P≈ôipom√≠nky</h3>
    <form id="remindersForm">
        <div class="form-group">
            <label for="reminderEnabled">Povolit p≈ôipom√≠nky:</label>
            <input type="checkbox" id="reminderEnabled" style="width: auto;">
        </div>
        <div class="form-group">
            <label for="reminderInterval">Interval p≈ôipom√≠nek (dny):</label>
            <input type="number" id="reminderInterval" min="1" max="30" value="7">
        </div>
        <button type="submit">Ulo≈æit p≈ôipom√≠nky</button>
        <button type="button" onclick="window.requestNotificationPermission()">üîî Povolit webov√° upozornƒõn√≠</button>
        </form>
</div>
      </div>
    </div>

    <div id="export" class="tab-content">
      <div class="dashboard">
        <div class="card">
          <h3>Export dat</h3>
          <button onclick="exportToCSV()">üìä Export do CSV</button>
          <button onclick="exportToPDF()">üìÑ Export do PDF</button>
          <button onclick="exportChartsAsPDF()">üìà Export graf≈Ø do PDF</button>
          <button onclick="exportBackup()">üíæ √öpln√° z√°loha</button>
        </div>

        <div class="card">
          <h3>Import dat</h3>
          <div class="form-group">
            <label for="csvImport">Import CSV:</label>
            <input type="file" id="csvImport" accept=".csv" onchange="importFromCSV(this)">
          </div>
          <div class="form-group">
            <label for="backupImport">Obnovit ze z√°lohy:</label>
            <input type="file" id="backupImport" accept=".json" onchange="importFromBackup(this)">
          </div>
          <button class="danger" onclick="clearAllData()">üóëÔ∏è Vymazat v≈°echna data</button>
        </div>
      </div>
    </div>
  </div>

   
    <script>
    // Glob√°ln√≠ promƒõnn√© (deklarace z≈Øst√°v√° naho≈ôe)
    let weightChart, bmiChart, bodyFatOnlyChart, muscleMassOnlyChart, bodyWaterChart, manualBMRChart, manualAMRChart;
    let weightLog = [];
    let settings = {
        height: 174,
        age: 24,
        gender: 'male',
        activityLevel: 1.55,
        bmiWarningUpper: 25,
        bmiDangerUpper: 30,
        bmiWarningLower: 18.5,
        reminderEnabled: true,
        reminderInterval: 7
    };
    let goals = {
        targetWeight: 80,
        targetBMI: 24.9,
        targetDate: '2026-05-18',
        weeklyGoal: null
    };

    const ACTIVITY_LEVELS = {
        SEDENTARY: 1.2,
        LIGHT: 1.375,
        MODERATE: 1.55,
        ACTIVE: 1.725,
        VERY_ACTIVE: 1.9
    };

    // --- Zde zaƒç√≠n√° JavaScriptov√° logika tv√©ho trackeru ---

    // Funkce, kter√© jsou vol√°ny z HTML atribut≈Ø (onclick, onchange), mus√≠ b√Ωt glob√°ln√≠.
    // Proto je p≈ôipojujeme k objektu window.

    window.setTodayDate = function() {
        console.log("setTodayDate: Nastavuji dne≈°n√≠ datum pro vstupn√≠ pole.");
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('entryDate').value = today;
    };

    // loadData - Nyn√≠ prim√°rnƒõ vol√° Firebase funkce, s fallbackem na LocalStorage a v√Ωchoz√≠ data
    window.loadData = async function() {
        console.log("loadData: Spu≈°tƒõno naƒç√≠t√°n√≠ v≈°ech dat (v√°ha, nastaven√≠, c√≠le).");
        const savedWeightLog = localStorage.getItem('weightLog_JirikTracker_v2_charts_separated_musclePercent');
        const savedSettings = localStorage.getItem('weightSettings_JirikTracker_v2_charts_separated_musclePercent');
        const savedGoals = localStorage.getItem('weightGoals_JirikTracker_v2_charts_separated_musclePercent');

        let firestoreWeightDataLoaded = false;
        let firestoreSettingsDataLoaded = false;
        let firestoreGoalsDataLoaded = false;

        try {
            console.log("loadData: Pokou≈°√≠m se naƒç√≠st data z Firebase Firestore (weightLog).");
            const firestoreWeightData = await window.loadWeightLogFromFirestore();
            if (firestoreWeightData && firestoreWeightData.length > 0) {
                weightLog = firestoreWeightData;
                firestoreWeightDataLoaded = true;
                console.log("loadData: Data weightLog √∫spƒõ≈°nƒõ naƒçtena z Firebase Firestore.");
            } else {
                console.log("loadData: ≈Ω√°dn√° data weightLog v Firebase Firestore nebo kolekce pr√°zdn√°.");
            }

            console.log("loadData: Pokou≈°√≠m se naƒç√≠st nastaven√≠ z Firebase Firestore.");
            const firestoreSettings = await window.loadSettingsFromFirestore();
            if (firestoreSettings) {
                settings = { ...settings, ...firestoreSettings }; // Slouƒçen√≠ naƒçten√Ωch nastaven√≠ s v√Ωchoz√≠mi
                firestoreSettingsDataLoaded = true;
                console.log("loadData: Nastaven√≠ √∫spƒõ≈°nƒõ naƒçtena z Firebase Firestore.");
            } else {
                console.log("loadData: ≈Ω√°dn√° nastaven√≠ v Firebase Firestore nebo dokument neexistuje.");
            }

            console.log("loadData: Pokou≈°√≠m se naƒç√≠st c√≠le z Firebase Firestore.");
            const firestoreGoals = await window.loadGoalsFromFirestore();
            if (firestoreGoals) {
                goals = { ...goals, ...firestoreGoals }; // Slouƒçen√≠ naƒçten√Ωch c√≠l≈Ø s v√Ωchoz√≠mi
                firestoreGoalsDataLoaded = true;
                console.log("loadData: C√≠le √∫spƒõ≈°nƒõ naƒçteny z Firebase Firestore.");
            } else {
                console.log("loadData: ≈Ω√°dn√© c√≠le v Firebase Firestore nebo dokument neexistuje.");
            }

        } catch (error) {
            console.error("loadData: Kritick√° chyba p≈ôi naƒç√≠t√°n√≠ dat z Firebase Firestore (pro v≈°echny typy).", error);
            window.showNotification("Chyba: Data z cloudu nebylo mo≈æn√© naƒç√≠st. Pokou≈°√≠m se naƒç√≠st lok√°ln√≠ data.", 5000);
        }

        // Fallback pro weightLog
        if (!firestoreWeightDataLoaded) {
            console.log("loadData: Firestore weightLog nenaƒçteno, pokou≈°√≠m se z LocalStorage.");
            if (savedWeightLog) {
                weightLog = JSON.parse(savedWeightLog);
                console.log("loadData: Data weightLog naƒçtena z LocalStorage.");
            } else {
                console.log("loadData: ≈Ω√°dn√° data weightLog v LocalStorage. Naƒç√≠t√°m v√Ωchoz√≠ data z k√≥du.");
                // P≈ô√≠klad dat, aby bylo co zobrazit p≈ôi prvn√≠m spu≈°tƒõn√≠
                weightLog = [
                    //tvoje data pros√≠m nemazat ani jeden zaznam je to d≈Øle≈æit√©??
{ date: "2024-05-25", weight: 133.6, bodyFat: 41.5, muscleMass: 31.0, bodyWater: 40.2, manualBMR: 2665 , manualAMR:3205, notes: "Start" },
{ date: "2024-05-26", weight: 134.0, bodyFat: 41.8, muscleMass: 30.9, bodyWater: 40.0, manualBMR: 2676, manualAMR: 3211, notes: "" },
{ date: "2024-06-01", weight: 134.0, bodyFat: 41.8, muscleMass: 30.9, bodyWater: 40.0, manualBMR: 2671, manualAMR: 3205, notes: "" },
{ date: "2024-06-01", weight: 133.4, bodyFat: 42.0, muscleMass: 30.7, bodyWater: 39.8, manualBMR: 2670, manualAMR: 3194, notes: "" },
{ date: "2024-06-07", weight: 132.2, bodyFat: 41.1, muscleMass: 31.2, bodyWater: 40.4, manualBMR: 2645, manualAMR: 3174, notes: "" },
{ date: "2024-06-08", weight: 131.3, bodyFat: 40.9, muscleMass: 31.3, bodyWater: 40.6, manualBMR: 2632, manualAMR: 3158, notes: "" },
{ date: "2024-06-08", weight: 131.3, bodyFat: 40.7, muscleMass: 31.4, bodyWater: 40.7, manualBMR: 2632, manualAMR: 3158, notes: "" },
{ date: "2024-06-09", weight: 132.2, bodyFat: 42.8, muscleMass: 30.3, bodyWater: 39.3, manualBMR: 2645, manualAMR: 3174, notes: "" },
{ date: "2024-06-11", weight: 131.5, bodyFat: 41.0, muscleMass: 31.2, bodyWater: 40.5, manualBMR: 2635, manualAMR: 3162, notes: "" },
{ date: "2024-06-18", weight: 134.6, bodyFat: 42.2, muscleMass: 30.6, bodyWater: 39.7, manualBMR: 2678, manualAMR: 3213, notes: "" },
{ date: "2024-06-20", weight: 134.4, bodyFat: 42.1, muscleMass: 30.7, bodyWater: 39.8, manualBMR: 2676, manualAMR: 3211, notes: "" },
{ date: "2024-06-20", weight: 134.4, bodyFat: 42.0, muscleMass: 30.7, bodyWater: 39.8, manualBMR: 2676, manualAMR: 3211, notes: "" },
{ date: "2024-06-21", weight: 136.7, bodyFat: 43.0, muscleMass: 30.2, bodyWater: 39.1, manualBMR: 2708, manualAMR: 3249, notes: "" },
{ date: "2024-06-29", weight: 137.3, bodyFat: 43.4, muscleMass: 30.0, bodyWater: 38.9, manualBMR: 2716, manualAMR: 3259, notes: "" },
{ date: "2024-07-03", weight: 136.9, bodyFat: 43.0, muscleMass: 30.2, bodyWater: 39.1, manualBMR: 2711, manualAMR: 3253, notes: "" },
{ date: "2024-07-09", weight: 139.3, bodyFat: 44.0, muscleMass: 29.7, bodyWater: 38.5, manualBMR: 2744, manualAMR: 3292, notes: "" },
{ date: "2024-09-08", weight: 138.6, bodyFat: 43.7, muscleMass: 29.9, bodyWater: 38.7, manualBMR: 2734, manualAMR: 3280, notes: "" },
{ date: "2025-02-16", weight: 145.6, bodyFat: 46.5, muscleMass: 28.3, bodyWater: 36.7, manualBMR: 2831, manualAMR: 3397, notes: "" },
{ date: "2025-04-19", weight: 146.3, bodyFat: 47.0, muscleMass: 28.1, bodyWater: 36.4, manualBMR: 2842, manualAMR: 3410, notes: "" },
{ date: "2025-05-10", weight: 144.2, bodyFat: 45.8, muscleMass: 28.7, bodyWater: 37.2, manualBMR: 2806, manualAMR: 3367, notes: "" },
{ date: "2025-05-13", weight: 141.3, bodyFat: 44.6, muscleMass: 29.3, bodyWater: 38.0, manualBMR: 2765, manualAMR: 3318, notes: "" },
{ date: "2025-05-18", weight: 138.8, bodyFat: 43.7, muscleMass: 29.3, bodyWater: 38.7, manualBMR: 2731, manualAMR: 3277, notes: "" },
{ date: "2025-05-19", weight: 139.3, bodyFat: 45.8, muscleMass: 28.7, bodyWater: 37.2, manualBMR: 2728, manualAMR: 3273, notes: "" },
{ date: "2025-05-20", weight: 138.5, bodyFat: 45.5, muscleMass: 28.9, bodyWater: 37.4, manualBMR: 2716, manualAMR: 3259, notes: "" },  
{ date: "2025-05-21", weight: 138.3, bodyFat: 45.4, muscleMass: 29.0, bodyWater: 37.5, manualBMR: 2713, manualAMR: 3255, notes: "" },  
{ date: "2025-05-22", weight: 139.2, bodyFat: 45.7, muscleMass: 28.8, bodyWater: 37.3, manualBMR: 2725, manualAMR: 3270, notes: "" }, 
{ date: "2025-05-23", weight: 139.2, bodyFat: 45.9, muscleMass: 28.7, bodyWater: 37.1, manualBMR: 2725, manualAMR: 3270, notes: "" },  
{ date: "2025-05-24", weight: 139.7, bodyFat: 46.0, muscleMass: 28.7, bodyWater: 37.1, manualBMR: 2733, manualAMR: 3270, notes: "" },         
{ date: "2025-05-25", weight: 140.3, bodyFat: 46.2, muscleMass: 28.5, bodyWater: 36.9, manualBMR: 2741, manualAMR: 3279, notes: "" },    
{ date: "2025-05-31", weight: 140.0, bodyFat: 46.2, muscleMass: 28.7, bodyWater: 37.1, manualBMR: 2737, manualAMR: 3289, notes: "" },        
{ date: "2025-06-01", weight: 140.0, bodyFat: 46.2, muscleMass: 28.5, bodyWater: 36.9, manualBMR: 2737, manualAMR: 3289, notes: "" },
                ];
                console.log("loadData: Naƒçtena v√Ωchoz√≠ data z k√≥du.");
            }
        }

        // Naƒç√≠t√°n√≠ settings a goals z LocalStorage, pokud nejsou z Firestore
        if (!firestoreSettingsDataLoaded) { // Pokud settings nebyly naƒçteny z Firestore
            console.log("loadData: Firestore nastaven√≠ nenaƒçteno, pokou≈°√≠m se z LocalStorage.");
            if (savedSettings) {
                settings = { ...settings, ...JSON.parse(savedSettings) };
                console.log("loadData: Nastaven√≠ naƒçtena z LocalStorage.");
            } else {
                console.log("loadData: ≈Ω√°dn√° nastaven√≠ v LocalStorage. Pou≈æ√≠v√°m v√Ωchoz√≠.");
            }
        } else {
            console.log("loadData: Nastaven√≠ ji≈æ naƒçtena z Firestore, p≈ôeskoƒçeno LocalStorage.");
        }
        
        if (!firestoreGoalsDataLoaded) { // Pokud goals nebyly naƒçteny z Firestore
            console.log("loadData: Firestore c√≠le nenaƒçteny, pokou≈°√≠m se z LocalStorage.");
            if (savedGoals) {
                goals = { ...goals, ...JSON.parse(savedGoals) };
                console.log("loadData: C√≠le naƒçteny z LocalStorage.");
            } else {
                console.log("loadData: ≈Ω√°dn√© c√≠le v LocalStorage. Pou≈æ√≠v√°m v√Ωchoz√≠.");
            }
        } else {
            console.log("loadData: C√≠le ji≈æ naƒçteny z Firestore, p≈ôeskoƒçeno LocalStorage.");
        }

        settings.activityLevel = parseFloat(settings.activityLevel) || 1.55;
        console.log("loadData: Dokonƒçeno naƒç√≠t√°n√≠ dat. Aktualizuji formul√°≈ôe.");
        window.updateForms(); // Vol√°me glob√°ln√≠ updateForms()

        // Prvotn√≠ ulo≈æen√≠ dat do Firebase, pokud byla naƒçtena z LocalStorage nebo k√≥du
        // a nejsou ji≈æ ve Firestore.
        if (!firestoreWeightDataLoaded && (weightLog.length > 0 || savedWeightLog)) {
            console.log("loadData: Detekov√°na chybƒõj√≠c√≠ data weightLog ve Firestore. Ukl√°d√°m aktu√°ln√≠ data do cloudu.");
            await window.saveData(); // Ulo≈æ√≠ aktu√°ln√≠ weightLog, settings, goals do Firestore
        } else if (!firestoreSettingsDataLoaded && savedSettings) {
            console.log("loadData: Detekov√°na chybƒõj√≠c√≠ nastaven√≠ ve Firestore. Ukl√°d√°m aktu√°ln√≠ nastaven√≠ do cloudu.");
            await window.saveData(); // Ulo≈æ√≠ aktu√°ln√≠ weightLog, settings, goals do Firestore
        } else if (!firestoreGoalsDataLoaded && savedGoals) {
            console.log("loadData: Detekov√°ny chybƒõj√≠c√≠ c√≠le ve Firestore. Ukl√°d√°m aktu√°ln√≠ c√≠le do cloudu.");
            await window.saveData(); // Ulo≈æ√≠ aktu√°ln√≠ weightLog, settings, goals do Firestore
        }
        console.log("loadData: Naƒç√≠t√°n√≠ dat dokonƒçeno pro v≈°echny zdroje.");
    };

    // saveData - Nyn√≠ ukl√°d√° do LocalStorage a Firebase
    window.saveData = async function() {
        console.log("saveData: Spu≈°tƒõno ukl√°d√°n√≠ v≈°ech dat (v√°ha, nastaven√≠, c√≠le) do LocalStorage a Firebase.");
        localStorage.setItem('weightLog_JirikTracker_v2_charts_separated_musclePercent', JSON.stringify(weightLog));
        localStorage.setItem('weightSettings_JirikTracker_v2_charts_separated_musclePercent', JSON.stringify(settings));
        localStorage.setItem('weightGoals_JirikTracker_v2_charts_separated_musclePercent', JSON.stringify(goals));
        console.log("saveData: Data √∫spƒõ≈°nƒõ ulo≈æena do LocalStorage.");

        try {
            // Ukl√°d√°me weightLog do Firebase Firestore
            console.log("saveData: Pokou≈°√≠m se ulo≈æit weightLog do Firebase Firestore.");
            // Tato funkce (window.saveWeightLogToFirestore) je definov√°na v firebaseFunctions.js
            await window.saveWeightLogToFirestore(weightLog);
            console.log("saveData: Data weightLog √∫spƒõ≈°nƒõ ulo≈æena do Firebase Firestore.");
            
            // Ukl√°d√°me settings do Firebase Firestore
            console.log("saveData: Pokou≈°√≠m se ulo≈æit nastaven√≠ do Firebase Firestore.");
            await window.saveSettingsToFirestore(settings);
            console.log("saveData: Nastaven√≠ √∫spƒõ≈°nƒõ ulo≈æena do Firebase Firestore.");

            // Ukl√°d√°me goals do Firebase Firestore
            console.log("saveData: Pokou≈°√≠m se ulo≈æit c√≠le do Firebase Firestore.");
            await window.saveGoalsToFirestore(goals);
            console.log("saveData: C√≠le √∫spƒõ≈°nƒõ ulo≈æeny do Firebase Firestore.");

        } catch (error) {
            console.error("saveData: Nepoda≈ôilo se ulo≈æit data do Firebase Firestore:", error);
            window.showNotification("Chyba: Data se nepoda≈ôilo ulo≈æit do cloudu!", 4000);
        }
        console.log("saveData: Ukl√°d√°n√≠ dat dokonƒçeno pro v≈°echny c√≠le.");
    };

    window.updateForms = function() {
        console.log("updateForms: Aktualizuji hodnoty formul√°≈ôov√Ωch pol√≠.");
        document.getElementById('height').value = settings.height || '';
        document.getElementById('age').value = settings.age || '';
        document.getElementById('gender').value = settings.gender || 'male';
        document.getElementById('activityLevel').value = settings.activityLevel || '1.55';
        document.getElementById('bmiWarningUpper').value = settings.bmiWarningUpper || '';
        document.getElementById('bmiDangerUpper').value = settings.bmiDangerUpper || '';
        document.getElementById('bmiWarningLower').value = settings.bmiWarningLower || '';
        document.getElementById('reminderEnabled').checked = settings.reminderEnabled === true;
        document.getElementById('reminderInterval').value = settings.reminderInterval || 7;

        document.getElementById('targetWeight').value = goals.targetWeight || '';
        document.getElementById('targetBMI').value = goals.targetBMI || '';
        document.getElementById('targetDate').value = goals.targetDate || '';
        document.getElementById('weeklyGoal').value = goals.weeklyGoal || '';
        console.log("updateForms: Formul√°≈ôe aktualizov√°ny.");
    };

    window.calculateBMI = function(weight, height) {
        // console.log("calculateBMI: Poƒç√≠t√°m BMI."); // Velmi ƒçast√© vol√°n√≠, m≈Ø≈æe zahltit log
        if (!height || height <=0 || !weight || weight <=0) return 0;
        const heightInMeters = height / 100;
        return weight / (heightInMeters * heightInMeters);
    };

    window.calculateBMR = function(weight, height, age, gender) {
        // console.log("calculateBMR: Poƒç√≠t√°m BMR."); // Velmi ƒçast√© vol√°n√≠
        if (!weight || !height || !age || !gender) return 0;
        if (gender === 'male') {
            return (10 * weight) + (6.25 * height) - (5 * age) + 5;
        } else {
            return (10 * weight) + (6.25 * height) - (5 * age) - 161;
        }
    };

    window.calculateAMR = function(bmr, activityLevel) {
        // console.log("calculateAMR: Poƒç√≠t√°m AMR."); // Velmi ƒçast√© vol√°n√≠
        if (!bmr || !activityLevel) return 0;
        return bmr * activityLevel;
    };

    window.classifyBMI = function(bmi) {
        // console.log("classifyBMI: Klasifikuji BMI."); // Velmi ƒçast√© vol√°n√≠
        if (bmi === 0) return { class: '', text: '-' };
        if (bmi < 18.5) return { class: 'bmi-underweight', text: 'Podv√°ha' };
        if (bmi < 25) return { class: 'bmi-normal', text: 'Norm√°ln√≠' };
        if (bmi < 30) return { class: 'bmi-overweight', text: 'Nadv√°ha' };
        return { class: 'bmi-obese', text: 'Obezita' };
    };

    window.checkBMIAlert = function(bmi) {
        console.log("checkBMIAlert: Kontroluji BMI pro upozornƒõn√≠.");
        const alertEl = document.getElementById('bmiAlert');
        if (bmi === 0) {
            alertEl.className = 'alert';
            console.log("checkBMIAlert: BMI je 0, upozornƒõn√≠ skryto.");
            return;
        }
        if (bmi > settings.bmiDangerUpper) {
            alertEl.innerHTML = `‚ö†Ô∏è Varov√°n√≠: Va≈°e BMI (${bmi.toFixed(1)}) je v√Ωraznƒõ nad doporuƒçenou hranic√≠!`;
            alertEl.className = 'alert show';
            alertEl.style.background = '#ff5555';
            console.warn(`checkBMIAlert: BMI (${bmi.toFixed(1)}) je v nebezpeƒçn√©m p√°smu.`);
        } else if (bmi > settings.bmiWarningUpper) {
            alertEl.innerHTML = `‚ö° Upozornƒõn√≠: Va≈°e BMI (${bmi.toFixed(1)}) p≈ôekraƒçuje doporuƒçenou hranici.`;
            alertEl.className = 'alert show';
            alertEl.style.background = '#ffaa00';
            console.warn(`checkBMIAlert: BMI (${bmi.toFixed(1)}) je v varovn√©m p√°smu.`);
        } else if (bmi < settings.bmiWarningLower && bmi > 0) {
            alertEl.innerHTML = `‚ö° Upozornƒõn√≠: Va≈°e BMI (${bmi.toFixed(1)}) je pod doporuƒçenou hranic√≠.`;
            alertEl.className = 'alert show';
            alertEl.style.background = '#00aaff';
            console.warn(`checkBMIAlert: BMI (${bmi.toFixed(1)}) je pod doporuƒçenou hranic√≠.`);
        } else {
            alertEl.className = 'alert';
            console.log("checkBMIAlert: BMI je v normƒõ, upozornƒõn√≠ skryto.");
        }
    };

    window.showNotification = function(message, duration = 3000) {
        console.log(`showNotification: Zobrazuji notifikaci: "${message}"`);
        const notification = document.getElementById('notification');
        notification.textContent = message;
        notification.style.display = 'block';
        setTimeout(() => {
            notification.style.display = 'none';
            console.log("showNotification: Notifikace skryta.");
        }, duration);
    };

    window.showTab = function(tabName) {
        console.log(`showTab: P≈ôep√≠n√°m na z√°lo≈æku: ${tabName}`);
        document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
        document.getElementById(tabName).classList.add('active');
        console.log(`showTab: Z√°lo≈æka '${tabName}' aktivov√°na.`);
    };
    
    window.formatDateForDisplay = function(dateStr) {
        // console.log("formatDateForDisplay: Form√°tuji datum pro zobrazen√≠."); // Velmi ƒçast√© vol√°n√≠
        if (!dateStr) return '-';
        const date = new Date(dateStr);
        if (isNaN(date.getTime())) {
            console.warn(`formatDateForDisplay: Neplatn√© datum: ${dateStr}`);
            return 'Neplatn√© datum';
        }
        const day = date.getDate();
        const month = date.getMonth() + 1;
        const year = date.getFullYear();
        return `${day}. ${month}. ${year}`;
    };

    window.initializeCharts = function() {
        console.log("initializeCharts: Spu≈°tƒõna inicializace graf≈Ø.");
        const commonOptions = (yLabel, xLabelColor = '#00d9ff', yLabelColor = '#00d9ff', gridColor = '#444', yPrecision = 1) => ({
            responsive: true, maintainAspectRatio: false,
            scales: {
                y: { beginAtZero: false, grid: { color: gridColor }, ticks: { color: yLabelColor, precision: yPrecision }, title: { display: !!yLabel, text: yLabel, color: yLabelColor } },
                x: { grid: { color: gridColor }, ticks: { color: xLabelColor, autoSkip: true, maxTicksLimit: 10 } }
            }, plugins: { legend: { labels: { color: xLabelColor } } }
        });
        
        const lineChartDataset = (label, data, borderColor, bgColor) => ({
            label: label, data: data, borderColor: borderColor, backgroundColor: bgColor,
            tension: 0.1, pointBackgroundColor: borderColor, pointBorderColor: '#fff',
            pointRadius: 4, pointHoverRadius: 6
        });

        // Destroy existing chart instances before re-initializing
        console.log("initializeCharts: Niƒç√≠m existuj√≠c√≠ instance graf≈Ø pro znovuinicializaci.");
        if (weightChart) weightChart.destroy();
        if (bmiChart) bmiChart.destroy();
        if (bodyFatOnlyChart) bodyFatOnlyChart.destroy();
        if (muscleMassOnlyChart) muscleMassOnlyChart.destroy();
        if (bodyWaterChart) bodyWaterChart.destroy();
        if (manualBMRChart) manualBMRChart.destroy();
        if (manualAMRChart) manualAMRChart.destroy();

        weightChart = new Chart(document.getElementById('weightChart').getContext('2d'), { type: 'line', data: { labels: [], datasets: [lineChartDataset('V√°ha (kg)', [], '#00d9ff', 'rgba(0,217,255,0.2)')] }, options: commonOptions('V√°ha (kg)') });
        bmiChart = new Chart(document.getElementById('bmiChart').getContext('2d'), { type: 'line', data: { labels: [], datasets: [lineChartDataset('BMI', [], '#55ff99', 'rgba(85,255,153,0.2)')] }, options: commonOptions('BMI') });
        bodyWaterChart = new Chart(document.getElementById('bodyWaterChart').getContext('2d'), { type: 'line', data: { labels: [], datasets: [lineChartDataset('Voda v tƒõle (%)', [], '#00aaff', 'rgba(0,170,255,0.2)')] }, options: commonOptions('Voda v tƒõle (%)') });
        manualBMRChart = new Chart(document.getElementById('manualBMRChart').getContext('2d'), { type: 'line', data: { labels: [], datasets: [lineChartDataset('Zadan√© BMR (kcal)', [], '#ff9933', 'rgba(255,153,51,0.2)')] }, options: commonOptions('BMR (kcal)', undefined, undefined, undefined, 0) });
        manualAMRChart = new Chart(document.getElementById('manualAMRChart').getContext('2d'), { type: 'line', data: { labels: [], datasets: [lineChartDataset('Zadan√© AMR (kcal)', [], '#cc66ff', 'rgba(204,102,255,0.2)')] }, options: commonOptions('AMR (kcal)', undefined, undefined, undefined, 0) });
        bodyFatOnlyChart = new Chart(document.getElementById('bodyFatOnlyChart').getContext('2d'), { type: 'line', data: { labels: [], datasets: [lineChartDataset('Tƒõlesn√Ω tuk (%)', [], '#ff5555', 'rgba(255,85,85,0.2)')]}, options: commonOptions('Tuk (%)') });
        muscleMassOnlyChart = new Chart(document.getElementById('muscleMassOnlyChart').getContext('2d'), { type: 'line', data: { labels: [], datasets: [lineChartDataset('Svalov√° hmota (%)', [], '#ffff55', 'rgba(255,255,85,0.2)')]}, options: commonOptions('Svaly (%)') });
        console.log("initializeCharts: Grafy inicializov√°ny.");
    };

    window.updateCharts = function() {
        console.log("updateCharts: Aktualizuji data v grafech.");
        if (!weightLog || weightLog.length === 0) {
            console.log("updateCharts: ≈Ω√°dn√° data pro aktualizaci graf≈Ø.");
            return;
        }
        const sortedData = [...weightLog].sort((a, b) => new Date(a.date) - new Date(b.date));
        const labels = sortedData.map(entry => window.formatDateForDisplay(entry.date)); // Vol√°me glob√°ln√≠ form√°tov√°n√≠
        
        const weights = sortedData.map(entry => entry.weight);
        const bmis = sortedData.map(entry => window.calculateBMI(entry.weight, settings.height).toFixed(1)); // Vol√°me glob√°ln√≠ v√Ωpoƒçet
        const bodyFats = sortedData.map(entry => entry.bodyFat);
        
        const muscleMassPercentages = sortedData.map(entry => {
            if (entry.muscleMass && entry.weight && entry.weight > 0) {
                return parseFloat(((entry.muscleMass / entry.weight) * 100).toFixed(1));
            }
            return NaN;
        });

        const bodyWaters = sortedData.map(entry => entry.bodyWater);
        const manualBMRs = sortedData.map(entry => entry.manualBMR);
        const manualAMRs = sortedData.map(entry => entry.manualAMR);


        weightChart.data.labels = labels; weightChart.data.datasets[0].data = weights; weightChart.update();
        bmiChart.data.labels = labels; bmiChart.data.datasets[0].data = bmis; bmiChart.update();
        bodyWaterChart.data.labels = labels; bodyWaterChart.data.datasets[0].data = bodyWaters.map(bw => bw === null || bw === undefined ? NaN : bw); bodyWaterChart.update();
        manualBMRChart.data.labels = labels; manualBMRChart.data.datasets[0].data = manualBMRs.map(val => val === null || val === undefined ? NaN : val); manualBMRChart.update();
        manualAMRChart.data.labels = labels; manualAMRChart.data.datasets[0].data = manualAMRs.map(val => val === null || val === undefined ? NaN : val); manualAMRChart.update();
        bodyFatOnlyChart.data.labels = labels; bodyFatOnlyChart.data.datasets[0].data = bodyFats.map(bf => bf === null || bf === undefined ? NaN : bf); bodyFatOnlyChart.update();
        muscleMassOnlyChart.data.labels = labels; muscleMassOnlyChart.data.datasets[0].data = muscleMassPercentages; muscleMassOnlyChart.update();
        console.log("updateCharts: Grafy √∫spƒõ≈°nƒõ aktualizov√°ny.");
    };

    window.updateTable = function() {
        console.log("updateTable: Aktualizuji tabulku z√°znam≈Ø.");
        const tableBody = document.getElementById('tableBody');
        tableBody.innerHTML = ''; // Vypr√°zdn√≠m tabulku p≈ôed nov√Ωm naplnƒõn√≠m
        if (!weightLog || settings.height <=0) {
            console.log("updateTable: ≈Ω√°dn√° data nebo nastaven√≠ v√Ω≈°ky pro zobrazen√≠ tabulky.");
            return;
        }

        const sortedData = [...weightLog].sort((a, b) => new Date(b.date) - new Date(a.date)); // ≈òad√≠me od nejnovƒõj≈°√≠ho
        console.log(`updateTable: Zpracov√°v√°m ${sortedData.length} z√°znam≈Ø pro tabulku.`);
        
        sortedData.forEach((entry, index) => {
            const bmi = window.calculateBMI(entry.weight, settings.height);
            const classification = window.classifyBMI(bmi);
            
            let weightDiffText = '-';
            let diffClass = '';
            // Nalezen√≠ p≈ôedchoz√≠ho z√°znamu v chronologick√©m po≈ôad√≠ pro v√Ωpoƒçet rozd√≠lu
            const chronologicalLog = [...weightLog].sort((a, b) => new Date(a.date) - new Date(b.date));
            const currentEntryIndexChronological = chronologicalLog.findIndex(e => e.date === entry.date);
            const previousChronologicalEntry = currentEntryIndexChronological > 0 ? chronologicalLog[currentEntryIndexChronological -1] : null;

            if (previousChronologicalEntry) {
                const weightDiff = (entry.weight - previousChronologicalEntry.weight);
                weightDiffText = (weightDiff > 0 ? '+' : '') + weightDiff.toFixed(1);
                diffClass = weightDiff > 0 ? 'gain' : (weightDiff < 0 ? 'loss' : '');
            }

            let muscleMassDisplay = '-';
            if (entry.muscleMass && entry.weight && entry.weight > 0) {
                muscleMassDisplay = ((entry.muscleMass / entry.weight) * 100).toFixed(1) + '%';
            }
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${sortedData.length - index}</td>
                <td>${window.formatDateForDisplay(entry.date)}</td>
                <td>${entry.weight !== null && entry.weight !== undefined ? entry.weight.toFixed(1) : '-'}</td>
                <td class="${diffClass}">${weightDiffText}</td>
                <td class="${classification.class}">${bmi > 0 ? bmi.toFixed(1) : '-'}</td>
                <td class="${classification.class}">${classification.text}</td>
                <td>${entry.bodyFat !== null && entry.bodyFat !== undefined ? entry.bodyFat.toFixed(1) : '-'}%</td>
                <td>${muscleMassDisplay}</td>
                <td>${entry.bodyWater !== null && entry.bodyWater !== undefined ? entry.bodyWater.toFixed(1) : '-'}%</td>
                <td>${entry.manualBMR !== null && entry.manualBMR !== undefined ? entry.manualBMR : '-'}</td>
                <td>${entry.manualAMR !== null && entry.manualAMR !== undefined ? entry.manualAMR : '-'}</td>
                <td title="${entry.notes || ''}">${(entry.notes || '').substring(0,10)}${(entry.notes || '').length > 10 ? '...' : ''}</td>
                <td>
                    <button class="danger" onclick="deleteEntry('${entry.date}')" title="Smazat">üóëÔ∏è</button>
                    <button onclick="editEntry('${entry.date}')" title="Upravit">‚úèÔ∏è</button>
                </td>
            `;
            tableBody.appendChild(row);
        });
        console.log("updateTable: Tabulka √∫spƒõ≈°nƒõ aktualizov√°na.");
    };
    
    window.updateStats = function() {
        console.log("updateStats: Aktualizuji statistiky.");
        if (weightLog.length === 0) {
            console.log("updateStats: ≈Ω√°dn√° data pro zobrazen√≠ statistik.");
            document.getElementById('currentWeight').textContent = '-';
            document.getElementById('currentBMI').textContent = '-';
            document.getElementById('currentBMI').className = 'stat-value';
            document.getElementById('weightChange').textContent = '-';
            document.getElementById('weightChange').className = 'stat-value';
            document.getElementById('currentBodyWater').textContent = '-';
            document.getElementById('lastManualBMR').textContent = '-';
            document.getElementById('lastManualAMR').textContent = '-';
            document.getElementById('theoreticalBMR').textContent = '-';
            document.getElementById('theoreticalAMR').textContent = '-';
            document.getElementById('goalProgress').textContent = '-';
            document.getElementById('goalProgressBarCard').style.display = 'none';
            document.getElementById('latestEntryDate').textContent = '≈Ω√°dn√° data k zobrazen√≠.';
            return;
        }

        const sortedLog = [...weightLog].sort((a, b) => new Date(a.date) - new Date(b.date));
        const latestEntry = sortedLog[sortedLog.length - 1];
        
        const currentWeight = latestEntry.weight;
        const currentBMI = window.calculateBMI(currentWeight, settings.height);
        const currentBodyWater = latestEntry.bodyWater;

        document.getElementById('currentWeight').textContent = currentWeight.toFixed(1);
        document.getElementById('currentBMI').textContent = currentBMI > 0 ? currentBMI.toFixed(1) : '-';
        document.getElementById('currentBMI').className = 'stat-value ' + window.classifyBMI(currentBMI).class;
        document.getElementById('currentBodyWater').textContent = currentBodyWater !== null && currentBodyWater !== undefined ? currentBodyWater.toFixed(1) : '-';
        document.getElementById('lastManualBMR').textContent = latestEntry.manualBMR !== null && latestEntry.manualBMR !== undefined ? latestEntry.manualBMR : '-';
        document.getElementById('lastManualAMR').textContent = latestEntry.manualAMR !== null && latestEntry.manualAMR !== undefined ? latestEntry.manualAMR : '-';

        let weightChangeVal = 0;
        let weightChangeText = '-';
        let changeClass = '';
        if (sortedLog.length >= 2) {
            const previousEntry = sortedLog[sortedLog.length - 2];
            weightChangeVal = currentWeight - previousEntry.weight;
            weightChangeText = (weightChangeVal >= 0 ? '+' : '') + weightChangeVal.toFixed(1);
            changeClass = weightChangeVal > 0 ? 'gain' : (weightChangeVal < 0 ? 'loss' : '');
        }
        document.getElementById('weightChange').textContent = weightChangeText;
        document.getElementById('weightChange').className = 'stat-value ' + changeClass;

        const theoBMR = window.calculateBMR(currentWeight, settings.height, settings.age, settings.gender);
        const theoAMR = window.calculateAMR(theoBMR, settings.activityLevel);
        document.getElementById('theoreticalBMR').textContent = theoBMR > 0 ? Math.round(theoBMR) : '-';
        document.getElementById('theoreticalAMR').textContent = theoAMR > 0 ? Math.round(theoAMR) : '-';
        
        document.getElementById('latestEntryDate').textContent = `Posledn√≠ z√°znam: ${window.formatDateForDisplay(latestEntry.date)}`;

        if (goals.targetWeight && sortedLog.length > 0) {
            console.log("updateStats: Poƒç√≠t√°m pokrok k c√≠li.");
            const initialWeight = sortedLog[0].weight;
            const totalChangeNeeded = goals.targetWeight - initialWeight;
            const currentChangeAchieved = currentWeight - initialWeight;
            let progressPercent = 0;

            if (totalChangeNeeded !== 0) {
                if ((totalChangeNeeded < 0 && currentWeight <= initialWeight && currentWeight >= goals.targetWeight) ||
                    (totalChangeNeeded > 0 && currentWeight >= initialWeight && currentWeight <= goals.targetWeight)) {
                    progressPercent = (Math.abs(currentChangeAchieved) / Math.abs(totalChangeNeeded)) * 100;
                } else if ((totalChangeNeeded < 0 && currentWeight < goals.targetWeight) || (totalChangeNeeded > 0 && currentWeight > goals.targetWeight)) {
                    progressPercent = 100;
                } else {
                    progressPercent = 0;
                }
            } else {
                progressPercent = (initialWeight === currentWeight) ? 100 : 0;
            }
            progressPercent = Math.min(100, Math.max(0, progressPercent));

            document.getElementById('goalProgress').textContent = `${progressPercent.toFixed(1)}%`;
            document.getElementById('goalProgressBarCard').style.display = 'block';
            document.getElementById('progressFill').style.width = `${progressPercent}%`;
            
            const remainingKg = goals.targetWeight - currentWeight;
            if (progressPercent >= 100) {
                window.document.getElementById('goalStatus').textContent = `üéâ C√≠l ${goals.targetWeight} kg dosa≈æen/p≈ôekon√°n!`;
            } else {
                window.document.getElementById('goalStatus').textContent = `Zb√Ωv√°: ${remainingKg.toFixed(1)} kg do c√≠le (${goals.targetWeight} kg)`;
            }

            const THIRTY_DAYS_MS = 30 * 24 * 60 * 60 * 1000;
            const now = new Date();
            const recentLog = sortedLog.filter(entry => (now - new Date(entry.date)) <= THIRTY_DAYS_MS);

            if (recentLog.length >= 2 && remainingKg !== 0) {
                const oldestRecent = recentLog[0];
                const latestRecent = recentLog[recentLog.length - 1];
                const daysElapsed = Math.max(1, Math.floor((new Date(latestRecent.date) - new Date(oldestRecent.date)) / (1000 * 60 * 60 * 24)));
                const weightChangeInPeriod = latestRecent.weight - oldestRecent.weight;
                const dailyChange = weightChangeInPeriod / daysElapsed;
                let estimateText = 'Nedostatek dat pro odhad.';

                if (dailyChange !== 0 && ((remainingKg < 0 && dailyChange < 0) || (remainingKg > 0 && dailyChange > 0))) {
                    const estimatedDays = Math.abs(remainingKg / dailyChange);
                    if (estimatedDays > 365 * 3) {
                        estimateText = 'Odhad: v√≠ce ne≈æ 3 roky';
                    } else if (estimatedDays > 365) {
                        estimateText = `Odhad: cca ${Math.round(estimatedDays/30.44)} mƒõs√≠c≈Ø`;
                    } else {
                        estimateText = `Odhad: cca ${Math.round(estimatedDays)} dn√≠ (~${Math.round(estimatedDays / 7)} t√Ωdn≈Ø)`;
                    }
                } else if (dailyChange === 0 && remainingKg !== 0) {
                    estimateText = 'Odhad: stagnace, c√≠l se nep≈ôibli≈æuje.';
                } else if (remainingKg !== 0) {
                    estimateText = 'Odhad: aktu√°lnƒõ se vzdalujete od c√≠le.';
                }
                document.getElementById('goalEstimate').textContent = estimateText;
            } else if (remainingKg === 0) {
                document.getElementById('goalEstimate').textContent = 'C√≠l dosa≈æen!';
            } else {
                document.getElementById('goalEstimate').textContent = 'Nedostatek dat za posl. 30 dn√≠ pro odhad.';
            }
        } else {
            document.getElementById('goalProgress').textContent = '-';
            document.getElementById('goalProgressBarCard').style.display = 'none';
            document.getElementById('goalEstimate').textContent = 'C√≠l nen√≠ nastaven.';
        }
        window.checkBMIAlert(currentBMI);
        console.log("updateStats: Statistiky aktualizov√°ny.");
    };

    window.updateRecommendations = function() {
        console.log("updateRecommendations: Aktualizuji doporuƒçen√≠.");
        if (weightLog.length === 0 ) {
            document.getElementById('recommendationText').innerHTML = '<p>Pro doporuƒçen√≠ zadejte v√≠ce dat.</p>';
            console.log("updateRecommendations: ≈Ω√°dn√° data pro generov√°n√≠ doporuƒçen√≠.");
            return;
        }
        const sortedDataDesc = [...weightLog].sort((a, b) => new Date(b.date) - new Date(a.date));
        const latestEntry = sortedDataDesc[0];
        const currentWeight = latestEntry.weight;
        const currentBMI = window.calculateBMI(currentWeight, settings.height);
        
        let recommendations = [];

        if (currentBMI > 0) {
            if (currentBMI < 18.5) recommendations.push("üíö Va≈°e BMI naznaƒçuje podv√°hu. Zva≈æte konzultaci s l√©ka≈ôem o zdrav√©m p≈ô√≠r≈Østku v√°hy.");
            else if (currentBMI > settings.bmiDangerUpper) recommendations.push("‚ù§Ô∏è Va≈°e BMI je v p√°smu obezity. D≈Øraznƒõ doporuƒçujeme konzultaci s l√©ka≈ôem a √∫pravu ≈æivotn√≠ho stylu.");
            else if (currentBMI > settings.bmiWarningUpper) recommendations.push("üíõ Va≈°e BMI signalizuje nadv√°hu. Doporuƒçujeme zamƒõ≈ôit se na vyv√°≈æenou stravu a pravideln√Ω pohyb.");
            else recommendations.push("‚úÖ Va≈°e BMI je v norm√°ln√≠m rozmez√≠. Udr≈æujte si zdrav√Ω ≈æivotn√≠ styl!");
        } else if(settings.height) {
            recommendations.push("‚ö†Ô∏è Zadejte v√Ω≈°ku pro v√Ωpoƒçet BMI a relevantn√≠ doporuƒçen√≠.");
        }

        const sevenDaysAgo = new Date(new Date().setDate(new Date().getDate() - 7));
        const fourteenDaysAgo = new Date(new Date().setDate(new Date().getDate() - 14));
        
        const last7DaysEntries = weightLog.filter(e => new Date(e.date) >= sevenDaysAgo);
        const prev7DaysEntries = weightLog.filter(e => new Date(e.date) >= fourteenDaysAgo && new Date(e.date) < sevenDaysAgo);

        if (last7DaysEntries.length > 1 && prev7DaysEntries.length > 1) {
            const avgLast7 = last7DaysEntries.reduce((sum, e) => sum + e.weight, 0) / last7DaysEntries.length;
            const avgPrev7 = prev7DaysEntries.reduce((sum, e) => sum + e.weight, 0) / prev7DaysEntries.length;
            const weeklyTrend = avgLast7 - avgPrev7;

            if (Math.abs(weeklyTrend) > 1.5) {
                recommendations.push(`‚ö†Ô∏è Rychl√° zmƒõna v√°hy (${weeklyTrend.toFixed(1)} kg/t√Ωden pr≈Ømƒõrnƒõ). Zva≈æte pozvolnƒõj≈°√≠ tempo (ide√°lnƒõ 0.5-1 kg/t√Ωden).`);
            } else if (weeklyTrend !== 0) {
                recommendations.push(`üìà T√Ωdenn√≠ trend v√°hy: ${weeklyTrend.toFixed(1)} kg. Pokraƒçujte ve sv√©m √∫sil√≠!`);
            }
        } else if (last7DaysEntries.length >=2) {
            const sortedWeek = last7DaysEntries.sort((a,b) => new Date(a.date) - new Date(b.date));
            const weekChange = sortedWeek[sortedWeek.length-1].weight - sortedWeek[0].weight;
            if (Math.abs(weekChange) > 1.5) {
                recommendations.push(`‚ö†Ô∏è Rychl√° zmƒõna v√°hy za posledn√≠ dny: ${weekChange.toFixed(1)} kg. Doporuƒçujeme pozvolnƒõj≈°√≠ zmƒõny.`);
            }
        }

        if (goals.targetWeight && goals.targetDate) {
            console.log("updateRecommendations: Poƒç√≠t√°m doporuƒçen√≠ pro c√≠le.");
            const daysToGoal = Math.ceil((new Date(goals.targetDate) - new Date()) / (1000 * 60 * 60 * 24));
            const weightToChange = goals.targetWeight - currentWeight;
            
            if (daysToGoal > 0 && weightToChange !== 0) {
                const requiredWeeklyChange = (weightToChange / (daysToGoal / 7)).toFixed(1);
                recommendations.push(`üéØ Pro dosa≈æen√≠ c√≠le (${goals.targetWeight} kg) do ${window.formatDateForDisplay(goals.targetDate)}, je pot≈ôeba pr≈Ømƒõrn√° t√Ωdenn√≠ zmƒõna ${requiredWeeklyChange} kg.`);
                if (Math.abs(requiredWeeklyChange) > 1.5) {
                    recommendations.push("üí° Tento t√Ωdenn√≠ c√≠l je pomƒõrnƒõ ambici√≥zn√≠. Ujistƒõte se, ≈æe je udr≈æiteln√Ω a zdrav√Ω.");
                }
            } else if (weightToChange === 0) {
                recommendations.push(`üéØ C√≠lov√° v√°ha ${goals.targetWeight} kg dosa≈æena! Gratulujeme!`);
            } else if (daysToGoal <=0 && weightToChange !==0) {
                recommendations.push(`üóìÔ∏è Term√≠n pro c√≠l ${goals.targetWeight} kg ji≈æ vypr≈°el. Zva≈æte nastaven√≠ nov√©ho c√≠le.`);
            }
        } else if (goals.targetWeight) {
            const weightToChange = goals.targetWeight - currentWeight;
            if (weightToChange === 0) recommendations.push(`üéØ C√≠lov√° v√°ha ${goals.targetWeight} kg dosa≈æena!`);
            else recommendations.push(`üéØ C√≠l: ${goals.targetWeight} kg. Aktu√°lnƒõ zb√Ωv√° ${weightToChange.toFixed(1)} kg.`);
        }

        const theoBMR = window.calculateBMR(currentWeight, settings.height, settings.age, settings.gender);
        const theoAMR = window.calculateAMR(theoBMR, settings.activityLevel);
        
        if (theoAMR > 0 && goals.weeklyGoal) {
            const weeklyCalDeficitOrSurplus = goals.weeklyGoal * 7700;
            const dailyCalAdjustment = weeklyCalDeficitOrSurplus / 7;
            const targetCalories = Math.round(theoAMR + dailyCalAdjustment);
            let goalType = goals.weeklyGoal < 0 ? "hubnut√≠" : (goals.weeklyGoal > 0 ? "nab√≠r√°n√≠" : "udr≈æov√°n√≠");

            recommendations.push(`üî• Pro t√Ωdenn√≠ c√≠l ${goals.weeklyGoal} kg (${goalType}), v√°≈° odhadovan√Ω denn√≠ p≈ô√≠jem by mohl b√Ωt okolo ${targetCalories} kcal (Teoretick√Ω AMR: ${Math.round(theoAMR)} kcal).`);
            if (targetCalories < theoBMR && goals.weeklyGoal < 0) {
                recommendations.push("‚ùó V√°≈° c√≠lov√Ω denn√≠ p≈ô√≠jem je pod va≈°√≠m teoretick√Ωm BMR. Dlouhodobƒõ to nemus√≠ b√Ωt udr≈æiteln√©. Zva≈æte m√≠rnƒõj≈°√≠ c√≠l nebo konzultaci s odborn√≠kem.");
            }
        } else if (theoAMR > 0 && latestEntry.manualAMR) {
            recommendations.push(`üí° V√°≈° posledn√≠ zadan√Ω AMR je ${latestEntry.manualAMR} kcal. Teoreticky vypoƒçten√Ω AMR je ${Math.round(theoAMR)} kcal. Rozd√≠l m≈Ø≈æe b√Ωt d√°n specifickou aktivitou nebo metodikou mƒõ≈ôen√≠.`);
        }
        document.getElementById('recommendationText').innerHTML = recommendations.length > 0 ? recommendations.map(rec => `<p>${rec}</p>`).join('') : '<p>≈Ω√°dn√° specifick√° doporuƒçen√≠. Udr≈æujte zdrav√© n√°vyky!</p>';
        console.log("updateRecommendations: Doporuƒçen√≠ aktualizov√°na.");
    };

    window.updateDisplay = function() {
        console.log("updateDisplay: Spu≈°tƒõna celkov√° aktualizace zobrazen√≠.");
        window.updateTable();
        window.updateCharts();
        window.updateStats();
        window.updateRecommendations();
        console.log("updateDisplay: Celkov√© zobrazen√≠ aktualizov√°no.");
    };

    // Ud√°losti formul√°≈ô≈Ø a tlaƒç√≠tek - vol√°me glob√°ln√≠ funkce
    document.getElementById('entryForm').addEventListener('submit', async function(e) {
        console.log("entryForm: Odes√≠l√°n√≠ nov√©ho z√°znamu.");
        e.preventDefault();
        const date = document.getElementById('entryDate').value;
        const weight = parseFloat(document.getElementById('entryWeight').value);
        const bodyFat = document.getElementById('entryBodyFat').value ? parseFloat(document.getElementById('entryBodyFat').value) : null;
        const muscleMass = document.getElementById('entryMuscleMass').value ? parseFloat(document.getElementById('entryMuscleMass').value) : null;
        const bodyWater = document.getElementById('entryBodyWater').value ? parseFloat(document.getElementById('entryBodyWater').value) : null;
        const manualBMR = document.getElementById('entryManualBMR').value ? parseInt(document.getElementById('entryManualBMR').value) : null;
        const manualAMR = document.getElementById('entryManualAMR').value ? parseInt(document.getElementById('entryManualAMR').value) : null;
        const notes = document.getElementById('entryNotes').value;

        if (isNaN(weight) || weight <= 0) {
            window.showNotification('Chyba: Zadejte platnou v√°hu.', 3000);
            console.warn("entryForm: Neplatn√° v√°ha zad√°na.");
            return;
        }

        const newEntryData = { date, weight, bodyFat, muscleMass, bodyWater, manualBMR, manualAMR, notes };
        console.log("entryForm: Nov√° data z√°znamu:", newEntryData);

        const existingIndex = weightLog.findIndex(entry => entry.date === date);
        if (existingIndex !== -1) {
            console.log("entryForm: Z√°znam pro toto datum ji≈æ existuje. Dotazuji na p≈ôeps√°n√≠.");
            if (confirm('Z√°znam pro tento datum ji≈æ existuje. Chcete ho p≈ôepsat?')) {
                weightLog[existingIndex] = newEntryData;
                console.log("entryForm: Existuj√≠c√≠ z√°znam p≈ôeps√°n.");
            } else {
                console.log("entryForm: P≈ôeps√°n√≠ z√°znamu zru≈°eno.");
                return;
            }
        } else {
            weightLog.push(newEntryData);
            console.log("entryForm: Nov√Ω z√°znam p≈ôid√°n.");
        }
        await window.saveData(); // Vol√°me glob√°ln√≠ saveData()
        window.updateDisplay(); // Vol√°me glob√°ln√≠ updateDisplay()
        window.showNotification('Z√°znam byl √∫spƒõ≈°nƒõ p≈ôid√°n/aktualizov√°n!'); // Vol√°me glob√°ln√≠ showNotification()
        this.reset();
        window.setTodayDate(); // Vol√°me glob√°ln√≠ setTodayDate()
        window.showTab('dashboard'); // Vol√°me glob√°ln√≠ showTab()
        console.log("entryForm: Zpracov√°n√≠ z√°znamu dokonƒçeno.");
    });

    document.getElementById('settingsForm').addEventListener('submit', async function(e) {
        console.log("settingsForm: Odes√≠l√°n√≠ nastaven√≠.");
        e.preventDefault();
        settings.height = parseInt(document.getElementById('height').value);
        settings.age = document.getElementById('age').value ? parseInt(document.getElementById('age').value) : null;
        settings.gender = document.getElementById('gender').value;
        settings.activityLevel = parseFloat(document.getElementById('activityLevel').value);
        console.log("settingsForm: Nov√© hodnoty nastaven√≠:", settings);
        await window.saveData(); // Vol√°me glob√°ln√≠ saveData()
        window.updateDisplay(); // Vol√°me glob√°ln√≠ updateDisplay()
        window.showNotification('Nastaven√≠ byla ulo≈æena!'); // Vol√°me glob√°ln√≠ showNotification()
        console.log("settingsForm: Nastaven√≠ ulo≈æena.");
    });

    document.getElementById('bmiAlertsForm').addEventListener('submit', async function(e) {
        console.log("bmiAlertsForm: Odes√≠l√°n√≠ BMI hranic.");
        e.preventDefault();
        settings.bmiWarningUpper = parseFloat(document.getElementById('bmiWarningUpper').value);
        settings.bmiDangerUpper = parseFloat(document.getElementById('bmiDangerUpper').value);
        settings.bmiWarningLower = parseFloat(document.getElementById('bmiWarningLower').value);
        console.log("bmiAlertsForm: Nov√© BMI hranice:", { warningUpper: settings.bmiWarningUpper, dangerUpper: settings.bmiDangerUpper, warningLower: settings.bmiWarningLower });
        await window.saveData(); // Vol√°me glob√°ln√≠ saveData()
        window.updateDisplay(); // Vol√°me glob√°ln√≠ updateDisplay()
        window.showNotification('BMI hranice byly ulo≈æeny!'); // Vol√°me glob√°ln√≠ showNotification()
        console.log("bmiAlertsForm: BMI hranice ulo≈æeny.");
    });

    document.getElementById('remindersForm').addEventListener('submit', async function(e) {
        console.log("remindersForm: Odes√≠l√°n√≠ nastaven√≠ p≈ôipom√≠nek.");
        e.preventDefault();
        settings.reminderEnabled = document.getElementById('reminderEnabled').checked;
        settings.reminderInterval = parseInt(document.getElementById('reminderInterval').value);
        console.log("remindersForm: Nov√© nastaven√≠ p≈ôipom√≠nek:", { enabled: settings.reminderEnabled, interval: settings.reminderInterval });
        await window.saveData(); // Vol√°me glob√°ln√≠ saveData()
        window.showNotification('Nastaven√≠ p≈ôipom√≠nek bylo ulo≈æeno!'); // Vol√°me glob√°ln√≠ showNotification()
        console.log("remindersForm: Nastaven√≠ p≈ôipom√≠nek ulo≈æeno.");
    });

    document.getElementById('goalsForm').addEventListener('submit', async function(e) {
        console.log("goalsForm: Odes√≠l√°n√≠ c√≠l≈Ø.");
        e.preventDefault();
        goals.targetWeight = document.getElementById('targetWeight').value ? parseFloat(document.getElementById('targetWeight').value) : null;
        goals.targetBMI = document.getElementById('targetBMI').value ? parseFloat(document.getElementById('targetBMI').value) : null;
        goals.targetDate = document.getElementById('targetDate').value || null;
        goals.weeklyGoal = document.getElementById('weeklyGoal').value ? parseFloat(document.getElementById('weeklyGoal').value) : null;
        console.log("goalsForm: Nov√© c√≠le:", goals);
        await window.saveData(); // Vol√°me glob√°ln√≠ saveData()
        window.updateDisplay(); // Vol√°me glob√°ln√≠ updateDisplay()
        window.showNotification('C√≠le byly ulo≈æeny!'); // Vol√°me glob√°ln√≠ showNotification()
        console.log("goalsForm: C√≠le ulo≈æeny.");
    });

    // Globalizovan√© funkce pro onclick atributy
    window.deleteEntry = async function(date) {
        console.log(`deleteEntry: Pokus o smaz√°n√≠ z√°znamu pro datum: ${date}.`);
        if (confirm(`Opravdu chcete smazat z√°znam ze dne ${window.formatDateForDisplay(date)}?`)) {
            weightLog = weightLog.filter(entry => entry.date !== date);
            console.log(`deleteEntry: Z√°znam pro datum ${date} smaz√°n z lok√°ln√≠ pamƒõti.`);
            await window.saveData(); // Vol√°me glob√°ln√≠ saveData() (kter√© nyn√≠ ma≈æe i z Firestore)
            // Smaz√°n√≠ z Firebase je nyn√≠ souƒç√°st√≠ saveData, kter√© vol√° deleteWeightEntryFromFirestore
            window.updateDisplay(); // Vol√°me glob√°ln√≠ updateDisplay()
            window.showNotification('Z√°znam byl smaz√°n!'); // Vol√°me glob√°ln√≠ showNotification()
            console.log("deleteEntry: Z√°znam smaz√°n√≠ dokonƒçeno.");
        } else {
            console.log("deleteEntry: Smaz√°n√≠ z√°znamu zru≈°eno.");
        }
    };

    window.editEntry = function(date) {
        console.log(`editEntry: Pokus o editaci z√°znamu pro datum: ${date}.`);
        const entry = weightLog.find(e => e.date === date);
        if (entry) {
            document.getElementById('entryDate').value = entry.date;
            document.getElementById('entryWeight').value = entry.weight;
            document.getElementById('entryBodyFat').value = entry.bodyFat || '';
            document.getElementById('entryMuscleMass').value = entry.muscleMass || '';
            document.getElementById('entryBodyWater').value = entry.bodyWater || '';
            document.getElementById('entryManualBMR').value = entry.manualBMR || '';
            document.getElementById('entryManualAMR').value = entry.manualAMR || '';
            document.getElementById('entryNotes').value = entry.notes || '';
            window.showTab('add-entry');
            window.showNotification(`Z√°znam ze dne ${window.formatDateForDisplay(date)} naƒçten pro editaci.`);
            console.log("editEntry: Z√°znam naƒçten do formul√°≈ôe pro editaci.");
        } else {
            console.warn(`editEntry: Z√°znam pro datum ${date} nebyl nalezen pro editaci.`);
        }
    };

    window.exportToCSV = function() {
        console.log("exportToCSV: Spu≈°tƒõn export dat do CSV.");
        if (weightLog.length === 0) { window.showNotification("Nen√≠ co exportovat.", 2000); console.warn("exportToCSV: ≈Ω√°dn√° data k exportu."); return; }
        const headers = ['Datum', 'Vaha (kg)', 'BMI', 'Telesny tuk (%)', 'Svalova hmota (%)', 'Svalova hmota (%)', 'Voda v tele (%)', 'Manual BMR', 'Manual AMR', 'Poznamky'];
        const rows = weightLog.map(entry => {
            let musclePercent = '';
            if (entry.muscleMass && entry.weight && entry.weight > 0) {
                musclePercent = ((entry.muscleMass / entry.weight) * 100).toFixed(1);
            }
            return [
                entry.date, entry.weight, window.calculateBMI(entry.weight, settings.height).toFixed(1),
                entry.bodyFat || '', musclePercent, entry.muscleMass || '', entry.bodyWater || '',
                entry.manualBMR || '', entry.manualAMR || '', `"${(entry.notes || '').replace(/"/g, '""')}"`
            ];
        });

        const csvContent = "data:text/csv;charset=utf-8," + headers.join(',') + '\n' + rows.map(row => row.join(',')).join('\n');
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement('a');
        link.setAttribute('href', encodedUri);
        link.setAttribute('download', `vaha_export_Jirik_${new Date().toISOString().split('T')[0]}.csv`);
        document.body.appendChild(link); link.click(); document.body.removeChild(link);
        window.showNotification('CSV export dokonƒçen!');
        console.log("exportToCSV: Export CSV dokonƒçen.");
    };

    window.exportToPDF = function() {
        console.log("exportToPDF: Spu≈°tƒõn export dat do PDF.");
        if (weightLog.length === 0) { window.showNotification("Nen√≠ co exportovat.", 2000); console.warn("exportToPDF: ≈Ω√°dn√° data k exportu."); return; }
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        doc.setFontSize(18); doc.text('V√°hov√Ω report - Admir√°l Ji≈ô√≠k', 14, 22);
        doc.setFontSize(11); doc.text(`Generov√°no: ${window.formatDateForDisplay(new Date().toISOString().split('T')[0])}`, 14, 30);
        doc.text(`V√Ω≈°ka: ${settings.height} cm, Vƒõk: ${settings.age || '-'} let, Pohlav√≠: ${settings.gender === 'male' ? 'Mu≈æ' : '≈Ωena'}`, 14, 36);
        
        const latestEntry = [...weightLog].sort((a, b) => new Date(b.date) - new Date(a.date))[0];
        if (latestEntry) {
            const currentBMI = window.calculateBMI(latestEntry.weight, settings.height);
            const theoBMR = window.calculateBMR(latestEntry.weight, settings.height, settings.age, settings.gender);
            const theoAMR = window.calculateAMR(theoBMR, settings.activityLevel);
            doc.text(`Aktu√°ln√≠ v√°ha: ${latestEntry.weight.toFixed(1)} kg, BMI: ${currentBMI > 0 ? currentBMI.toFixed(1) : '-'}`, 14, 42);
            if (latestEntry.manualBMR || latestEntry.manualAMR) {
                doc.text(`Posl. zadan√Ω BMR: ${latestEntry.manualBMR || '-'} kcal, AMR: ${latestEntry.manualAMR || '-'} kcal`, 14, 48);
            } else {
                doc.text(`Teoretick√Ω BMR: ${theoBMR > 0 ? Math.round(theoBMR) : '-'} kcal, AMR: ${theoAMR > 0 ? Math.round(theoAMR) : '-'} kcal`, 14, 48);
            }
        }

        const tableColumn = ["#", "Datum", "V√°ha", "BMI", "Tuk%", "Svaly%", "Voda%", "Zad.BMR", "Zad.AMR"];
        const tableRows = [];
        const sortedLog = [...weightLog].sort((a, b) => new Date(a.date) - new Date(b.date));

        sortedLog.forEach((entry, index) => {
            const bmi = window.calculateBMI(entry.weight, settings.height);
            let musclePercentText = '-';
            if (entry.muscleMass && entry.weight && entry.weight > 0) {
                musclePercentText = ((entry.muscleMass / entry.weight) * 100).toFixed(1);
            }
            const rowData = [
                index + 1, window.formatDateForDisplay(entry.date), entry.weight.toFixed(1),
                bmi > 0 ? bmi.toFixed(1) : '-',
                entry.bodyFat !== null && entry.bodyFat !== undefined ? entry.bodyFat.toFixed(1) : '-',
                musclePercentText,
                entry.bodyWater !== null && entry.bodyWater !== undefined ? entry.bodyWater.toFixed(1) : '-',
                entry.manualBMR !== null && entry.manualBMR !== undefined ? entry.manualBMR : '-',
                entry.manualAMR !== null && entry.manualAMR !== undefined ? entry.manualAMR : '-',
            ];
            tableRows.push(rowData);
        });

        doc.autoTable({ head: [tableColumn], body: tableRows, startY: 55, theme: 'grid', headStyles: { fillColor: [13, 17, 23], textColor: [0, 217, 255] }, styles: { font: "Consolas", cellPadding: 1.5, fontSize: 7 }, columnStyles: { 0: { cellWidth: 8 }, 1: { cellWidth: 20 }, } });
        doc.save(`vaha_report_Jirik_${new Date().toISOString().split('T')[0]}.pdf`);
        window.showNotification('PDF report dokonƒçen!');
        console.log("exportToPDF: Export PDF dokonƒçen.");
    };

    window.exportChartsAsPDF = function() {
        console.log("exportChartsAsPDF: Spu≈°tƒõn export graf≈Ø do PDF.");
        if (weightLog.length === 0) { window.showNotification("Nen√≠ co exportovat.", 2000); console.warn("exportChartsAsPDF: ≈Ω√°dn√° data pro export."); return; }
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('p', 'mm', 'a4');
        let yPos = 20; const chartWidth = 180; const chartHeight = 70; const spacing = 10;
        doc.setFontSize(18); doc.text('Grafy v√Ωvoje - Admir√°l Ji≈ô√≠k', doc.internal.pageSize.getWidth() / 2, 15, { align: 'center' });
        const chartsToExport = [
            { canvasId: 'weightChart', title: 'V√Ωvoj v√°hy' }, { canvasId: 'bmiChart', title: 'V√Ωvoj BMI' },
            { canvasId: 'bodyFatOnlyChart', title: 'V√Ωvoj tƒõlesn√©ho tuku (%)' }, { canvasId: 'muscleMassOnlyChart', title: 'V√Ωvoj svalov√© hmoty (%)' },
            { canvasId: 'bodyWaterChart', title: 'V√Ωvoj vody v tƒõle (%)' }, { canvasId: 'manualBMRChart', title: 'V√Ωvoj zadan√©ho BMR (kcal)' },
            { canvasId: 'manualAMRChart', title: 'V√Ωvoj zadan√©ho AMR (kcal)' }
        ];
        chartsToExport.forEach((chartInfo, index) => {
            const canvas = document.getElementById(chartInfo.canvasId);
            const chartInstance = Chart.getChart(canvas);
            let hasData = false;
            if (chartInstance && chartInstance.data.labels.length > 0) {
                hasData = chartInstance.data.datasets.some(dataset => dataset.data.some(d => d !== null && !isNaN(d) && d !== undefined));
            }
            if (!hasData) return;
            if (yPos + chartHeight + spacing > doc.internal.pageSize.getHeight() - 15 && index > 0) { doc.addPage(); yPos = 20; }
            doc.setFontSize(12); doc.text(chartInfo.title, 15, yPos); yPos += 5;
            const imgData = canvas.toDataURL('image/png', 0.95);
            doc.addImage(imgData, 'PNG', 15, yPos, chartWidth, chartHeight); yPos += chartHeight + spacing;
        });
        doc.save(`vaha_grafy_Jirik_${new Date().toISOString().split('T')[0]}.pdf`);
        window.showNotification('Grafy exportov√°ny do PDF!');
        console.log("exportChartsAsPDF: Export graf≈Ø dokonƒçen.");
    };

    window.exportBackup = function() {
        console.log("exportBackup: Spu≈°tƒõno vytv√°≈ôen√≠ √∫pln√© z√°lohy.");
        const backupData = {
            weightLog: weightLog, settings: settings, goals: goals,
            exportDate: new Date().toISOString(), appName: "Pokroƒçil√Ω v√°hov√Ω tracker v√≠ce admir√°la Ji≈ô√≠ka", version: "1.5.0"
        };
        const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `vaha_zaloha_Jirik_${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(link); link.click(); document.body.removeChild(link);
        window.showNotification('√öpln√° z√°loha vytvo≈ôena!');
        console.log("exportBackup: √öpln√° z√°loha vytvo≈ôena.");
    };

    window.importFromCSV = async function(inputElement) {
        console.log("importFromCSV: Spu≈°tƒõn import dat z CSV.");
        const file = inputElement.files[0]; if (!file) { console.warn("importFromCSV: ≈Ω√°dn√Ω soubor vybr√°n."); return; }
        const reader = new FileReader();
        reader.onload = async function(e) {
            console.log("importFromCSV: Soubor CSV naƒçten.");
            const csv = e.target.result; const lines = csv.split(/\r\n|\n/);
            if (lines.length <= 1) { window.showNotification('CSV soubor je pr√°zdn√Ω nebo neobsahuje data.', 3000); console.warn("importFromCSV: CSV soubor je pr√°zdn√Ω."); inputElement.value = ''; return; }
            const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
            const muscleKgOrPercentIdx = headers.indexOf('svalova hmota (kg)') !== -1 ? headers.indexOf('svalova hmota (kg)') : headers.indexOf('svalova hmota (%)');
            
            const dateIdx = headers.indexOf('datum'); const weightIdx = headers.indexOf('vaha (kg)');
            const fatIdx = headers.indexOf('telesny tuk (%)'); const waterIdx = headers.indexOf('voda v tele (%)');
            const manualBmrIdx = headers.indexOf('manual bmr'); const manualAmrIdx = headers.indexOf('manual amr');
            const notesIdx = headers.indexOf('poznamky');

            let importedCount = 0; let skippedCount = 0;
            console.log(`importFromCSV: Zpracov√°v√°m ${lines.length - 1} ≈ô√°dk≈Ø CSV.`);
            for (let i = 1; i < lines.length; i++) {
                const data = lines[i].split(',');
                const date = data[dateIdx] ? data[dateIdx].trim() : null;
                const weight = data[weightIdx] ? parseFloat(data[weightIdx].trim()) : null;
                if (!date || !weight || isNaN(weight)) { skippedCount++; console.warn(`importFromCSV: P≈ôeskoƒçen neplatn√Ω ≈ô√°dek ${i}: ${lines[i]}`); continue; }
                
                let muscleMassKg = null;
                if (muscleKgOrPercentIdx !== -1 && data[muscleKgOrPercentIdx] && !isNaN(parseFloat(data[muscleKgOrPercentIdx].trim()))) {
                    if (headers[muscleKgOrPercentIdx] === 'svalova hmota (%)') {
                        const percent = parseFloat(data[muscleKgOrPercentIdx].trim());
                        muscleMassKg = parseFloat(((percent / 100) * weight).toFixed(2));
                    } else { muscleMassKg = parseFloat(data[muscleKgOrPercentIdx].trim()); }
                }
                const newEntry = {
                    date: date, weight: weight, bodyFat: fatIdx !== -1 && data[fatIdx] ? parseFloat(data[fatIdx].trim()) : null,
                    muscleMass: muscleMassKg, bodyWater: waterIdx !== -1 && data[waterIdx] ? parseFloat(data[waterIdx].trim()) : null,
                    manualBMR: manualBmrIdx !== -1 && data[manualBmrIdx] ? parseInt(data[manualBmrIdx].trim()) : null,
                    manualAMR: manualAmrIdx !== -1 && data[manualAmrIdx] ? parseInt(data[manualAmrIdx].trim()) : null,
                    notes: notesIdx !== -1 && data[notesIdx] ? data[notesIdx].trim().replace(/^"|"$/g, '') : ""
                };
                const existingIndex = weightLog.findIndex(entry => entry.date === newEntry.date);
                if (existingIndex !== -1) { weightLog[existingIndex] = newEntry; console.log(`importFromCSV: Aktualizov√°n z√°znam pro datum ${date}.`); } else { weightLog.push(newEntry); console.log(`importFromCSV: P≈ôid√°n nov√Ω z√°znam pro datum ${date}.`); }
                importedCount++;
            }
            if (importedCount > 0) {
                console.log("importFromCSV: Ukl√°d√°m importovan√° data.");
                await window.saveData(); // Vol√°me glob√°ln√≠ saveData()
                window.updateDisplay(); // Vol√°me glob√°ln√≠ updateDisplay()
                window.showNotification(`Importov√°no ${importedCount} z√°znam≈Ø. ${skippedCount > 0 ? skippedCount + ' p≈ôeskoƒçeno.' : ''}`);
            } else { window.showNotification('Nebyly nalezeny ≈æ√°dn√© platn√© z√°znamy k importu v CSV.', 3000); }
            inputElement.value = '';
            console.log("importFromCSV: Import CSV dokonƒçen.");
        };
        reader.readAsText(file);
    };

    window.importFromBackup = async function(inputElement) { // Globalizov√°no a async
        console.log("importFromBackup: Spu≈°tƒõn import ze z√°lohy.");
        const file = inputElement.files[0]; if (!file) { console.warn("importFromBackup: ≈Ω√°dn√Ω soubor z√°lohy vybr√°n."); return; }
        const reader = new FileReader();
        reader.onload = async function(e) { // async vno≈ôen√° funkce
            console.log("importFromBackup: Soubor z√°lohy naƒçten.");
            try {
                const backupData = JSON.parse(e.target.result);
                console.log("importFromBackup: Data z√°lohy analyzov√°na:", backupData);
                if (backupData.appName !== "Pokroƒçil√Ω v√°hov√Ω tracker v√≠ce admir√°la Ji≈ô√≠ka") {
                    console.warn("importFromBackup: Soubor z√°lohy nepoch√°z√≠ z t√©to aplikace. Dotazuji u≈æivatele na pokraƒçov√°n√≠.");
                    if (!confirm("Zd√° se, ≈æe tento soubor nepoch√°z√≠ z t√©to aplikace. P≈ôesto pokraƒçovat?")) {
                        inputElement.value = ''; console.log("importFromBackup: Import z√°lohy zru≈°en u≈æivatelem."); return;
                    }
                }
                if (backupData.weightLog) { weightLog = backupData.weightLog; console.log("importFromBackup: weightLog ze z√°lohy naƒçten."); }
                if (backupData.settings) { settings = { ...settings, ...backupData.settings }; console.log("importFromBackup: Nastaven√≠ ze z√°lohy naƒçtena."); }
                if (backupData.goals) { goals = { ...goals, ...backupData.goals }; console.log("importFromBackup: C√≠le ze z√°lohy naƒçteny."); }
                
                weightLog.forEach(entry => { // Zaji≈°tƒõn√≠ kompatibility star≈°√≠ch z√°znam≈Ø
                    if (entry.manualBMR === undefined) entry.manualBMR = null;
                    if (entry.manualAMR === undefined) entry.manualAMR = null;
                    if (entry.muscleMass === undefined) entry.muscleMass = null;
                });
                console.log("importFromBackup: Data z√°lohy p≈ôipravena, ukl√°d√°m.");
                await window.saveData(); // Vol√°me glob√°ln√≠ saveData()
                window.updateForms(); // Vol√°me glob√°ln√≠ updateForms()
                window.updateDisplay(); // Vol√°me glob√°ln√≠ updateDisplay()
                window.showNotification('Z√°loha √∫spƒõ≈°nƒõ obnovena!');
                console.log("importFromBackup: Import z√°lohy dokonƒçen.");
            } catch (error) {
                window.showNotification('Chyba p≈ôi naƒç√≠t√°n√≠ z√°lohy: ' + error.message, 4000);
                console.error("importFromBackup: Chyba p≈ôi zpracov√°n√≠ souboru z√°lohy:", error);
            }
            inputElement.value = '';
        };
        reader.readAsText(file);
    };

    window.clearAllData = async function() {
        console.log("clearAllData: Spu≈°tƒõn proces maz√°n√≠ v≈°ech dat.");
        if (confirm('‚ö†Ô∏è OPRAVDU chcete smazat V≈†ECHNA data? Tuto akci nelze vr√°tit zpƒõt!')) {
            console.log("clearAllData: U≈æivatel potvrdil 1. f√°zi maz√°n√≠.");
            if (confirm('‚ö†Ô∏è JSTE SI ABSOLUTNƒö JISTI? V≈°echna data budou nen√°vratnƒõ ztracena!')) {
                console.log("clearAllData: U≈æivatel potvrdil 2. f√°zi maz√°n√≠. Ma≈æu data.");
                localStorage.removeItem('weightLog_JirikTracker_v2_charts_separated_musclePercent');
                localStorage.removeItem('weightSettings_JirikTracker_v2_charts_separated_musclePercent');
                localStorage.removeItem('weightGoals_JirikTracker_v2_charts_separated_musclePercent');
                console.log("clearAllData: Lok√°ln√≠ data smaz√°na z LocalStorage.");
                
                try {
                    console.log("clearAllData: Pokou≈°√≠m se smazat v≈°echna data z Firebase Firestore.");
                    await window.clearAllFirestoreData(); // Tato funkce je definov√°na v firebaseFunctions.js
                    console.log("clearAllData: V≈°echna data √∫spƒõ≈°nƒõ smaz√°na z Firebase Firestore.");
                } catch (error) {
                    console.error("clearAllData: Chyba p≈ôi maz√°n√≠ v≈°ech dat z Firebase Firestore:", error);
                    window.showNotification("Chyba p≈ôi maz√°n√≠ dat z cloudu! Sma≈æte je pros√≠m ruƒçnƒõ v konzoli Firebase.", 8000);
                }

                weightLog = [];
                // Reset settings a goals na v√Ωchoz√≠ hodnoty
                settings = { height: 174, age: null, gender: 'male', activityLevel: 1.55, bmiWarningUpper: 25, bmiDangerUpper: 30, bmiWarningLower: 18.5, reminderEnabled: true, reminderInterval: 7 };
                goals = { targetWeight: null, targetBMI: null, targetDate: null, weeklyGoal: null };
                console.log("clearAllData: Glob√°ln√≠ promƒõnn√© resetov√°ny na v√Ωchoz√≠ hodnoty.");
                await window.loadData(); // Vol√°me glob√°ln√≠ loadData() pro opƒõtovn√© naƒçten√≠ (nyn√≠ pr√°zdn√© nebo v√Ωchoz√≠)
                window.showNotification('V≈°echna data byla smaz√°na!');
                console.log("clearAllData: Proces maz√°n√≠ v≈°ech dat dokonƒçen.");
            } else {
                console.log("clearAllData: Maz√°n√≠ v≈°ech dat zru≈°eno u≈æivatelem (2. f√°ze).");
            }
        } else {
            console.log("clearAllData: Maz√°n√≠ v≈°ech dat zru≈°eno u≈æivatelem (1. f√°ze).");
        }
    };

    window.checkReminders = function() {
        console.log("checkReminders: Kontroluji, zda je t≈ôeba zobrazit p≈ôipom√≠nku.");
        if (!settings.reminderEnabled) {
            console.log("checkReminders: P≈ôipom√≠nky jsou zak√°z√°ny.");
            return;
        }
        if (weightLog.length === 0) {
            console.log("checkReminders: ≈Ω√°dn√© z√°znamy v√°hy, p≈ôipom√≠nka nen√≠ nutn√°.");
            return;
        }
        const lastEntry = [...weightLog].sort((a, b) => new Date(b.date) - new Date(a.date))[0];
        if (lastEntry) {
            const daysSinceLastEntry = Math.floor((new Date() - new Date(lastEntry.date)) / (1000 * 60 * 60 * 24));
            console.log(`checkReminders: Dn√≠ od posledn√≠ho z√°znamu (${window.formatDateForDisplay(lastEntry.date)}): ${daysSinceLastEntry}. Interval: ${settings.reminderInterval}.`);
            if (daysSinceLastEntry >= settings.reminderInterval) {
                window.showNotification(`‚è∞ P≈ôipom√≠nka: Posledn√≠ z√°znam v√°hy byl p≈ôed ${daysSinceLastEntry} dny (${window.formatDateForDisplay(lastEntry.date)})!`, 5000);
                console.log("checkReminders: Zobrazena p≈ôipom√≠nka.");
            } else {
                console.log("checkReminders: P≈ôipom√≠nka nen√≠ nutn√°, interval je≈°tƒõ nevypr≈°el.");
            }
        }
    };
    setInterval(window.checkReminders, 30 * 60 * 1000); // Pou≈æ√≠v√°me glob√°ln√≠ checkReminders


    window.toggleFullScreen = function() {
        console.log("toggleFullScreen: Pokus o p≈ôepnut√≠ re≈æimu cel√© obrazovky.");
        const elem = document.documentElement;
        const btn = document.getElementById('fullscreen-btn');
        if (!document.fullscreenElement) {
            console.log("toggleFullScreen: Vstupuji do celoobrazovkov√©ho re≈æimu.");
            if (elem.requestFullscreen) elem.requestFullscreen().catch(err => console.error(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`));
            else if (elem.mozRequestFullScreen) elem.mozRequestFullScreen();
            else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
            else if (elem.msRequestFullscreen) elem.msRequestFullscreen();
            if(btn) btn.innerHTML = '&#10006;';
        } else {
            console.log("toggleFullScreen: Opou≈°t√≠m celoobrazovkov√Ω re≈æim.");
            if (document.exitFullscreen) document.exitFullscreen();
            else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
            else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
            else if (document.msExitFullscreen) elem.msExitFullscreen();
            if(btn) btn.innerHTML = '&#x26F6;';
        }
        console.log("toggleFullScreen: P≈ôepnut√≠ re≈æimu cel√© obrazovky dokonƒçeno.");
    };
    
    window.updateFullscreenButtonIcon = function() {
        // console.log("updateFullscreenButtonIcon: Aktualizuji ikonu fullscreen tlaƒç√≠tka."); // Velmi ƒçast√© vol√°n√≠
        const btn = document.getElementById('fullscreen-btn');
        if(!btn) return;
        if (document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement || document.msFullscreenElement) {
            btn.innerHTML = '&#10006;';
        } else {
            btn.innerHTML = '&#x26F6;';
        }
    };

    // Funkce pro aktualizaci v≈°ech √∫daj≈Ø z tlaƒç√≠tka
    window.refreshAllData = async function() {
        console.log("refreshAllData: Spu≈°tƒõna ruƒçn√≠ aktualizace v≈°ech √∫daj≈Ø (z tlaƒç√≠tka).");
        // Nejd≈ô√≠ve zniƒç√≠me existuj√≠c√≠ instance graf≈Ø, ne≈æ je znovu inicializujeme
        if (weightChart) { weightChart.destroy(); console.log("refreshAllData: weightChart zniƒçen."); }
        if (bmiChart) { bmiChart.destroy(); console.log("refreshAllData: bmiChart zniƒçen."); }
        if (bodyFatOnlyChart) { bodyFatOnlyChart.destroy(); console.log("refreshAllData: bodyFatOnlyChart zniƒçen."); }
        if (muscleMassOnlyChart) { muscleMassOnlyChart.destroy(); console.log("refreshAllData: muscleMassOnlyChart zniƒçen."); }
        if (bodyWaterChart) { bodyWaterChart.destroy(); console.log("refreshAllData: bodyWaterChart zniƒçen."); }
        if (manualBMRChart) { manualBMRChart.destroy(); console.log("refreshAllData: manualBMRChart zniƒçen."); }
        if (manualAMRChart) { manualAMRChart.destroy(); console.log("refreshAllData: manualAMRChart zniƒçen."); }

        await window.loadData(); // Vol√°me glob√°ln√≠ loadData()
        window.updateForms(); // Vol√°me glob√°ln√≠ updateForms()
        window.initializeCharts(); // Vol√°me glob√°ln√≠ initializeCharts()
        window.updateDisplay(); // Vol√°me glob√°ln√≠ updateDisplay()
        window.checkReminders(); // Vol√°me glob√°ln√≠ checkReminders()
        window.showNotification('V≈°echny √∫daje byly √∫spƒõ≈°nƒõ aktualizov√°ny (vƒçetnƒõ cloudu)!', 3000);
        console.log("refreshAllData: Ruƒçn√≠ aktualizace dokonƒçena.");
    };

    // Hlavn√≠ inicializaƒçn√≠ logika po naƒçten√≠ DOM
    document.addEventListener('DOMContentLoaded', async function() {
        console.log("DOMContentLoaded: DOM plnƒõ naƒçten. Spou≈°t√≠m hlavn√≠ inicializaci aplikace.");
        // Inicializujeme Firebase aplikaci a Firestore datab√°zi pomoc√≠ funkce z firebaseFunctions.js
        // Tato funkce (window.initializeFirebaseApp) je definov√°na v firebaseFunctions.js
        if (window.initializeFirebaseApp()) {
            console.log("DOMContentLoaded: Firebase inicializace dokonƒçena v hlavn√≠ str√°nce. Pokou≈°√≠m se naƒç√≠st data.");
            // Nyn√≠, kdy≈æ je Firebase p≈ôipraveno, m≈Ø≈æeme naƒç√≠st data
            await window.loadData();
        } else {
            console.error("DOMContentLoaded: Kritick√° chyba: Nepoda≈ôilo se inicializovat Firebase. Aplikace bude fungovat pouze s LocalStorage daty.");
            window.showNotification("Kritick√° chyba: Nelze se p≈ôipojit k datab√°zi. Data se ukl√°daj√≠ pouze lok√°lnƒõ!", 8000);
            // I p≈ôes selh√°n√≠ Firebase se pokus√≠me naƒç√≠st z LocalStorage a zobrazit UI
            await window.loadData(); // Spust√≠ naƒç√≠t√°n√≠ (fallback na LocalStorage)
        }
        
        console.log("DOMContentLoaded: Inicializuji grafy a aktualizuji zobrazen√≠.");
        window.initializeCharts();
        window.updateDisplay();
        window.checkReminders();
        window.setTodayDate();

        // P≈ôid√°n√≠ tlaƒç√≠tka na celou obrazovku
        const fullscreenButton = document.createElement('button');
        fullscreenButton.className = 'fullscreen';
        fullscreenButton.id = 'fullscreen-btn';
        fullscreenButton.innerHTML = '&#x26F6;';
        fullscreenButton.title = 'P≈ôepnout na celou obrazovku';
        fullscreenButton.addEventListener('click', window.toggleFullScreen);
        document.body.appendChild(fullscreenButton);
        console.log("DOMContentLoaded: Fullscreen tlaƒç√≠tko p≈ôid√°no.");

        ['fullscreenchange', 'mozfullscreenchange', 'webkitfullscreenchange', 'msfullscreenchange'].forEach(event => {
            document.addEventListener(event, window.updateFullscreenButtonIcon);
            console.log(`DOMContentLoaded: Posluchaƒç ud√°losti ${event} p≈ôid√°n.`);
        });
        console.log("DOMContentLoaded: Hlavn√≠ inicializace aplikace dokonƒçena.");
    });

</script>
</body>
</html>